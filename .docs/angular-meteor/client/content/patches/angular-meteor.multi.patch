From 9e3080168633d4b2a5c3dd4a860fe2f8771322e8 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 14:23:47 +0300
Subject: [PATCH 001/236] Step 0.1: Create empty index.html file

---
 index.html | 3 +++
 1 file changed, 3 insertions(+)
 create mode 100644 index.html

diff --git a/index.html b/index.html
new file mode 100644
index 0000000..ef412ef
--- /dev/null
+++ b/index.html
@@ -0,0 +1,3 @@
+<body>
+  <p>Nothing here</p>
+</body>
-- 
2.3.2 (Apple Git-55)


From 2cb6cc6b54ab557bc03cc6ddcb985531a79a9369 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 14:34:33 +0300
Subject: [PATCH 002/236] Add angular-meteor to the project and add change the
 main page

---
 index.html    | 2 +-
 index.ng.html | 1 +
 2 files changed, 2 insertions(+), 1 deletion(-)
 create mode 100644 index.ng.html

diff --git a/index.html b/index.html
index ef412ef..bf21494 100644
--- a/index.html
+++ b/index.html
@@ -1,3 +1,3 @@
 <body>
-  <p>Nothing here</p>
+  <div ng-include="'index.ng.html'"></div>
 </body>
diff --git a/index.ng.html b/index.ng.html
new file mode 100644
index 0000000..79ed426
--- /dev/null
+++ b/index.ng.html
@@ -0,0 +1 @@
+<p>Nothing here</p>
-- 
2.3.2 (Apple Git-55)


From 9376c5fc09a4a990a28547cf643a37812288fc10 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 15:45:01 +0300
Subject: [PATCH 003/236] Revert "Add angular-meteor to the project and add
 change the main page"

This reverts commit 2cb6cc6b54ab557bc03cc6ddcb985531a79a9369.
---
 index.html    | 2 +-
 index.ng.html | 1 -
 2 files changed, 1 insertion(+), 2 deletions(-)
 delete mode 100644 index.ng.html

diff --git a/index.html b/index.html
index bf21494..ef412ef 100644
--- a/index.html
+++ b/index.html
@@ -1,3 +1,3 @@
 <body>
-  <div ng-include="'index.ng.html'"></div>
+  <p>Nothing here</p>
 </body>
diff --git a/index.ng.html b/index.ng.html
deleted file mode 100644
index 79ed426..0000000
--- a/index.ng.html
+++ /dev/null
@@ -1 +0,0 @@
-<p>Nothing here</p>
-- 
2.3.2 (Apple Git-55)


From 0a564b8b735409e03f92d1b5de072814e3f22b20 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 16:47:59 +0300
Subject: [PATCH 004/236] Step 0.2: Move the main HTML into index.ng.html

---
 index.ng.html | 1 +
 1 file changed, 1 insertion(+)
 create mode 100644 index.ng.html

diff --git a/index.ng.html b/index.ng.html
new file mode 100644
index 0000000..79ed426
--- /dev/null
+++ b/index.ng.html
@@ -0,0 +1 @@
+<p>Nothing here</p>
-- 
2.3.2 (Apple Git-55)


From f07ee765a41c36639f3f9ee3d84c4608fceb6522 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 16:49:45 +0300
Subject: [PATCH 005/236] Step 0.3: Include the angular main file inside the
 index.html file

---
 index.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/index.html b/index.html
index ef412ef..bf21494 100644
--- a/index.html
+++ b/index.html
@@ -1,3 +1,3 @@
 <body>
-  <p>Nothing here</p>
+  <div ng-include="'index.ng.html'"></div>
 </body>
-- 
2.3.2 (Apple Git-55)


From 9e55616290d7bf5417dbe551023a487254e931b2 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 17:14:56 +0300
Subject: [PATCH 006/236] Step 0.4: Create app.js file to contain the AngularJS
 application

---
 app.js | 3 +++
 1 file changed, 3 insertions(+)
 create mode 100644 app.js

diff --git a/app.js b/app.js
new file mode 100644
index 0000000..2465ea1
--- /dev/null
+++ b/app.js
@@ -0,0 +1,3 @@
+if (Meteor.isClient) {
+
+}
-- 
2.3.2 (Apple Git-55)


From 2f0587779960cdb2b22060cac9fdeafbec0a9bc3 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 17:16:03 +0300
Subject: [PATCH 007/236] Step 0.5: Create AngularJS module and add
 angular-meteor dependency

---
 app.js | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/app.js b/app.js
index 2465ea1..987f384 100644
--- a/app.js
+++ b/app.js
@@ -1,3 +1,3 @@
 if (Meteor.isClient) {
-
+  angular.module('socially',['angular-meteor']);
 }
-- 
2.3.2 (Apple Git-55)


From 1ac42a79ef6e234ae930679e122ce51e01c7ba08 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 17:25:28 +0300
Subject: [PATCH 008/236] Step 0.6: Add ng-app

---
 index.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/index.html b/index.html
index bf21494..963f4fa 100644
--- a/index.html
+++ b/index.html
@@ -1,3 +1,3 @@
-<body>
+<body ng-app="socially">
   <div ng-include="'index.ng.html'"></div>
 </body>
-- 
2.3.2 (Apple Git-55)


From 558c4c5b2c4d9058f3777f655c33c80cb6c283b9 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 17:31:28 +0300
Subject: [PATCH 009/236] Step 0.7: Add AngularJS code!

---
 index.ng.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/index.ng.html b/index.ng.html
index 79ed426..a9c8ddc 100644
--- a/index.ng.html
+++ b/index.ng.html
@@ -1 +1 @@
-<p>Nothing here</p>
+<p>Nothing here {{ 'yet' + '!' }}</p>
-- 
2.3.2 (Apple Git-55)


From 93775c58628a82788c131d5c570c3691404bc27b Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 18:17:02 +0300
Subject: [PATCH 010/236] Add some static HTML to the application

---
 index.ng.html | 15 ++++++++++++++-
 1 file changed, 14 insertions(+), 1 deletion(-)

diff --git a/index.ng.html b/index.ng.html
index a9c8ddc..dd1ef68 100644
--- a/index.ng.html
+++ b/index.ng.html
@@ -1 +1,14 @@
-<p>Nothing here {{ 'yet' + '!' }}</p>
+<ul>
+  <li>
+    <span>Dubstep-Free Zone</span>
+    <p>
+      Can we please just for an evening not listen to dubstep.
+    </p>
+  </li>
+  <li>
+    <span>All dubstep all the time</span>
+    <p>
+      Get it on!
+    </p>
+  </li>
+</ul>
-- 
2.3.2 (Apple Git-55)


From c45dd30702e4623c132bf172713fbd473828324c Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 18:17:26 +0300
Subject: [PATCH 011/236] Revert "Add some static HTML to the application"

This reverts commit 93775c58628a82788c131d5c570c3691404bc27b.
---
 index.ng.html | 15 +--------------
 1 file changed, 1 insertion(+), 14 deletions(-)

diff --git a/index.ng.html b/index.ng.html
index dd1ef68..a9c8ddc 100644
--- a/index.ng.html
+++ b/index.ng.html
@@ -1,14 +1 @@
-<ul>
-  <li>
-    <span>Dubstep-Free Zone</span>
-    <p>
-      Can we please just for an evening not listen to dubstep.
-    </p>
-  </li>
-  <li>
-    <span>All dubstep all the time</span>
-    <p>
-      Get it on!
-    </p>
-  </li>
-</ul>
+<p>Nothing here {{ 'yet' + '!' }}</p>
-- 
2.3.2 (Apple Git-55)


From 635337fb05f3a3870107a76f800d73b8f3f9f597 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 18:18:08 +0300
Subject: [PATCH 012/236] Step 1.1: Add some static HTML the to main page

---
 index.ng.html | 15 ++++++++++++++-
 1 file changed, 14 insertions(+), 1 deletion(-)

diff --git a/index.ng.html b/index.ng.html
index a9c8ddc..dd1ef68 100644
--- a/index.ng.html
+++ b/index.ng.html
@@ -1 +1,14 @@
-<p>Nothing here {{ 'yet' + '!' }}</p>
+<ul>
+  <li>
+    <span>Dubstep-Free Zone</span>
+    <p>
+      Can we please just for an evening not listen to dubstep.
+    </p>
+  </li>
+  <li>
+    <span>All dubstep all the time</span>
+    <p>
+      Get it on!
+    </p>
+  </li>
+</ul>
-- 
2.3.2 (Apple Git-55)


From 6240f10604bf1aaef15af9b6b2b50a92aa826c66 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 18:20:42 +0300
Subject: [PATCH 013/236] Step 2.1: Use dynamic template instead of static

---
 index.ng.html | 22 ++++++++--------------
 1 file changed, 8 insertions(+), 14 deletions(-)

diff --git a/index.ng.html b/index.ng.html
index dd1ef68..7f8c6d9 100644
--- a/index.ng.html
+++ b/index.ng.html
@@ -1,14 +1,8 @@
-<ul>
-  <li>
-    <span>Dubstep-Free Zone</span>
-    <p>
-      Can we please just for an evening not listen to dubstep.
-    </p>
-  </li>
-  <li>
-    <span>All dubstep all the time</span>
-    <p>
-      Get it on!
-    </p>
-  </li>
-</ul>
+<div ng-controller="PartiesListCtrl">
+  <ul>
+    <li ng-repeat="party in parties">
+      {{party.name}}
+      <p>{{party.description}}</p>
+    </li>
+  </ul>
+</div>
-- 
2.3.2 (Apple Git-55)


From 6e7629a14aeb15bcf5d4d09eb5a7efcad4b3157f Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 18:22:53 +0300
Subject: [PATCH 014/236] Step 2.2: Add the parties controller

---
 app.js | 21 +++++++++++++++++++--
 1 file changed, 19 insertions(+), 2 deletions(-)

diff --git a/app.js b/app.js
index 987f384..9cbfb86 100644
--- a/app.js
+++ b/app.js
@@ -1,3 +1,20 @@
 if (Meteor.isClient) {
-  angular.module('socially',['angular-meteor']);
-}
+  angular.module('socially', ['angular-meteor']);
+
+  angular.module('socially').controller('PartiesListCtrl', ['$scope', function ($scope) {
+    $scope.parties = [
+      {
+        'name': 'Dubstep-Free Zone',
+        'description': 'Can we please just for an evening not listen to dubstep.'
+      },
+      {
+        'name': 'All dubstep all the time',
+        'description': 'Get it on!'
+      },
+      {
+        'name': 'Savage lounging',
+        'description': 'Leisure suit required. And only fiercest manners.'
+      }
+    ];
+  }]);
+}
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From d4684ff16bedbe4be95acc1b49fb18791aec5be7 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 18:27:33 +0300
Subject: [PATCH 015/236] Step 3.1: Add the parties collection

---
 app.js | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/app.js b/app.js
index 9cbfb86..c280708 100644
--- a/app.js
+++ b/app.js
@@ -1,3 +1,5 @@
+Parties = new Mongo.Collection("parties");
+
 if (Meteor.isClient) {
   angular.module('socially', ['angular-meteor']);
 
-- 
2.3.2 (Apple Git-55)


From fe64d639689585622d814981685f764f50a77d1a Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 18:39:33 +0300
Subject: [PATCH 016/236] Step 3.2: Add the $meteor.collection to the $scope

---
 app.js | 15 +--------------
 1 file changed, 1 insertion(+), 14 deletions(-)

diff --git a/app.js b/app.js
index c280708..b67154d 100644
--- a/app.js
+++ b/app.js
@@ -4,19 +4,6 @@ if (Meteor.isClient) {
   angular.module('socially', ['angular-meteor']);
 
   angular.module('socially').controller('PartiesListCtrl', ['$scope', function ($scope) {
-    $scope.parties = [
-      {
-        'name': 'Dubstep-Free Zone',
-        'description': 'Can we please just for an evening not listen to dubstep.'
-      },
-      {
-        'name': 'All dubstep all the time',
-        'description': 'Get it on!'
-      },
-      {
-        'name': 'Savage lounging',
-        'description': 'Leisure suit required. And only fiercest manners.'
-      }
-    ];
+    $scope.parties = $meteor.collection(Parties);
   }]);
 }
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From eb07ef77a353f557a98f0e291242b03a26d3f7b2 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 18:40:05 +0300
Subject: [PATCH 017/236] Step 3.3: Add a dependency to $meteor

---
 app.js | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/app.js b/app.js
index b67154d..698ceb5 100644
--- a/app.js
+++ b/app.js
@@ -3,7 +3,7 @@ Parties = new Mongo.Collection("parties");
 if (Meteor.isClient) {
   angular.module('socially', ['angular-meteor']);
 
-  angular.module('socially').controller('PartiesListCtrl', ['$scope', function ($scope) {
+  angular.module('socially').controller('PartiesListCtrl', ['$scope', '$meteor', function ($scope, $meteor) {
     $scope.parties = $meteor.collection(Parties);
   }]);
 }
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From e57d3e9d78a51a4d18267b8028d87d0a050b6177 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 18:43:17 +0300
Subject: [PATCH 018/236] Step 3.4: Add some data to the parties collection

---
 app.js | 17 +++++++++++++++++
 1 file changed, 17 insertions(+)

diff --git a/app.js b/app.js
index 698ceb5..5fcad11 100644
--- a/app.js
+++ b/app.js
@@ -6,4 +6,21 @@ if (Meteor.isClient) {
   angular.module('socially').controller('PartiesListCtrl', ['$scope', '$meteor', function ($scope, $meteor) {
     $scope.parties = $meteor.collection(Parties);
   }]);
+}
+
+if (Meteor.isServer) {
+  Meteor.startup(function () {
+    if (Parties.find().count() === 0) {
+      var parties = [
+        {'name': 'Dubstep-Free Zone',
+          'description': 'Fast just got faster with Nexus S.'},
+        {'name': 'All dubstep all the time',
+          'description': 'Get it on!'},
+        {'name': 'Savage lounging',
+          'description': 'Leisure suit required. And only fiercest manners.'}
+      ];
+      for (var i = 0; i < parties.length; i++)
+        Parties.insert(parties[i]);
+    }
+  });
 }
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 48adafa009190b5193f16aa461f3777b703a480e Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 18:49:37 +0300
Subject: [PATCH 019/236] Step 4.1: Add basic form to the view

---
 index.ng.html | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/index.ng.html b/index.ng.html
index 7f8c6d9..4880315 100644
--- a/index.ng.html
+++ b/index.ng.html
@@ -1,4 +1,11 @@
 <div ng-controller="PartiesListCtrl">
+  <form>
+    <label>Name</label>
+    <input>
+    <label>Description</label>
+    <input>
+    <button>Add</button>
+  </form>
   <ul>
     <li ng-repeat="party in parties">
       {{party.name}}
-- 
2.3.2 (Apple Git-55)


From 4d4411239e7abc65a55515323c8bdd4222df6692 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 18:50:38 +0300
Subject: [PATCH 020/236] Step 4.2: Add ng-model to the form's inputs

---
 index.ng.html | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/index.ng.html b/index.ng.html
index 4880315..ea6dc8f 100644
--- a/index.ng.html
+++ b/index.ng.html
@@ -1,9 +1,9 @@
 <div ng-controller="PartiesListCtrl">
   <form>
     <label>Name</label>
-    <input>
+    <input ng-model="newParty.name">
     <label>Description</label>
-    <input>
+    <input ng-model="newParty.description">
     <button>Add</button>
   </form>
   <ul>
-- 
2.3.2 (Apple Git-55)


From b76cb0c3452e1e279be876f3f203ac2008ebb9c4 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 18:51:15 +0300
Subject: [PATCH 021/236] Step 4.3: Add ng-click logic to the "Add" button

---
 index.ng.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/index.ng.html b/index.ng.html
index ea6dc8f..d39fd36 100644
--- a/index.ng.html
+++ b/index.ng.html
@@ -4,7 +4,7 @@
     <input ng-model="newParty.name">
     <label>Description</label>
     <input ng-model="newParty.description">
-    <button>Add</button>
+    <button ng-click="parties.push(newParty); newParty='';">Add</button>
   </form>
   <ul>
     <li ng-repeat="party in parties">
-- 
2.3.2 (Apple Git-55)


From a01637ebc273308940d7d46e3ef07ae0e5e35bae Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 18:52:46 +0300
Subject: [PATCH 022/236] Step 4.4: Add delete button to the parties list

---
 index.ng.html | 1 +
 1 file changed, 1 insertion(+)

diff --git a/index.ng.html b/index.ng.html
index d39fd36..614c3a0 100644
--- a/index.ng.html
+++ b/index.ng.html
@@ -10,6 +10,7 @@
     <li ng-repeat="party in parties">
       {{party.name}}
       <p>{{party.description}}</p>
+      <button ng-click="remove(party)">X</button>
     </li>
   </ul>
 </div>
-- 
2.3.2 (Apple Git-55)


From e13f8b5f343c6a843fb3e0a9911975897f3ef216 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 18:53:55 +0300
Subject: [PATCH 023/236] Step 4.5: Add remove logic to the controller

---
 app.js | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/app.js b/app.js
index 5fcad11..fbe73ca 100644
--- a/app.js
+++ b/app.js
@@ -5,6 +5,10 @@ if (Meteor.isClient) {
 
   angular.module('socially').controller('PartiesListCtrl', ['$scope', '$meteor', function ($scope, $meteor) {
     $scope.parties = $meteor.collection(Parties);
+
+    $scope.remove = function(party){
+      $scope.parties.splice($scope.parties.indexOf(party), 1);
+    };
   }]);
 }
 
-- 
2.3.2 (Apple Git-55)


From 63016ba7329dd9ebf60a7a2f509ee11f19fee45e Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 18:55:39 +0300
Subject: [PATCH 024/236] Step 4.6: Replace push with save

---
 index.ng.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/index.ng.html b/index.ng.html
index 614c3a0..68ec2ac 100644
--- a/index.ng.html
+++ b/index.ng.html
@@ -4,7 +4,7 @@
     <input ng-model="newParty.name">
     <label>Description</label>
     <input ng-model="newParty.description">
-    <button ng-click="parties.push(newParty); newParty='';">Add</button>
+    <button ng-click="parties.save(newParty); newParty='';">Add</button>
   </form>
   <ul>
     <li ng-repeat="party in parties">
-- 
2.3.2 (Apple Git-55)


From b0190118b6de0b445329ecca199f1ce95fd7ae3d Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 18:56:41 +0300
Subject: [PATCH 025/236] Step 4.7: Use remove function instead of splice

---
 app.js | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/app.js b/app.js
index fbe73ca..a0119e6 100644
--- a/app.js
+++ b/app.js
@@ -7,7 +7,7 @@ if (Meteor.isClient) {
     $scope.parties = $meteor.collection(Parties);
 
     $scope.remove = function(party){
-      $scope.parties.splice($scope.parties.indexOf(party), 1);
+      $scope.parties.remove(party);
     };
   }]);
 }
-- 
2.3.2 (Apple Git-55)


From 251a3efe08fb0cf827138f5d900561ffa71092a4 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 18:57:38 +0300
Subject: [PATCH 026/236] Step 4.8: Add Remove All button

---
 index.ng.html | 1 +
 1 file changed, 1 insertion(+)

diff --git a/index.ng.html b/index.ng.html
index 68ec2ac..5c567a8 100644
--- a/index.ng.html
+++ b/index.ng.html
@@ -5,6 +5,7 @@
     <label>Description</label>
     <input ng-model="newParty.description">
     <button ng-click="parties.save(newParty); newParty='';">Add</button>
+    <button ng-click="removeAll()">Remove All</button>
   </form>
   <ul>
     <li ng-repeat="party in parties">
-- 
2.3.2 (Apple Git-55)


From cdd20a5e46e1323d269105a667cd283b4dd09bc4 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 18:58:20 +0300
Subject: [PATCH 027/236] Step 4.9: Add Remove All logic to the controller

---
 app.js | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/app.js b/app.js
index a0119e6..f2ea8fd 100644
--- a/app.js
+++ b/app.js
@@ -9,6 +9,10 @@ if (Meteor.isClient) {
     $scope.remove = function(party){
       $scope.parties.remove(party);
     };
+
+    $scope.removeAll = function(){
+      $scope.parties.remove();
+    };
   }]);
 }
 
-- 
2.3.2 (Apple Git-55)


From 895d5dae9d7cafce16f2f40fb12e84c516e67853 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 19:03:28 +0300
Subject: [PATCH 028/236] Step 5.1: Add angular-ui-router dependency

---
 app.js | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/app.js b/app.js
index f2ea8fd..c68e970 100644
--- a/app.js
+++ b/app.js
@@ -1,7 +1,7 @@
 Parties = new Mongo.Collection("parties");
 
 if (Meteor.isClient) {
-  angular.module('socially', ['angular-meteor']);
+  angular.module('socially', ['angular-meteor', 'ui.router']);
 
   angular.module('socially').controller('PartiesListCtrl', ['$scope', '$meteor', function ($scope, $meteor) {
     $scope.parties = $meteor.collection(Parties);
-- 
2.3.2 (Apple Git-55)


From 597a8f46c89a22140f06e752b442de5bc143bbbb Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 19:08:18 +0300
Subject: [PATCH 029/236] Step 5.2: Create parties list page

---
 parties-list.ng.html | 17 +++++++++++++++++
 1 file changed, 17 insertions(+)
 create mode 100644 parties-list.ng.html

diff --git a/parties-list.ng.html b/parties-list.ng.html
new file mode 100644
index 0000000..5c567a8
--- /dev/null
+++ b/parties-list.ng.html
@@ -0,0 +1,17 @@
+<div ng-controller="PartiesListCtrl">
+  <form>
+    <label>Name</label>
+    <input ng-model="newParty.name">
+    <label>Description</label>
+    <input ng-model="newParty.description">
+    <button ng-click="parties.save(newParty); newParty='';">Add</button>
+    <button ng-click="removeAll()">Remove All</button>
+  </form>
+  <ul>
+    <li ng-repeat="party in parties">
+      {{party.name}}
+      <p>{{party.description}}</p>
+      <button ng-click="remove(party)">X</button>
+    </li>
+  </ul>
+</div>
-- 
2.3.2 (Apple Git-55)


From ce42492612d76790f609f03d841fa2fd9c47709d Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 19:09:27 +0300
Subject: [PATCH 030/236] Step 5.3: Update index.html

---
 index.html | 17 ++++++++++++++---
 1 file changed, 14 insertions(+), 3 deletions(-)

diff --git a/index.html b/index.html
index 963f4fa..0fcd817 100644
--- a/index.html
+++ b/index.html
@@ -1,3 +1,14 @@
-<body ng-app="socially">
-  <div ng-include="'index.ng.html'"></div>
-</body>
+<head>
+  <base href="/">
+</head>
+<body>
+
+<div ng-app="socially">
+  <h1>
+    <a href="/parties">Home</a>
+  </h1>
+
+  <div ui-view></div>
+</div>
+
+</body>
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 6f728390fdea570e920529b6d54b29a193b351d6 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 19:12:39 +0300
Subject: [PATCH 031/236] Remove index.ng.html

---
 index.ng.html | 17 -----------------
 1 file changed, 17 deletions(-)
 delete mode 100644 index.ng.html

diff --git a/index.ng.html b/index.ng.html
deleted file mode 100644
index 5c567a8..0000000
--- a/index.ng.html
+++ /dev/null
@@ -1,17 +0,0 @@
-<div ng-controller="PartiesListCtrl">
-  <form>
-    <label>Name</label>
-    <input ng-model="newParty.name">
-    <label>Description</label>
-    <input ng-model="newParty.description">
-    <button ng-click="parties.save(newParty); newParty='';">Add</button>
-    <button ng-click="removeAll()">Remove All</button>
-  </form>
-  <ul>
-    <li ng-repeat="party in parties">
-      {{party.name}}
-      <p>{{party.description}}</p>
-      <button ng-click="remove(party)">X</button>
-    </li>
-  </ul>
-</div>
-- 
2.3.2 (Apple Git-55)


From 1b9e1619c0e0900f90c6e0135bed9ce55db1a6aa Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 19:12:51 +0300
Subject: [PATCH 032/236] Step 5.4: Create party details page

---
 party-details.ng.html | 1 +
 1 file changed, 1 insertion(+)
 create mode 100644 party-details.ng.html

diff --git a/party-details.ng.html b/party-details.ng.html
new file mode 100644
index 0000000..68fe7fe
--- /dev/null
+++ b/party-details.ng.html
@@ -0,0 +1 @@
+Here you will see the details of party number: {{ partyId }}
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 742be2247550ea71b51778be8de1f24f56a8aec3 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 19:13:05 +0300
Subject: [PATCH 033/236] Update packages with ui router

---
 .meteor/packages | 1 +
 .meteor/versions | 1 +
 2 files changed, 2 insertions(+)

diff --git a/.meteor/packages b/.meteor/packages
index fa5ef7a..bcf70e4 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -8,3 +8,4 @@ meteor-platform
 autopublish
 insecure
 urigo:angular
+angularui:angular-ui-router
diff --git a/.meteor/versions b/.meteor/versions
index 10658a5..fd36a32 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -1,4 +1,5 @@
 angular:angular@1.4.4
+angularui:angular-ui-router@0.2.15
 autopublish@1.0.3
 autoupdate@1.2.1
 base64@1.0.3
-- 
2.3.2 (Apple Git-55)


From 7200081060bbb136ae4740299c64574c9a6bcc35 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 19:16:01 +0300
Subject: [PATCH 034/236] Step 5.5: Add routes definitions

---
 app.js | 20 ++++++++++++++++++++
 1 file changed, 20 insertions(+)

diff --git a/app.js b/app.js
index c68e970..af141a9 100644
--- a/app.js
+++ b/app.js
@@ -3,6 +3,26 @@ Parties = new Mongo.Collection("parties");
 if (Meteor.isClient) {
   angular.module('socially', ['angular-meteor', 'ui.router']);
 
+  angular.module('socially').config(['$urlRouterProvider', '$stateProvider', '$locationProvider',
+    function($urlRouterProvider, $stateProvider, $locationProvider){
+
+      $locationProvider.html5Mode(true);
+
+      $stateProvider
+        .state('parties', {
+          url: '/parties',
+          templateUrl: 'parties-list.ng.html',
+          controller: 'PartiesListCtrl'
+        })
+        .state('partyDetails', {
+          url: '/parties/:partyId',
+          templateUrl: 'party-details.ng.html',
+          controller: 'PartyDetailsCtrl'
+        });
+
+      $urlRouterProvider.otherwise("/parties");
+    }]);
+
   angular.module('socially').controller('PartiesListCtrl', ['$scope', '$meteor', function ($scope, $meteor) {
     $scope.parties = $meteor.collection(Parties);
 
-- 
2.3.2 (Apple Git-55)


From 235dc500bdedf1e408f7f4540d69e65c58a997bc Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 19:17:00 +0300
Subject: [PATCH 035/236] Step 5.6: Add party details controller

---
 app.js | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/app.js b/app.js
index af141a9..6b55a29 100644
--- a/app.js
+++ b/app.js
@@ -34,6 +34,13 @@ if (Meteor.isClient) {
       $scope.parties.remove();
     };
   }]);
+
+  angular.module("socially").controller("PartyDetailsCtrl", ['$scope', '$stateParams',
+    function($scope, $stateParams){
+
+      $scope.partyId = $stateParams.partyId;
+
+    }]);
 }
 
 if (Meteor.isServer) {
-- 
2.3.2 (Apple Git-55)


From 9c7254848a60614d7e9eb6c4d0193a63c1d0bb01 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 19:17:00 +0300
Subject: [PATCH 036/236] Step 5.6: Add party details controller

---
 app.js | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/app.js b/app.js
index af141a9..6b55a29 100644
--- a/app.js
+++ b/app.js
@@ -34,6 +34,13 @@ if (Meteor.isClient) {
       $scope.parties.remove();
     };
   }]);
+
+  angular.module("socially").controller("PartyDetailsCtrl", ['$scope', '$stateParams',
+    function($scope, $stateParams){
+
+      $scope.partyId = $stateParams.partyId;
+
+    }]);
 }
 
 if (Meteor.isServer) {
-- 
2.3.2 (Apple Git-55)


From b636a10612c4ca42b6ceee66a6bf699240bae8e4 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 19:34:52 +0300
Subject: [PATCH 037/236] Step 5.2: Create the parties list

---
 parties-list.ng.html | 32 +++++++++++++++-----------------
 1 file changed, 15 insertions(+), 17 deletions(-)

diff --git a/parties-list.ng.html b/parties-list.ng.html
index 5c567a8..2b64715 100644
--- a/parties-list.ng.html
+++ b/parties-list.ng.html
@@ -1,17 +1,15 @@
-<div ng-controller="PartiesListCtrl">
-  <form>
-    <label>Name</label>
-    <input ng-model="newParty.name">
-    <label>Description</label>
-    <input ng-model="newParty.description">
-    <button ng-click="parties.save(newParty); newParty='';">Add</button>
-    <button ng-click="removeAll()">Remove All</button>
-  </form>
-  <ul>
-    <li ng-repeat="party in parties">
-      {{party.name}}
-      <p>{{party.description}}</p>
-      <button ng-click="remove(party)">X</button>
-    </li>
-  </ul>
-</div>
+<form>
+  <label>Name</label>
+  <input ng-model="newParty.name">
+  <label>Description</label>
+  <input ng-model="newParty.description">
+  <button ng-click="parties.push(newParty)">Add</button>
+  <button ng-click="removeAll()">Remove All</button>
+</form>
+<ul>
+  <li ng-repeat="party in parties">
+    <a href="/parties/{{party._id}}">{{party.name}}</a>
+    <p>{{party.description}}</p>
+    <button ng-click="remove(party)">X</button>
+  </li>
+</ul>
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From edb3c9dd74daa5f7b5766674b9056df489e7556b Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 19:41:12 +0300
Subject: [PATCH 038/236] Step 6.1: Add $meteor.object to the controller

---
 app.js | 8 +++-----
 1 file changed, 3 insertions(+), 5 deletions(-)

diff --git a/app.js b/app.js
index 6b55a29..49a49da 100644
--- a/app.js
+++ b/app.js
@@ -35,11 +35,9 @@ if (Meteor.isClient) {
     };
   }]);
 
-  angular.module("socially").controller("PartyDetailsCtrl", ['$scope', '$stateParams',
-    function($scope, $stateParams){
-
-      $scope.partyId = $stateParams.partyId;
-
+  angular.module("socially").controller("PartyDetailsCtrl", ['$scope', '$stateParams', '$meteor',
+    function($scope, $stateParams, $meteor){
+      $scope.party = $meteor.object(Parties, $stateParams.partyId);
     }]);
 }
 
-- 
2.3.2 (Apple Git-55)


From 67af65cdf46cdbdacaa4149ecdac5115996cb642 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 19:44:09 +0300
Subject: [PATCH 039/236] Step 6.2: Add binding to the party details

---
 party-details.ng.html | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/party-details.ng.html b/party-details.ng.html
index 68fe7fe..31f8472 100644
--- a/party-details.ng.html
+++ b/party-details.ng.html
@@ -1 +1,4 @@
-Here you will see the details of party number: {{ partyId }}
\ No newline at end of file
+Here you will see and change the details of the party:
+
+<input ng-model="party.name">
+<input ng-model="party.description">
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 69fae21fa050a9cb7abaa897f296d3e0a7d3a19c Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 19:46:20 +0300
Subject: [PATCH 040/236] Step 6.3: Add some buttons to the form

---
 party-details.ng.html | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/party-details.ng.html b/party-details.ng.html
index 31f8472..52e92e7 100644
--- a/party-details.ng.html
+++ b/party-details.ng.html
@@ -1,4 +1,8 @@
 Here you will see and change the details of the party:
 
 <input ng-model="party.name">
-<input ng-model="party.description">
\ No newline at end of file
+<input ng-model="party.description">
+
+<button ng-click="save()">Save</button>
+<button ng-click="reset()">Reset form</button>
+<button ui-sref="parties">Cancel</button>
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From c402b9de91e6296aeed1dd9ad93c80f12f4fbb63 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 19:46:51 +0300
Subject: [PATCH 041/236] Step 6.4: Update the usage of $meteor.object

---
 app.js | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/app.js b/app.js
index 49a49da..98446ad 100644
--- a/app.js
+++ b/app.js
@@ -37,7 +37,7 @@ if (Meteor.isClient) {
 
   angular.module("socially").controller("PartyDetailsCtrl", ['$scope', '$stateParams', '$meteor',
     function($scope, $stateParams, $meteor){
-      $scope.party = $meteor.object(Parties, $stateParams.partyId);
+      $scope.party = $meteor.object(Parties, $stateParams.partyId, false);
     }]);
 }
 
-- 
2.3.2 (Apple Git-55)


From 24e1b389200c3ef428e483b16d1d8ab857f79489 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 19:47:13 +0300
Subject: [PATCH 042/236] Step 6.5: Add logic to the controller

---
 app.js | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/app.js b/app.js
index 98446ad..8d196ef 100644
--- a/app.js
+++ b/app.js
@@ -38,6 +38,14 @@ if (Meteor.isClient) {
   angular.module("socially").controller("PartyDetailsCtrl", ['$scope', '$stateParams', '$meteor',
     function($scope, $stateParams, $meteor){
       $scope.party = $meteor.object(Parties, $stateParams.partyId, false);
+
+      $scope.save = function() {
+        $scope.party.save();
+      };
+
+      $scope.reset = function() {
+        $scope.party.reset();
+      };
     }]);
 }
 
-- 
2.3.2 (Apple Git-55)


From f6b8b4a29b88a183116957d132adc71247ab6ee6 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 19:48:18 +0300
Subject: [PATCH 043/236] Step 6.6: Full implementation of the controller logic

---
 app.js | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/app.js b/app.js
index 8d196ef..9534a19 100644
--- a/app.js
+++ b/app.js
@@ -40,7 +40,11 @@ if (Meteor.isClient) {
       $scope.party = $meteor.object(Parties, $stateParams.partyId, false);
 
       $scope.save = function() {
-        $scope.party.save();
+        $scope.party.save().then(function(numberOfDocs){
+          console.log('save success doc affected ', numberOfDocs);
+        }, function(error){
+          console.log('save error', error);
+        });
       };
 
       $scope.reset = function() {
-- 
2.3.2 (Apple Git-55)


From f89fa42cb1089a576c3c421d5658811d8ab44317 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 19:54:24 +0300
Subject: [PATCH 044/236] Step 7.1: client/lib/app.js

---
 client/lib/app.js | 1 +
 1 file changed, 1 insertion(+)
 create mode 100644 client/lib/app.js

diff --git a/client/lib/app.js b/client/lib/app.js
new file mode 100644
index 0000000..999bdc1
--- /dev/null
+++ b/client/lib/app.js
@@ -0,0 +1 @@
+angular.module('socially',['angular-meteor', 'ui.router']);
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 2aff75501707adf1eae12e2c94af07d2b110b00c Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 20:00:58 +0300
Subject: [PATCH 045/236] Step 7.2: model/parties.js

---
 model/parties.js | 1 +
 1 file changed, 1 insertion(+)
 create mode 100644 model/parties.js

diff --git a/model/parties.js b/model/parties.js
new file mode 100644
index 0000000..dc0ccc3
--- /dev/null
+++ b/model/parties.js
@@ -0,0 +1 @@
+Parties = new Mongo.Collection("parties");
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 9742fa48ad943bb9f36ec20aa114f099e4ec96d1 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 20:04:29 +0300
Subject: [PATCH 046/236] Step 7.3: server/startup/loadParties.js

---
 server/startup/loadParties.js | 14 ++++++++++++++
 1 file changed, 14 insertions(+)
 create mode 100644 server/startup/loadParties.js

diff --git a/server/startup/loadParties.js b/server/startup/loadParties.js
new file mode 100644
index 0000000..8d3780e
--- /dev/null
+++ b/server/startup/loadParties.js
@@ -0,0 +1,14 @@
+Meteor.startup(function () {
+  if (Parties.find().count() === 0) {
+    var parties = [
+      {'name': 'Dubstep-Free Zone',
+        'description': 'Fast just got faster with Nexus S.'},
+      {'name': 'All dubstep all the time',
+        'description': 'Get it on!'},
+      {'name': 'Savage lounging',
+        'description': 'Leisure suit required. And only fiercest manners.'}
+    ];
+    for (var i = 0; i < parties.length; i++)
+      Parties.insert({name: parties[i].name, description: parties[i].description});
+  }
+});
-- 
2.3.2 (Apple Git-55)


From 9f5acfc3dc56df5bc45d1c243a9e87331e27917a Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 20:06:09 +0300
Subject: [PATCH 047/236] Step 7.4: client/routes.js

---
 client/routes.js | 19 +++++++++++++++++++
 1 file changed, 19 insertions(+)
 create mode 100644 client/routes.js

diff --git a/client/routes.js b/client/routes.js
new file mode 100644
index 0000000..1c6fcc3
--- /dev/null
+++ b/client/routes.js
@@ -0,0 +1,19 @@
+angular.module("socially").config(['$urlRouterProvider', '$stateProvider', '$locationProvider',
+  function ($urlRouterProvider, $stateProvider, $locationProvider) {
+
+    $locationProvider.html5Mode(true);
+
+    $stateProvider
+      .state('parties', {
+        url: '/parties',
+        templateUrl: 'client/parties/views/parties-list.ng.html',
+        controller: 'PartiesListCtrl'
+      })
+      .state('partyDetails', {
+        url: '/parties/:partyId',
+        templateUrl: 'client/parties/views/party-details.ng.html',
+        controller: 'PartyDetailsCtrl'
+      });
+
+    $urlRouterProvider.otherwise("/parties");
+  }]);
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 6d3bd492fb049a55bf03eae777c6d0d77dc3e0d2 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 20:07:25 +0300
Subject: [PATCH 048/236] Step 7.5: client/parties/controllers/partiesList.js

---
 client/parties/controllers/partiesList.js | 13 +++++++++++++
 1 file changed, 13 insertions(+)
 create mode 100644 client/parties/controllers/partiesList.js

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
new file mode 100644
index 0000000..888df64
--- /dev/null
+++ b/client/parties/controllers/partiesList.js
@@ -0,0 +1,13 @@
+angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor',
+  function($scope, $meteor){
+
+    $scope.parties = $meteor.collection(Parties);
+
+    $scope.remove = function(party){
+      $scope.parties.splice( $scope.parties.indexOf(party), 1 );
+    };
+
+    $scope.removeAll = function(){
+      $scope.parties.remove();
+    };
+  }]);
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 06530afc2cab3bc101f7220ffcd9653856798ec3 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 20:08:05 +0300
Subject: [PATCH 049/236] Step 7.6: client/parties/controllers/partyDetails.js

---
 client/parties/controllers/partyDetails.js | 4 ++++
 1 file changed, 4 insertions(+)
 create mode 100644 client/parties/controllers/partyDetails.js

diff --git a/client/parties/controllers/partyDetails.js b/client/parties/controllers/partyDetails.js
new file mode 100644
index 0000000..0503dab
--- /dev/null
+++ b/client/parties/controllers/partyDetails.js
@@ -0,0 +1,4 @@
+angular.module("socially").controller("PartyDetailsCtrl", ['$scope', '$stateParams', '$meteor',
+  function ($scope, $stateParams, $meteor) {
+    $scope.party = $meteor.object(Parties, $stateParams.partyId);
+  }]);
-- 
2.3.2 (Apple Git-55)


From 93583096342c6b5848866c37c60a1400b8684b3a Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 20:10:21 +0300
Subject: [PATCH 050/236] Move index.html

---
 client/index.html | 14 ++++++++++++++
 index.html        | 14 --------------
 2 files changed, 14 insertions(+), 14 deletions(-)
 create mode 100644 client/index.html
 delete mode 100644 index.html

diff --git a/client/index.html b/client/index.html
new file mode 100644
index 0000000..0fcd817
--- /dev/null
+++ b/client/index.html
@@ -0,0 +1,14 @@
+<head>
+  <base href="/">
+</head>
+<body>
+
+<div ng-app="socially">
+  <h1>
+    <a href="/parties">Home</a>
+  </h1>
+
+  <div ui-view></div>
+</div>
+
+</body>
\ No newline at end of file
diff --git a/index.html b/index.html
deleted file mode 100644
index 0fcd817..0000000
--- a/index.html
+++ /dev/null
@@ -1,14 +0,0 @@
-<head>
-  <base href="/">
-</head>
-<body>
-
-<div ng-app="socially">
-  <h1>
-    <a href="/parties">Home</a>
-  </h1>
-
-  <div ui-view></div>
-</div>
-
-</body>
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From bbbefa48ac11db7dee7014a11c1a76fd81fc1041 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 20:11:30 +0300
Subject: [PATCH 051/236] Step 7.7: client/parties/views/parties-list.ng.html

---
 client/views/parties-list.ng.html | 15 +++++++++++++++
 1 file changed, 15 insertions(+)
 create mode 100644 client/views/parties-list.ng.html

diff --git a/client/views/parties-list.ng.html b/client/views/parties-list.ng.html
new file mode 100644
index 0000000..2b64715
--- /dev/null
+++ b/client/views/parties-list.ng.html
@@ -0,0 +1,15 @@
+<form>
+  <label>Name</label>
+  <input ng-model="newParty.name">
+  <label>Description</label>
+  <input ng-model="newParty.description">
+  <button ng-click="parties.push(newParty)">Add</button>
+  <button ng-click="removeAll()">Remove All</button>
+</form>
+<ul>
+  <li ng-repeat="party in parties">
+    <a href="/parties/{{party._id}}">{{party.name}}</a>
+    <p>{{party.description}}</p>
+    <button ng-click="remove(party)">X</button>
+  </li>
+</ul>
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 01410dc154e2a7373853a63f717d10d0d6afb1e2 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 20:12:05 +0300
Subject: [PATCH 052/236] Step 7.8: client/parties/views/party-details.ng.html

---
 client/views/party-details.ng.html | 4 ++++
 1 file changed, 4 insertions(+)
 create mode 100644 client/views/party-details.ng.html

diff --git a/client/views/party-details.ng.html b/client/views/party-details.ng.html
new file mode 100644
index 0000000..31f8472
--- /dev/null
+++ b/client/views/party-details.ng.html
@@ -0,0 +1,4 @@
+Here you will see and change the details of the party:
+
+<input ng-model="party.name">
+<input ng-model="party.description">
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 923f73df40c04fc28064cc32cd54f744d6dc092d Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 20:13:14 +0300
Subject: [PATCH 053/236] Revert to old code for tutorial

---
 client/routes.js | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/client/routes.js b/client/routes.js
index 1c6fcc3..0c8d7a3 100644
--- a/client/routes.js
+++ b/client/routes.js
@@ -6,12 +6,12 @@ angular.module("socially").config(['$urlRouterProvider', '$stateProvider', '$loc
     $stateProvider
       .state('parties', {
         url: '/parties',
-        templateUrl: 'client/parties/views/parties-list.ng.html',
+        templateUrl: 'parties-list.ng.html',
         controller: 'PartiesListCtrl'
       })
       .state('partyDetails', {
         url: '/parties/:partyId',
-        templateUrl: 'client/parties/views/party-details.ng.html',
+        templateUrl: 'party-details.ng.html',
         controller: 'PartyDetailsCtrl'
       });
 
-- 
2.3.2 (Apple Git-55)


From c09c2ecffc13c1059c0f904c9227b3f465b83369 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 20:13:46 +0300
Subject: [PATCH 054/236] Step 7.9: Update templateUrl for routes

---
 client/routes.js | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/client/routes.js b/client/routes.js
index 0c8d7a3..1c6fcc3 100644
--- a/client/routes.js
+++ b/client/routes.js
@@ -6,12 +6,12 @@ angular.module("socially").config(['$urlRouterProvider', '$stateProvider', '$loc
     $stateProvider
       .state('parties', {
         url: '/parties',
-        templateUrl: 'parties-list.ng.html',
+        templateUrl: 'client/parties/views/parties-list.ng.html',
         controller: 'PartiesListCtrl'
       })
       .state('partyDetails', {
         url: '/parties/:partyId',
-        templateUrl: 'party-details.ng.html',
+        templateUrl: 'client/parties/views/party-details.ng.html',
         controller: 'PartyDetailsCtrl'
       });
 
-- 
2.3.2 (Apple Git-55)


From 0c961f8b69227097798f8d3daa9f3a3c5c825863 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 20:15:20 +0300
Subject: [PATCH 055/236] Clean up after updating the file structure

---
 app.js                                     | 71 ------------------------------
 client/parties/views/parties-list.ng.html  | 15 +++++++
 client/parties/views/party-details.ng.html |  4 ++
 client/views/parties-list.ng.html          | 15 -------
 client/views/party-details.ng.html         |  4 --
 parties-list.ng.html                       | 15 -------
 party-details.ng.html                      |  8 ----
 7 files changed, 19 insertions(+), 113 deletions(-)
 delete mode 100644 app.js
 create mode 100644 client/parties/views/parties-list.ng.html
 create mode 100644 client/parties/views/party-details.ng.html
 delete mode 100644 client/views/parties-list.ng.html
 delete mode 100644 client/views/party-details.ng.html
 delete mode 100644 parties-list.ng.html
 delete mode 100644 party-details.ng.html

diff --git a/app.js b/app.js
deleted file mode 100644
index 9534a19..0000000
--- a/app.js
+++ /dev/null
@@ -1,71 +0,0 @@
-Parties = new Mongo.Collection("parties");
-
-if (Meteor.isClient) {
-  angular.module('socially', ['angular-meteor', 'ui.router']);
-
-  angular.module('socially').config(['$urlRouterProvider', '$stateProvider', '$locationProvider',
-    function($urlRouterProvider, $stateProvider, $locationProvider){
-
-      $locationProvider.html5Mode(true);
-
-      $stateProvider
-        .state('parties', {
-          url: '/parties',
-          templateUrl: 'parties-list.ng.html',
-          controller: 'PartiesListCtrl'
-        })
-        .state('partyDetails', {
-          url: '/parties/:partyId',
-          templateUrl: 'party-details.ng.html',
-          controller: 'PartyDetailsCtrl'
-        });
-
-      $urlRouterProvider.otherwise("/parties");
-    }]);
-
-  angular.module('socially').controller('PartiesListCtrl', ['$scope', '$meteor', function ($scope, $meteor) {
-    $scope.parties = $meteor.collection(Parties);
-
-    $scope.remove = function(party){
-      $scope.parties.remove(party);
-    };
-
-    $scope.removeAll = function(){
-      $scope.parties.remove();
-    };
-  }]);
-
-  angular.module("socially").controller("PartyDetailsCtrl", ['$scope', '$stateParams', '$meteor',
-    function($scope, $stateParams, $meteor){
-      $scope.party = $meteor.object(Parties, $stateParams.partyId, false);
-
-      $scope.save = function() {
-        $scope.party.save().then(function(numberOfDocs){
-          console.log('save success doc affected ', numberOfDocs);
-        }, function(error){
-          console.log('save error', error);
-        });
-      };
-
-      $scope.reset = function() {
-        $scope.party.reset();
-      };
-    }]);
-}
-
-if (Meteor.isServer) {
-  Meteor.startup(function () {
-    if (Parties.find().count() === 0) {
-      var parties = [
-        {'name': 'Dubstep-Free Zone',
-          'description': 'Fast just got faster with Nexus S.'},
-        {'name': 'All dubstep all the time',
-          'description': 'Get it on!'},
-        {'name': 'Savage lounging',
-          'description': 'Leisure suit required. And only fiercest manners.'}
-      ];
-      for (var i = 0; i < parties.length; i++)
-        Parties.insert(parties[i]);
-    }
-  });
-}
\ No newline at end of file
diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
new file mode 100644
index 0000000..2b64715
--- /dev/null
+++ b/client/parties/views/parties-list.ng.html
@@ -0,0 +1,15 @@
+<form>
+  <label>Name</label>
+  <input ng-model="newParty.name">
+  <label>Description</label>
+  <input ng-model="newParty.description">
+  <button ng-click="parties.push(newParty)">Add</button>
+  <button ng-click="removeAll()">Remove All</button>
+</form>
+<ul>
+  <li ng-repeat="party in parties">
+    <a href="/parties/{{party._id}}">{{party.name}}</a>
+    <p>{{party.description}}</p>
+    <button ng-click="remove(party)">X</button>
+  </li>
+</ul>
\ No newline at end of file
diff --git a/client/parties/views/party-details.ng.html b/client/parties/views/party-details.ng.html
new file mode 100644
index 0000000..31f8472
--- /dev/null
+++ b/client/parties/views/party-details.ng.html
@@ -0,0 +1,4 @@
+Here you will see and change the details of the party:
+
+<input ng-model="party.name">
+<input ng-model="party.description">
\ No newline at end of file
diff --git a/client/views/parties-list.ng.html b/client/views/parties-list.ng.html
deleted file mode 100644
index 2b64715..0000000
--- a/client/views/parties-list.ng.html
+++ /dev/null
@@ -1,15 +0,0 @@
-<form>
-  <label>Name</label>
-  <input ng-model="newParty.name">
-  <label>Description</label>
-  <input ng-model="newParty.description">
-  <button ng-click="parties.push(newParty)">Add</button>
-  <button ng-click="removeAll()">Remove All</button>
-</form>
-<ul>
-  <li ng-repeat="party in parties">
-    <a href="/parties/{{party._id}}">{{party.name}}</a>
-    <p>{{party.description}}</p>
-    <button ng-click="remove(party)">X</button>
-  </li>
-</ul>
\ No newline at end of file
diff --git a/client/views/party-details.ng.html b/client/views/party-details.ng.html
deleted file mode 100644
index 31f8472..0000000
--- a/client/views/party-details.ng.html
+++ /dev/null
@@ -1,4 +0,0 @@
-Here you will see and change the details of the party:
-
-<input ng-model="party.name">
-<input ng-model="party.description">
\ No newline at end of file
diff --git a/parties-list.ng.html b/parties-list.ng.html
deleted file mode 100644
index 2b64715..0000000
--- a/parties-list.ng.html
+++ /dev/null
@@ -1,15 +0,0 @@
-<form>
-  <label>Name</label>
-  <input ng-model="newParty.name">
-  <label>Description</label>
-  <input ng-model="newParty.description">
-  <button ng-click="parties.push(newParty)">Add</button>
-  <button ng-click="removeAll()">Remove All</button>
-</form>
-<ul>
-  <li ng-repeat="party in parties">
-    <a href="/parties/{{party._id}}">{{party.name}}</a>
-    <p>{{party.description}}</p>
-    <button ng-click="remove(party)">X</button>
-  </li>
-</ul>
\ No newline at end of file
diff --git a/party-details.ng.html b/party-details.ng.html
deleted file mode 100644
index 52e92e7..0000000
--- a/party-details.ng.html
+++ /dev/null
@@ -1,8 +0,0 @@
-Here you will see and change the details of the party:
-
-<input ng-model="party.name">
-<input ng-model="party.description">
-
-<button ng-click="save()">Save</button>
-<button ng-click="reset()">Reset form</button>
-<button ui-sref="parties">Cancel</button>
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From cdc9447b3cab8bd6f57330d505b98d5b04869ddc Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 20:25:35 +0300
Subject: [PATCH 056/236] Step 8.1: Use meteor-include to load the loginButtons

---
 client/index.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/index.html b/client/index.html
index 0fcd817..136ca2f 100644
--- a/client/index.html
+++ b/client/index.html
@@ -4,10 +4,10 @@
 <body>
 
 <div ng-app="socially">
+  <meteor-include src="loginButtons"></meteor-include>
   <h1>
     <a href="/parties">Home</a>
   </h1>
-
   <div ui-view></div>
 </div>
 
-- 
2.3.2 (Apple Git-55)


From 74eb209a05581afdc4636669799f67027d2ef7a3 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 20:29:32 +0300
Subject: [PATCH 057/236] Step 8.2:  Add allow logic to the model

---
 model/parties.js | 14 +++++++++++++-
 1 file changed, 13 insertions(+), 1 deletion(-)

diff --git a/model/parties.js b/model/parties.js
index dc0ccc3..b793c1f 100644
--- a/model/parties.js
+++ b/model/parties.js
@@ -1 +1,13 @@
-Parties = new Mongo.Collection("parties");
\ No newline at end of file
+Parties = new Mongo.Collection("parties");
+
+Parties.allow({
+  insert: function (userId, party) {
+    return userId && party.owner === userId;
+  },
+  update: function (userId, party, fields, modifier) {
+    return userId && party.owner === userId;
+  },
+  remove: function (userId, party) {
+    return userId && party.owner === userId;
+  }
+});
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 9994fbc94f38136abe83fd7e6cf98e6d0d7b3de0 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 20:34:30 +0300
Subject: [PATCH 058/236] Step 8.3: Add current user to the new party

---
 client/parties/views/parties-list.ng.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index 2b64715..afbe90d 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -3,7 +3,7 @@
   <input ng-model="newParty.name">
   <label>Description</label>
   <input ng-model="newParty.description">
-  <button ng-click="parties.push(newParty)">Add</button>
+  <button ng-click="newParty.owner=$root.currentUser._id; parties.push(newParty)">Add</button>
   <button ng-click="removeAll()">Remove All</button>
 </form>
 <ul>
-- 
2.3.2 (Apple Git-55)


From 8590f52a1e3c10552aa449966dea01e78e53eb1d Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 20:37:17 +0300
Subject: [PATCH 059/236] Step 8.4: Update route

---
 client/routes.js | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/client/routes.js b/client/routes.js
index 1c6fcc3..412a40d 100644
--- a/client/routes.js
+++ b/client/routes.js
@@ -12,7 +12,12 @@ angular.module("socially").config(['$urlRouterProvider', '$stateProvider', '$loc
       .state('partyDetails', {
         url: '/parties/:partyId',
         templateUrl: 'client/parties/views/party-details.ng.html',
-        controller: 'PartyDetailsCtrl'
+        controller: 'PartyDetailsCtrl',
+        resolve: {
+          "currentUser": ["$meteor", function($meteor){
+            return $meteor.requireUser();
+          }]
+        }
       });
 
     $urlRouterProvider.otherwise("/parties");
-- 
2.3.2 (Apple Git-55)


From 695e82ec42b6445ca3b9648c153cd34e6c1031bf Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 20:41:38 +0300
Subject: [PATCH 060/236] Step 8.5: Handle case that user is not logged in

---
 client/routes.js | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/client/routes.js b/client/routes.js
index 412a40d..4626576 100644
--- a/client/routes.js
+++ b/client/routes.js
@@ -1,3 +1,13 @@
+angular.module("socially").run(["$rootScope", "$location", function($rootScope, $state) {
+  $rootScope.$on("$stateChangeError", function(event, next, previous, error) {
+    // We can catch the error thrown when the $requireUser promise is rejected
+    // and redirect the user back to the main page
+    if (error === "AUTH_REQUIRED") {
+      $state.go("/parties");
+    }
+  });
+}]);
+
 angular.module("socially").config(['$urlRouterProvider', '$stateProvider', '$locationProvider',
   function ($urlRouterProvider, $stateProvider, $locationProvider) {
 
-- 
2.3.2 (Apple Git-55)


From 93440d42cf252836c69bed3b293b2a170ef38fad Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 20:46:35 +0300
Subject: [PATCH 061/236] Update packages

---
 .meteor/packages |  5 ++++-
 .meteor/versions | 20 +++++++++++++++++++-
 2 files changed, 23 insertions(+), 2 deletions(-)

diff --git a/.meteor/packages b/.meteor/packages
index bcf70e4..92948f5 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -6,6 +6,9 @@
 
 meteor-platform
 autopublish
-insecure
 urigo:angular
 angularui:angular-ui-router
+accounts-password
+accounts-ui
+accounts-facebook
+accounts-twitter
diff --git a/.meteor/versions b/.meteor/versions
index fd36a32..5ff8a6b 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -1,3 +1,10 @@
+accounts-base@1.2.0
+accounts-facebook@1.0.4
+accounts-oauth@1.1.5
+accounts-password@1.1.1
+accounts-twitter@1.0.4
+accounts-ui@1.1.5
+accounts-ui-unstyled@1.1.7
 angular:angular@1.4.4
 angularui:angular-ui-router@0.2.15
 autopublish@1.0.3
@@ -13,18 +20,21 @@ dburles:mongo-collection-instances@0.3.4
 ddp@1.1.0
 deps@1.0.7
 ejson@1.0.6
+email@1.0.6
+facebook@1.2.0
 fastclick@1.0.3
 geojson-utils@1.0.3
 html-tools@1.0.4
 htmljs@1.0.4
 http@1.1.0
 id-map@1.0.3
-insecure@1.0.3
 jquery@1.11.3_2
 json@1.0.3
 lai:collection-extensions@0.1.4
 launch-screen@1.0.2
+less@1.0.14
 livedata@1.0.13
+localstorage@1.0.3
 logging@1.0.7
 meteor@1.1.6
 meteor-platform@1.2.2
@@ -32,6 +42,10 @@ minifiers@1.1.5
 minimongo@1.0.8
 mobile-status-bar@1.0.3
 mongo@1.1.0
+npm-bcrypt@0.7.8_2
+oauth@1.1.4
+oauth1@1.1.4
+oauth2@1.1.3
 observe-sequence@1.0.6
 ordered-dict@1.0.3
 random@1.0.3
@@ -40,11 +54,15 @@ reactive-var@1.0.5
 reload@1.1.3
 retry@1.0.3
 routepolicy@1.0.5
+service-configuration@1.0.4
 session@1.1.0
+sha@1.0.3
 spacebars@1.0.6
 spacebars-compiler@1.0.6
+srp@1.0.3
 templating@1.1.1
 tracker@1.0.7
+twitter@1.1.4
 ui@1.0.6
 underscore@1.0.3
 urigo:angular@0.9.3
-- 
2.3.2 (Apple Git-55)


From 163cfba1579fc13dbe08c410bcf01542990131f0 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 20:50:23 +0300
Subject: [PATCH 062/236] Step 9.1: Usage of publish method

---
 server/parties.js | 13 +++++++++++++
 1 file changed, 13 insertions(+)
 create mode 100644 server/parties.js

diff --git a/server/parties.js b/server/parties.js
new file mode 100644
index 0000000..277f09a
--- /dev/null
+++ b/server/parties.js
@@ -0,0 +1,13 @@
+Meteor.publish("parties", function () {
+  return Parties.find({
+    $or:[
+      {$and:[
+        {"public": true},
+        {"public": {$exists: true}}
+      ]},
+      {$and:[
+        {owner: this.userId},
+        {owner: {$exists: true}}
+      ]}
+    ]});
+});
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 280db6da1b96472cc0ee7484acf04a607e070f9c Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 20:53:15 +0300
Subject: [PATCH 063/236] Step 9.2: Use "subscribe" function on the scope

---
 client/parties/controllers/partiesList.js | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index 888df64..e0f806b 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -1,7 +1,7 @@
 angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor',
   function($scope, $meteor){
 
-    $scope.parties = $meteor.collection(Parties);
+    $scope.parties = $meteor.collection(Parties).subscribe('parties');
 
     $scope.remove = function(party){
       $scope.parties.splice( $scope.parties.indexOf(party), 1 );
-- 
2.3.2 (Apple Git-55)


From 4fc9ffbeab1991686a5db64e4f952a40f8539472 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:00:41 +0300
Subject: [PATCH 064/236] Step 9.3: Add checkbox for public party

---
 client/parties/views/parties-list.ng.html | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index afbe90d..ca956ea 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -3,6 +3,8 @@
   <input ng-model="newParty.name">
   <label>Description</label>
   <input ng-model="newParty.description">
+  <label>Public</label>
+  <input type="checkbox" ng-model="newParty.public">
   <button ng-click="newParty.owner=$root.currentUser._id; parties.push(newParty)">Add</button>
   <button ng-click="removeAll()">Remove All</button>
 </form>
-- 
2.3.2 (Apple Git-55)


From ce4d832840acbb1f2d093dabb6cfabfa8e835f25 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:03:38 +0300
Subject: [PATCH 065/236] Step 9.4: Add checkbox for public party in the
 details

---
 client/parties/views/party-details.ng.html | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/client/parties/views/party-details.ng.html b/client/parties/views/party-details.ng.html
index 31f8472..f798477 100644
--- a/client/parties/views/party-details.ng.html
+++ b/client/parties/views/party-details.ng.html
@@ -1,4 +1,6 @@
 Here you will see and change the details of the party:
 
 <input ng-model="party.name">
-<input ng-model="party.description">
\ No newline at end of file
+<input ng-model="party.description">
+<label>Is public</label>
+<input type="checkbox" ng-model="party.public">
-- 
2.3.2 (Apple Git-55)


From 80280fbdf74ba34ee8faae9931354e9e09cf661c Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:04:57 +0300
Subject: [PATCH 066/236] Step 9.5: Publish the users collection

---
 server/users.js | 3 +++
 1 file changed, 3 insertions(+)
 create mode 100644 server/users.js

diff --git a/server/users.js b/server/users.js
new file mode 100644
index 0000000..f5becea
--- /dev/null
+++ b/server/users.js
@@ -0,0 +1,3 @@
+Meteor.publish("users", function () {
+  return Meteor.users.find({}, {fields: {emails: 1, profile: 1}});
+});
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 16d8d5dd2d585eea05f09261a23688fa24b65c3b Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:06:51 +0300
Subject: [PATCH 067/236] Step 9.6: Subscribe to the users collection

---
 client/parties/controllers/partyDetails.js | 1 +
 1 file changed, 1 insertion(+)

diff --git a/client/parties/controllers/partyDetails.js b/client/parties/controllers/partyDetails.js
index 0503dab..7ac734b 100644
--- a/client/parties/controllers/partyDetails.js
+++ b/client/parties/controllers/partyDetails.js
@@ -1,4 +1,5 @@
 angular.module("socially").controller("PartyDetailsCtrl", ['$scope', '$stateParams', '$meteor',
   function ($scope, $stateParams, $meteor) {
     $scope.party = $meteor.object(Parties, $stateParams.partyId);
+    $scope.users = $meteor.collection(Meteor.users, false).subscribe('users');
   }]);
-- 
2.3.2 (Apple Git-55)


From 1480c36e8e78b339e501c0baad8a559311d232ef Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:08:09 +0300
Subject: [PATCH 068/236] Step 9.7: Subscribe to the parties collection

---
 client/parties/controllers/partyDetails.js | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/parties/controllers/partyDetails.js b/client/parties/controllers/partyDetails.js
index 7ac734b..a65cabc 100644
--- a/client/parties/controllers/partyDetails.js
+++ b/client/parties/controllers/partyDetails.js
@@ -1,5 +1,5 @@
 angular.module("socially").controller("PartyDetailsCtrl", ['$scope', '$stateParams', '$meteor',
   function ($scope, $stateParams, $meteor) {
-    $scope.party = $meteor.object(Parties, $stateParams.partyId);
+    $scope.party = $meteor.object(Parties, $stateParams.partyId).subscribe('parties');
     $scope.users = $meteor.collection(Meteor.users, false).subscribe('users');
   }]);
-- 
2.3.2 (Apple Git-55)


From 001543c981ec611fdc9f0b4f9b295833422559cd Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:09:09 +0300
Subject: [PATCH 069/236] Step 9.8: Add the user details

---
 client/parties/views/party-details.ng.html | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/client/parties/views/party-details.ng.html b/client/parties/views/party-details.ng.html
index f798477..a640092 100644
--- a/client/parties/views/party-details.ng.html
+++ b/client/parties/views/party-details.ng.html
@@ -4,3 +4,10 @@ Here you will see and change the details of the party:
 <input ng-model="party.description">
 <label>Is public</label>
 <input type="checkbox" ng-model="party.public">
+
+<ul>
+  Users:
+  <li ng-repeat="user in users">
+    <div>{{ user.emails[0].address }}</div>
+  </li>
+</ul>
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From a3367ec45102090e37eaa1a0bfe1ff61e3883240 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:13:54 +0300
Subject: [PATCH 070/236] Step 11.1: Update the module initialization

---
 client/lib/app.js | 11 ++++++++++-
 1 file changed, 10 insertions(+), 1 deletion(-)

diff --git a/client/lib/app.js b/client/lib/app.js
index 999bdc1..436212a 100644
--- a/client/lib/app.js
+++ b/client/lib/app.js
@@ -1 +1,10 @@
-angular.module('socially',['angular-meteor', 'ui.router']);
\ No newline at end of file
+angular.module('socially',['angular-meteor', 'ui.router']);
+
+function onReady() {
+  angular.bootstrap(document, ['socially']);
+}
+
+if (Meteor.isCordova)
+  angular.element(document).on("deviceready", onReady);
+else
+  angular.element(document).ready(onReady);
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From f8be41d7694488cd38ec4b173eb98f2b9422bfeb Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:16:29 +0300
Subject: [PATCH 071/236] Step 11.2: Remove the ng-app directive

---
 client/index.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/index.html b/client/index.html
index 136ca2f..d0ba166 100644
--- a/client/index.html
+++ b/client/index.html
@@ -3,7 +3,7 @@
 </head>
 <body>
 
-<div ng-app="socially">
+<div>
   <meteor-include src="loginButtons"></meteor-include>
   <h1>
     <a href="/parties">Home</a>
-- 
2.3.2 (Apple Git-55)


From 3f48e20d255ad2baa64d443a231f68e5b03c94f0 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:17:49 +0300
Subject: [PATCH 072/236] Update packages

---
 .meteor/packages | 1 -
 .meteor/versions | 1 -
 2 files changed, 2 deletions(-)

diff --git a/.meteor/packages b/.meteor/packages
index 92948f5..b462d6f 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -5,7 +5,6 @@
 # but you can also edit it by hand.
 
 meteor-platform
-autopublish
 urigo:angular
 angularui:angular-ui-router
 accounts-password
diff --git a/.meteor/versions b/.meteor/versions
index 5ff8a6b..58b2863 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -7,7 +7,6 @@ accounts-ui@1.1.5
 accounts-ui-unstyled@1.1.7
 angular:angular@1.4.4
 angularui:angular-ui-router@0.2.15
-autopublish@1.0.3
 autoupdate@1.2.1
 base64@1.0.3
 binary-heap@1.0.3
-- 
2.3.2 (Apple Git-55)


From f7723e2f8d7d96f3aaeff3de3e55db5626b76b43 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:20:14 +0300
Subject: [PATCH 073/236] Step 12.1: Add options to the parties publish

---
 server/parties.js | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/server/parties.js b/server/parties.js
index 277f09a..663bcd8 100644
--- a/server/parties.js
+++ b/server/parties.js
@@ -1,4 +1,4 @@
-Meteor.publish("parties", function () {
+Meteor.publish("parties", function (options) {
   return Parties.find({
     $or:[
       {$and:[
@@ -9,5 +9,5 @@ Meteor.publish("parties", function () {
         {owner: this.userId},
         {owner: {$exists: true}}
       ]}
-    ]});
+    ]}, options);
 });
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From a94894364c89ffc9659b7c7abfd1ad9d31bae2cc Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:23:07 +0300
Subject: [PATCH 074/236] Step 12.2: Add the sorting params to the scope

---
 client/parties/controllers/partiesList.js | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index e0f806b..c2c8136 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -1,6 +1,10 @@
 angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor',
   function($scope, $meteor){
 
+    $scope.page = 1;
+    $scope.perPage = 3;
+    $scope.sort = { name: 1 };
+
     $scope.parties = $meteor.collection(Parties).subscribe('parties');
 
     $scope.remove = function(party){
-- 
2.3.2 (Apple Git-55)


From f62ed04412ec91f20f9f3597b0498d9760379589 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:25:07 +0300
Subject: [PATCH 075/236] Step 12.3: Separate the collection and the subscribe

---
 client/parties/controllers/partiesList.js | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index c2c8136..30e37d9 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -5,7 +5,8 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor',
     $scope.perPage = 3;
     $scope.sort = { name: 1 };
 
-    $scope.parties = $meteor.collection(Parties).subscribe('parties');
+    $scope.parties = $meteor.collection(Parties);
+    $meteor.subscribe('parties');
 
     $scope.remove = function(party){
       $scope.parties.splice( $scope.parties.indexOf(party), 1 );
-- 
2.3.2 (Apple Git-55)


From 0d609c440565f58d059944d3c38d7e2469b922b7 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:25:32 +0300
Subject: [PATCH 076/236] Step 12.4: Add the params to the subscribe

---
 client/parties/controllers/partiesList.js | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index 30e37d9..311ed73 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -6,7 +6,11 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor',
     $scope.sort = { name: 1 };
 
     $scope.parties = $meteor.collection(Parties);
-    $meteor.subscribe('parties');
+    $meteor.subscribe('parties', {
+      limit: parseInt($scope.perPage),
+      skip: parseInt(($scope.page - 1) * $scope.perPage),
+      sort: $scope.sort
+    });
 
     $scope.remove = function(party){
       $scope.parties.splice( $scope.parties.indexOf(party), 1 );
-- 
2.3.2 (Apple Git-55)


From 605aa4ecca02c705887b963db8ec057f08b8dec5 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:26:26 +0300
Subject: [PATCH 077/236] Step 12.5: Replace the Parties collection with cursor

---
 client/parties/controllers/partiesList.js | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index 311ed73..54727b6 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -5,7 +5,12 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor',
     $scope.perPage = 3;
     $scope.sort = { name: 1 };
 
-    $scope.parties = $meteor.collection(Parties);
+    $scope.parties = $meteor.collection(function() {
+      return Parties.find({}, {
+        sort : $scope.sort
+      });
+    });
+
     $meteor.subscribe('parties', {
       limit: parseInt($scope.perPage),
       skip: parseInt(($scope.page - 1) * $scope.perPage),
-- 
2.3.2 (Apple Git-55)


From 4d79f552972f6ea6601b21378989382df6867ddc Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:32:41 +0300
Subject: [PATCH 078/236] Step 12.6: Add the pagination module

---
 client/lib/app.js | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/lib/app.js b/client/lib/app.js
index 436212a..79b962b 100644
--- a/client/lib/app.js
+++ b/client/lib/app.js
@@ -1,4 +1,4 @@
-angular.module('socially',['angular-meteor', 'ui.router']);
+angular.module('socially',['angular-meteor', 'ui.router', 'angularUtils.directives.dirPagination']);
 
 function onReady() {
   angular.bootstrap(document, ['socially']);
-- 
2.3.2 (Apple Git-55)


From 138a048dae558140ac2394ac5e09439f6cb74077 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:33:26 +0300
Subject: [PATCH 079/236] Step 12.7: Use the pagination directive

---
 client/parties/views/parties-list.ng.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index ca956ea..806534f 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -9,7 +9,7 @@
   <button ng-click="removeAll()">Remove All</button>
 </form>
 <ul>
-  <li ng-repeat="party in parties">
+  <li dir-paginate="party in parties | itemsPerPage: perPage" total-items="partiesCount.count">
     <a href="/parties/{{party._id}}">{{party.name}}</a>
     <p>{{party.description}}</p>
     <button ng-click="remove(party)">X</button>
-- 
2.3.2 (Apple Git-55)


From e408bbaac9161d6ab2f3bb60438c45997fc6d565 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:33:51 +0300
Subject: [PATCH 080/236] Step 12.8: Add the pagination controls

---
 client/parties/views/parties-list.ng.html | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index 806534f..1041916 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -14,4 +14,5 @@
     <p>{{party.description}}</p>
     <button ng-click="remove(party)">X</button>
   </li>
-</ul>
\ No newline at end of file
+</ul>
+<dir-pagination-controls on-page-change="pageChanged(newPageNumber)"></dir-pagination-controls>
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From a00ab08e3e953f91d23097ca23baf4b80c2417fe Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:35:01 +0300
Subject: [PATCH 081/236] Step 12.9: Add function to handle the page change

---
 client/parties/controllers/partiesList.js | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index 54727b6..7549424 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -24,4 +24,8 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor',
     $scope.removeAll = function(){
       $scope.parties.remove();
     };
+
+    $scope.pageChanged = function(newPage) {
+      $scope.page = newPage;
+    };
   }]);
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From f6e3d8c945485eff662f7bf5003eec9ac3cf410c Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:38:00 +0300
Subject: [PATCH 082/236] Step 12.10: Add parties count publish

---
 server/parties.js | 12 ++++++++++++
 1 file changed, 12 insertions(+)

diff --git a/server/parties.js b/server/parties.js
index 663bcd8..9622905 100644
--- a/server/parties.js
+++ b/server/parties.js
@@ -1,4 +1,16 @@
 Meteor.publish("parties", function (options) {
+  Counts.publish(this, 'numberOfParties', Parties.find({
+    $or:[
+      {$and:[
+        {'public': true},
+        {'public': {$exists: true}}
+      ]},
+      {$and:[
+        {owner: this.userId},
+        {owner: {$exists: true}}
+      ]}
+    ]}), { noReady: true });
+
   return Parties.find({
     $or:[
       {$and:[
-- 
2.3.2 (Apple Git-55)


From 2bf8b504d9cda45a1a7510b572d429c9058906c9 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:40:14 +0300
Subject: [PATCH 083/236] Step 12.11: Add parties count to the client

---
 client/parties/controllers/partiesList.js | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index 7549424..8251b94 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -15,6 +15,8 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor',
       limit: parseInt($scope.perPage),
       skip: parseInt(($scope.page - 1) * $scope.perPage),
       sort: $scope.sort
+    }).then(function(){
+      $scope.partiesCount = $meteor.object(Counts ,'numberOfParties', false);
     });
 
     $scope.remove = function(party){
-- 
2.3.2 (Apple Git-55)


From 96f7efbd839e0b3cfab9cf35d9fa83e5928113b7 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:41:19 +0300
Subject: [PATCH 084/236] Step 12.12: Add autorun to wrap the subscribe

---
 client/parties/controllers/partiesList.js | 14 ++++++++------
 1 file changed, 8 insertions(+), 6 deletions(-)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index 8251b94..251320d 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -11,12 +11,14 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor',
       });
     });
 
-    $meteor.subscribe('parties', {
-      limit: parseInt($scope.perPage),
-      skip: parseInt(($scope.page - 1) * $scope.perPage),
-      sort: $scope.sort
-    }).then(function(){
-      $scope.partiesCount = $meteor.object(Counts ,'numberOfParties', false);
+    $meteor.autorun($scope, function() {
+      $meteor.subscribe('parties', {
+        limit: parseInt($scope.perPage),
+        skip: parseInt(($scope.page - 1) * $scope.perPage),
+        sort: $scope.sort
+      }).then(function(){
+        $scope.partiesCount = $meteor.object(Counts ,'numberOfParties', false);
+      });
     });
 
     $scope.remove = function(party){
-- 
2.3.2 (Apple Git-55)


From 56559d02e897d897348002d4872f5403123bf247 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:41:47 +0300
Subject: [PATCH 085/236] Step 12.13: Added usage of getReactivly

---
 client/parties/controllers/partiesList.js | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index 251320d..51dd62d 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -13,9 +13,9 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor',
 
     $meteor.autorun($scope, function() {
       $meteor.subscribe('parties', {
-        limit: parseInt($scope.perPage),
-        skip: parseInt(($scope.page - 1) * $scope.perPage),
-        sort: $scope.sort
+        limit: parseInt($scope.getReactively('perPage')),
+        skip: (parseInt($scope.getReactively('page')) - 1) * parseInt($scope.getReactively('perPage')),
+        sort: $scope.getReactively('sort')
       }).then(function(){
         $scope.partiesCount = $meteor.object(Counts ,'numberOfParties', false);
       });
-- 
2.3.2 (Apple Git-55)


From 4a1070a1aa95f8b352114343863c7e0a595b7f72 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:43:10 +0300
Subject: [PATCH 086/236] Step 12.14: Added usage of getReactivly to the
 collection

---
 client/parties/controllers/partiesList.js | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index 51dd62d..6df313b 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -7,7 +7,7 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor',
 
     $scope.parties = $meteor.collection(function() {
       return Parties.find({}, {
-        sort : $scope.sort
+        sort : $scope.getReactively('sort')
       });
     });
 
-- 
2.3.2 (Apple Git-55)


From 3b5e183e2f7890bfcf2b1262c1146830afc55f24 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:43:45 +0300
Subject: [PATCH 087/236] Step 12.15: Add sort controls to the view

---
 client/parties/views/parties-list.ng.html | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index 1041916..3d39e49 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -9,6 +9,13 @@
   <button ng-click="removeAll()">Remove All</button>
 </form>
 <ul>
+  <h1>Parties:</h1>
+  <div>
+    <select ng-model="orderProperty">
+      <option value="1">Ascending</option>
+      <option value="-1">Descending</option>
+    </select>
+  </div>
   <li dir-paginate="party in parties | itemsPerPage: perPage" total-items="partiesCount.count">
     <a href="/parties/{{party._id}}">{{party.name}}</a>
     <p>{{party.description}}</p>
-- 
2.3.2 (Apple Git-55)


From 928a97f83834eeee4039c0f3384b41b5f3a661f6 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:44:25 +0300
Subject: [PATCH 088/236] Step 12.16: Add order logic to the client

---
 client/parties/controllers/partiesList.js | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index 6df313b..d3ba0ae 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -32,4 +32,9 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor',
     $scope.pageChanged = function(newPage) {
       $scope.page = newPage;
     };
+
+    $scope.$watch('orderProperty', function(){
+      if ($scope.orderProperty)
+        $scope.sort = {name: parseInt($scope.orderProperty)};
+    });
   }]);
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 2eff59cab86ab27209e6ddcb05256ebcafd7ab04 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:46:02 +0300
Subject: [PATCH 089/236] Step 12.17: Add default sort definition

---
 client/parties/controllers/partiesList.js | 1 +
 1 file changed, 1 insertion(+)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index d3ba0ae..c375d15 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -4,6 +4,7 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor',
     $scope.page = 1;
     $scope.perPage = 3;
     $scope.sort = { name: 1 };
+    $scope.orderProperty = '1';
 
     $scope.parties = $meteor.collection(function() {
       return Parties.find({}, {
-- 
2.3.2 (Apple Git-55)


From b73bee25d975837eb0cca69cf0604dc8cb7a5c0b Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:48:55 +0300
Subject: [PATCH 090/236] Step 12.18: Add search string to the collection

---
 server/parties.js | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/server/parties.js b/server/parties.js
index 9622905..5366910 100644
--- a/server/parties.js
+++ b/server/parties.js
@@ -1,4 +1,4 @@
-Meteor.publish("parties", function (options) {
+Meteor.publish("parties", function (options, searchString) {
   Counts.publish(this, 'numberOfParties', Parties.find({
     $or:[
       {$and:[
-- 
2.3.2 (Apple Git-55)


From 6e61a8fefb76966cc4cf9373d5e2545a950724cd Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:50:07 +0300
Subject: [PATCH 091/236] Step 12.19: Add the search logic

---
 server/parties.js | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/server/parties.js b/server/parties.js
index 5366910..c2dc88b 100644
--- a/server/parties.js
+++ b/server/parties.js
@@ -1,5 +1,9 @@
 Meteor.publish("parties", function (options, searchString) {
+  if (searchString == null)
+    searchString = '';
+
   Counts.publish(this, 'numberOfParties', Parties.find({
+    'name' : { '$regex' : '.*' + searchString || '' + '.*', '$options' : 'i' },
     $or:[
       {$and:[
         {'public': true},
@@ -12,6 +16,7 @@ Meteor.publish("parties", function (options, searchString) {
     ]}), { noReady: true });
 
   return Parties.find({
+    'name' : { '$regex' : '.*' + searchString || '' + '.*', '$options' : 'i' },
     $or:[
       {$and:[
         {"public": true},
-- 
2.3.2 (Apple Git-55)


From 5cd165ebd28e37fbee8a74334630ed3f92486f8b Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:51:56 +0300
Subject: [PATCH 092/236] Step 12.20: Add the search input

---
 client/parties/views/parties-list.ng.html | 1 +
 1 file changed, 1 insertion(+)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index 3d39e49..e5fd486 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -11,6 +11,7 @@
 <ul>
   <h1>Parties:</h1>
   <div>
+    <input type="search" ng-model="search" placeholder="Search">
     <select ng-model="orderProperty">
       <option value="1">Ascending</option>
       <option value="-1">Descending</option>
-- 
2.3.2 (Apple Git-55)


From ec1a9a6079eb6d5d5845d35875a8feeed95d1241 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:52:39 +0300
Subject: [PATCH 093/236] Step 12.21: Add the search param to the subscribe

---
 client/parties/controllers/partiesList.js | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index c375d15..2423087 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -17,7 +17,7 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor',
         limit: parseInt($scope.getReactively('perPage')),
         skip: (parseInt($scope.getReactively('page')) - 1) * parseInt($scope.getReactively('perPage')),
         sort: $scope.getReactively('sort')
-      }).then(function(){
+      }, $scope.getReactively('search')).then(function() {
         $scope.partiesCount = $meteor.object(Counts ,'numberOfParties', false);
       });
     });
-- 
2.3.2 (Apple Git-55)


From fcc186b7c231a3c66739f3c6c2a3e3d032d7be11 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:55:28 +0300
Subject: [PATCH 094/236] Step 12.22: Remove the subscription from the object

---
 client/parties/controllers/partyDetails.js | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/parties/controllers/partyDetails.js b/client/parties/controllers/partyDetails.js
index a65cabc..7ac734b 100644
--- a/client/parties/controllers/partyDetails.js
+++ b/client/parties/controllers/partyDetails.js
@@ -1,5 +1,5 @@
 angular.module("socially").controller("PartyDetailsCtrl", ['$scope', '$stateParams', '$meteor',
   function ($scope, $stateParams, $meteor) {
-    $scope.party = $meteor.object(Parties, $stateParams.partyId).subscribe('parties');
+    $scope.party = $meteor.object(Parties, $stateParams.partyId);
     $scope.users = $meteor.collection(Meteor.users, false).subscribe('users');
   }]);
-- 
2.3.2 (Apple Git-55)


From 37edf3df5549a3b68002640d19a9343056134e9b Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:56:02 +0300
Subject: [PATCH 095/236] Step 12.23: Add $scope subscription to the collection

---
 client/parties/controllers/partyDetails.js | 1 +
 1 file changed, 1 insertion(+)

diff --git a/client/parties/controllers/partyDetails.js b/client/parties/controllers/partyDetails.js
index 7ac734b..4cfb48d 100644
--- a/client/parties/controllers/partyDetails.js
+++ b/client/parties/controllers/partyDetails.js
@@ -2,4 +2,5 @@ angular.module("socially").controller("PartyDetailsCtrl", ['$scope', '$statePara
   function ($scope, $stateParams, $meteor) {
     $scope.party = $meteor.object(Parties, $stateParams.partyId);
     $scope.users = $meteor.collection(Meteor.users, false).subscribe('users');
+    $scope.$meteorSubscribe('parties');
   }]);
-- 
2.3.2 (Apple Git-55)


From 511e35f01a655e2176f49e39bb2bdb0d3b92b9cb Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:57:59 +0300
Subject: [PATCH 096/236] Step 13.1: Create the filter

---
 client/parties/filters/uninvited.js | 14 ++++++++++++++
 1 file changed, 14 insertions(+)
 create mode 100644 client/parties/filters/uninvited.js

diff --git a/client/parties/filters/uninvited.js b/client/parties/filters/uninvited.js
new file mode 100644
index 0000000..9166e47
--- /dev/null
+++ b/client/parties/filters/uninvited.js
@@ -0,0 +1,14 @@
+angular.module('socially').filter('uninvited', function () {
+  return function (users, party) {
+    if (!party)
+      return false;
+
+    return _.filter(users, function (user) {
+      if (user._id == party.owner ||
+        _.contains(party.invited, user._id))
+        return false;
+      else
+        return true;
+    });
+  }
+});
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 7d9fba302b0de05a1cf8d3ab5c75cf15293d115d Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 21:59:45 +0300
Subject: [PATCH 097/236] Step 13.2: Use the filter

---
 client/parties/views/party-details.ng.html | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/client/parties/views/party-details.ng.html b/client/parties/views/party-details.ng.html
index a640092..5ab9471 100644
--- a/client/parties/views/party-details.ng.html
+++ b/client/parties/views/party-details.ng.html
@@ -6,8 +6,8 @@ Here you will see and change the details of the party:
 <input type="checkbox" ng-model="party.public">
 
 <ul>
-  Users:
-  <li ng-repeat="user in users">
+  Users to invite:
+  <li ng-repeat="user in users | uninvited:party">
     <div>{{ user.emails[0].address }}</div>
   </li>
 </ul>
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 34355f602202e45db0aa2a89120c4e614fc21b9a Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:00:48 +0300
Subject: [PATCH 098/236] Step 13.3: Use filter to display user details

---
 client/parties/views/party-details.ng.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/parties/views/party-details.ng.html b/client/parties/views/party-details.ng.html
index 5ab9471..4642f74 100644
--- a/client/parties/views/party-details.ng.html
+++ b/client/parties/views/party-details.ng.html
@@ -8,6 +8,6 @@ Here you will see and change the details of the party:
 <ul>
   Users to invite:
   <li ng-repeat="user in users | uninvited:party">
-    <div>{{ user.emails[0].address }}</div>
+    <div>{{ user | displayName }}</div>
   </li>
 </ul>
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 475b5dafc06399894b2b3cdca4fe70d3c26d2b90 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:01:22 +0300
Subject: [PATCH 099/236] Step 13.4: Create the displayName filter

---
 client/parties/filters/displayName.js | 12 ++++++++++++
 1 file changed, 12 insertions(+)
 create mode 100644 client/parties/filters/displayName.js

diff --git a/client/parties/filters/displayName.js b/client/parties/filters/displayName.js
new file mode 100644
index 0000000..162f496
--- /dev/null
+++ b/client/parties/filters/displayName.js
@@ -0,0 +1,12 @@
+angular.module('socially').filter('displayName', function () {
+  return function (user) {
+    if (!user)
+      return;
+    if (user.profile && user.profile.name)
+      return user.profile.name;
+    else if (user.emails)
+      return user.emails[0].address;
+    else
+      return user;
+  }
+});
-- 
2.3.2 (Apple Git-55)


From 13098aa1c6b3012eb9418ed86efa876a3edb7801 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:05:24 +0300
Subject: [PATCH 100/236] Step 13.5: Added user details

---
 client/parties/views/parties-list.ng.html | 1 +
 1 file changed, 1 insertion(+)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index e5fd486..d3cc5e0 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -21,6 +21,7 @@
     <a href="/parties/{{party._id}}">{{party.name}}</a>
     <p>{{party.description}}</p>
     <button ng-click="remove(party)">X</button>
+    <p><small>Posted by {{ creator(party) | displayName }}</small></p>
   </li>
 </ul>
 <dir-pagination-controls on-page-change="pageChanged(newPageNumber)"></dir-pagination-controls>
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From fc6798f40120dc31224535ef74a7af012caa09f5 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:07:30 +0300
Subject: [PATCH 101/236] Step 13.6: Added the logic to the controller

---
 client/parties/controllers/partiesList.js | 23 +++++++++++++++++++++--
 1 file changed, 21 insertions(+), 2 deletions(-)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index 2423087..00852a7 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -1,5 +1,5 @@
-angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor',
-  function($scope, $meteor){
+angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '$rootScope',
+  function($scope, $meteor, $rootScope){
 
     $scope.page = 1;
     $scope.perPage = 3;
@@ -38,4 +38,23 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor',
       if ($scope.orderProperty)
         $scope.sort = {name: parseInt($scope.orderProperty)};
     });
+
+    $scope.getUserById = function(userId){
+      return Meteor.users.findOne(userId);
+    };
+
+    $scope.creator = function(party){
+      if (!party)
+        return;
+      var owner = $scope.getUserById(party.owner);
+      if (!owner)
+        return 'nobody';
+
+      if ($rootScope.currentUser)
+        if ($rootScope.currentUser._id)
+          if (owner._id === $rootScope.currentUser._id)
+            return 'me';
+
+      return owner;
+    };
   }]);
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From b153a3bc34eb813ea358311d9175a31945dabcbf Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:12:01 +0300
Subject: [PATCH 102/236] Step 13.5: Added user details

---
 client/parties/views/parties-list.ng.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index d3cc5e0..3d05a0e 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -21,7 +21,7 @@
     <a href="/parties/{{party._id}}">{{party.name}}</a>
     <p>{{party.description}}</p>
     <button ng-click="remove(party)">X</button>
-    <p><small>Posted by {{ creator(party) | displayName }}</small></p>
+    <p><small>Posted by {{ creator(party) }}</small></p>
   </li>
 </ul>
 <dir-pagination-controls on-page-change="pageChanged(newPageNumber)"></dir-pagination-controls>
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From c62a6b3649d30d4008c4704d31e055d1e9f46c94 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:13:18 +0300
Subject: [PATCH 103/236] Step 13.7: Added subscribe to the users collection

---
 client/parties/controllers/partiesList.js | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index 00852a7..afdef32 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -6,6 +6,8 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '
     $scope.sort = { name: 1 };
     $scope.orderProperty = '1';
 
+    $scope.$meteorSubscribe('users');
+
     $scope.parties = $meteor.collection(function() {
       return Parties.find({}, {
         sort : $scope.getReactively('sort')
-- 
2.3.2 (Apple Git-55)


From 873c86c550722cff8dd6d400f4b9a5f9d7cf5b2f Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:13:48 +0300
Subject: [PATCH 104/236] Step 13.8: Use filter to display the user info

---
 client/parties/views/parties-list.ng.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index 3d05a0e..d3cc5e0 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -21,7 +21,7 @@
     <a href="/parties/{{party._id}}">{{party.name}}</a>
     <p>{{party.description}}</p>
     <button ng-click="remove(party)">X</button>
-    <p><small>Posted by {{ creator(party) }}</small></p>
+    <p><small>Posted by {{ creator(party) | displayName }}</small></p>
   </li>
 </ul>
 <dir-pagination-controls on-page-change="pageChanged(newPageNumber)"></dir-pagination-controls>
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 61fdd96b343472bb99141756ce7134fd237eef45 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:17:32 +0300
Subject: [PATCH 105/236] Update packages and clean up old code

---
 .meteor/packages              |  2 ++
 .meteor/versions              |  2 ++
 server/startup/loadParties.js | 14 --------------
 3 files changed, 4 insertions(+), 14 deletions(-)
 delete mode 100644 server/startup/loadParties.js

diff --git a/.meteor/packages b/.meteor/packages
index b462d6f..1f4b5b4 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -11,3 +11,5 @@ accounts-password
 accounts-ui
 accounts-facebook
 accounts-twitter
+angularutils:pagination
+tmeasday:publish-counts
diff --git a/.meteor/versions b/.meteor/versions
index 58b2863..6128de0 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -7,6 +7,7 @@ accounts-ui@1.1.5
 accounts-ui-unstyled@1.1.7
 angular:angular@1.4.4
 angularui:angular-ui-router@0.2.15
+angularutils:pagination@0.7.0
 autoupdate@1.2.1
 base64@1.0.3
 binary-heap@1.0.3
@@ -60,6 +61,7 @@ spacebars@1.0.6
 spacebars-compiler@1.0.6
 srp@1.0.3
 templating@1.1.1
+tmeasday:publish-counts@0.7.0
 tracker@1.0.7
 twitter@1.1.4
 ui@1.0.6
diff --git a/server/startup/loadParties.js b/server/startup/loadParties.js
deleted file mode 100644
index 8d3780e..0000000
--- a/server/startup/loadParties.js
+++ /dev/null
@@ -1,14 +0,0 @@
-Meteor.startup(function () {
-  if (Parties.find().count() === 0) {
-    var parties = [
-      {'name': 'Dubstep-Free Zone',
-        'description': 'Fast just got faster with Nexus S.'},
-      {'name': 'All dubstep all the time',
-        'description': 'Get it on!'},
-      {'name': 'Savage lounging',
-        'description': 'Leisure suit required. And only fiercest manners.'}
-    ];
-    for (var i = 0; i < parties.length; i++)
-      Parties.insert({name: parties[i].name, description: parties[i].description});
-  }
-});
-- 
2.3.2 (Apple Git-55)


From 81eed2a3ee26107aaae6568bbca79a9caeb39fcc Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:23:03 +0300
Subject: [PATCH 106/236] Step 14.1: Add meteor method to the model

---
 model/parties.js | 46 +++++++++++++++++++++++++++++++++++++++++++++-
 1 file changed, 45 insertions(+), 1 deletion(-)

diff --git a/model/parties.js b/model/parties.js
index b793c1f..8998b5e 100644
--- a/model/parties.js
+++ b/model/parties.js
@@ -10,4 +10,48 @@ Parties.allow({
   remove: function (userId, party) {
     return userId && party.owner === userId;
   }
-});
\ No newline at end of file
+});
+
+Meteor.methods({
+  invite: function (partyId, userId) {
+    check(partyId, String);
+    check(userId, String);
+    var party = Parties.findOne(partyId);
+    if (!party)
+      throw new Meteor.Error(404, "No such party");
+    if (party.owner !== this.userId)
+      throw new Meteor.Error(404, "No such party");
+    if (party.public)
+      throw new Meteor.Error(400,
+        "That party is public. No need to invite people.");
+
+    if (userId !== party.owner && ! _.contains(party.invited, userId)) {
+      Parties.update(partyId, { $addToSet: { invited: userId } });
+
+      var from = contactEmail(Meteor.users.findOne(this.userId));
+      var to = contactEmail(Meteor.users.findOne(userId));
+
+      if (Meteor.isServer && to) {
+        // This code only runs on the server. If you didn't want clients
+        // to be able to see it, you could move it to a separate file.
+        Email.send({
+          from: "noreply@socially.com",
+          to: to,
+          replyTo: from || undefined,
+          subject: "PARTY: " + party.title,
+          text:
+          "Hey, I just invited you to '" + party.title + "' on Socially." +
+          "\n\nCome check it out: " + Meteor.absoluteUrl() + "\n"
+        });
+      }
+    }
+  }
+});
+
+var contactEmail = function (user) {
+  if (user.emails && user.emails.length)
+    return user.emails[0].address;
+  if (user.services && user.services.facebook && user.services.facebook.email)
+    return user.services.facebook.email;
+  return null;
+};
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 730c27eca78f16c08e8fcc334e198ff9d51b95d7 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:25:19 +0300
Subject: [PATCH 107/236] Step 14.2: Add invite method to the client

---
 client/parties/controllers/partyDetails.js | 11 +++++++++++
 1 file changed, 11 insertions(+)

diff --git a/client/parties/controllers/partyDetails.js b/client/parties/controllers/partyDetails.js
index 4cfb48d..045ea9d 100644
--- a/client/parties/controllers/partyDetails.js
+++ b/client/parties/controllers/partyDetails.js
@@ -3,4 +3,15 @@ angular.module("socially").controller("PartyDetailsCtrl", ['$scope', '$statePara
     $scope.party = $meteor.object(Parties, $stateParams.partyId);
     $scope.users = $meteor.collection(Meteor.users, false).subscribe('users');
     $scope.$meteorSubscribe('parties');
+
+    $scope.invite = function(user){
+      $meteor.call('invite', $scope.party._id, user._id).then(
+        function(data){
+          console.log('success inviting', data);
+        },
+        function(err){
+          console.log('failed', err);
+        }
+      );
+    };
   }]);
-- 
2.3.2 (Apple Git-55)


From e0a00756e87e4967365b75fd240882e491e55311 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:26:39 +0300
Subject: [PATCH 108/236] Step 14.3: Add invite button to the view

---
 client/parties/views/party-details.ng.html | 1 +
 1 file changed, 1 insertion(+)

diff --git a/client/parties/views/party-details.ng.html b/client/parties/views/party-details.ng.html
index 4642f74..609a4ba 100644
--- a/client/parties/views/party-details.ng.html
+++ b/client/parties/views/party-details.ng.html
@@ -9,5 +9,6 @@ Here you will see and change the details of the party:
   Users to invite:
   <li ng-repeat="user in users | uninvited:party">
     <div>{{ user | displayName }}</div>
+    <button ng-click="invite(user)">Invite</button>
   </li>
 </ul>
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 659d04152e5a7ab78d5a2a181650a78de25c493a Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:27:54 +0300
Subject: [PATCH 109/236] Step 14.4: Add invited logic to the publish

---
 server/parties.js | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/server/parties.js b/server/parties.js
index c2dc88b..b691e30 100644
--- a/server/parties.js
+++ b/server/parties.js
@@ -12,6 +12,10 @@ Meteor.publish("parties", function (options, searchString) {
       {$and:[
         {owner: this.userId},
         {owner: {$exists: true}}
+      ]},
+      {$and:[
+        {invited: this.userId},
+        {invited: {$exists: true}}
       ]}
     ]}), { noReady: true });
 
@@ -25,6 +29,10 @@ Meteor.publish("parties", function (options, searchString) {
       {$and:[
         {owner: this.userId},
         {owner: {$exists: true}}
+      ]},
+      {$and:[
+        {invited: this.userId},
+        {invited: {$exists: true}}
       ]}
     ]}, options);
 });
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 351afed19208358d6a2d1eeb0a45733a4caa9d28 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:30:21 +0300
Subject: [PATCH 110/236] Step 14.5: Add RSVP function to the server

---
 model/parties.js | 40 ++++++++++++++++++++++++++++++++++++++++
 1 file changed, 40 insertions(+)

diff --git a/model/parties.js b/model/parties.js
index 8998b5e..37b10e5 100644
--- a/model/parties.js
+++ b/model/parties.js
@@ -45,6 +45,46 @@ Meteor.methods({
         });
       }
     }
+  },
+  rsvp: function (partyId, rsvp) {
+    check(partyId, String);
+    check(rsvp, String);
+    if (! this.userId)
+      throw new Meteor.Error(403, "You must be logged in to RSVP");
+    if (! _.contains(['yes', 'no', 'maybe'], rsvp))
+      throw new Meteor.Error(400, "Invalid RSVP");
+    var party = Parties.findOne(partyId);
+    if (! party)
+      throw new Meteor.Error(404, "No such party");
+    if (! party.public && party.owner !== this.userId &&
+      !_.contains(party.invited, this.userId))
+    // private, but let's not tell this to the user
+      throw new Meteor.Error(403, "No such party");
+
+    var rsvpIndex = _.indexOf(_.pluck(party.rsvps, 'user'), this.userId);
+    if (rsvpIndex !== -1) {
+      // update existing rsvp entry
+
+      if (Meteor.isServer) {
+        // update the appropriate rsvp entry with $
+        Parties.update(
+          {_id: partyId, "rsvps.user": this.userId},
+          {$set: {"rsvps.$.rsvp": rsvp}});
+      } else {
+        // minimongo doesn't yet support $ in modifier. as a temporary
+        // workaround, make a modifier that uses an index. this is
+        // safe on the client since there's only one thread.
+        var modifier = {$set: {}};
+        modifier.$set["rsvps." + rsvpIndex + ".rsvp"] = rsvp;
+        Parties.update(partyId, modifier);
+      }
+      // Possible improvement: send email to the other people that are
+      // coming to the party.
+    } else {
+      // add new rsvp entry
+      Parties.update(partyId,
+        {$push: {rsvps: {user: this.userId, rsvp: rsvp}}});
+    }
   }
 });
 
-- 
2.3.2 (Apple Git-55)


From 093aeef78d9f8948b22d60a51872002c6e119467 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:31:14 +0300
Subject: [PATCH 111/236] Step 14.6: Add RSVP function to the client

---
 client/parties/controllers/partiesList.js | 11 +++++++++++
 1 file changed, 11 insertions(+)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index afdef32..ea7eb56 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -41,6 +41,17 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '
         $scope.sort = {name: parseInt($scope.orderProperty)};
     });
 
+    $scope.rsvp = function(partyId, rsvp){
+      $meteor.call('rsvp', partyId, rsvp).then(
+        function(data){
+          console.log('success responding', data);
+        },
+        function(err){
+          console.log('failed', err);
+        }
+      );
+    };
+
     $scope.getUserById = function(userId){
       return Meteor.users.findOne(userId);
     };
-- 
2.3.2 (Apple Git-55)


From e67719681e44752b5e482682b1a66852c5173414 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:33:05 +0300
Subject: [PATCH 112/236] Step 14.7: Add RSVP control to the view

---
 client/parties/views/parties-list.ng.html | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index d3cc5e0..451835f 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -21,6 +21,13 @@
     <a href="/parties/{{party._id}}">{{party.name}}</a>
     <p>{{party.description}}</p>
     <button ng-click="remove(party)">X</button>
+
+    <div>
+      <input type="button" value="I'm going!" ng-click="rsvp(party._id, 'yes')">
+      <input type="button" value="Maybe" ng-click="rsvp(party._id, 'maybe')">
+      <input type="button" value="No" ng-click="rsvp(party._id, 'no')">
+    </div>
+
     <p><small>Posted by {{ creator(party) | displayName }}</small></p>
   </li>
 </ul>
-- 
2.3.2 (Apple Git-55)


From aa4e0a50f62bc52691433c2cb3ea1f12dc774910 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:33:44 +0300
Subject: [PATCH 113/236] Step 14.8: Add RSVP list to the view

---
 client/parties/views/parties-list.ng.html | 15 +++++++++++++++
 1 file changed, 15 insertions(+)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index 451835f..98e33e5 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -27,6 +27,21 @@
       <input type="button" value="Maybe" ng-click="rsvp(party._id, 'maybe')">
       <input type="button" value="No" ng-click="rsvp(party._id, 'no')">
     </div>
+    <div>
+      Who is coming:
+      Yes - {{ (party.rsvps | filter:{rsvp:'yes'}).length }}
+      Maybe - {{ (party.rsvps | filter:{rsvp:'maybe'}).length }}
+      No - {{ (party.rsvps | filter:{rsvp:'no'}).length }}
+      <div ng-repeat="rsvp in party.rsvps | filter:{rsvp:'yes'}">
+        {{ getUserById(rsvp.user) | displayName }} - {{ rsvp.rsvp }}
+      </div>
+      <div ng-repeat="rsvp in party.rsvps | filter:{rsvp:'maybe'}">
+        {{ getUserById(rsvp.user) | displayName }} - {{ rsvp.rsvp }}
+      </div>
+      <div ng-repeat="rsvp in party.rsvps | filter:{rsvp:'no'}">
+        {{ getUserById(rsvp.user) | displayName }} - {{ rsvp.rsvp }}
+      </div>
+    </div>
 
     <p><small>Posted by {{ creator(party) | displayName }}</small></p>
   </li>
-- 
2.3.2 (Apple Git-55)


From 302f422ee9ca95b092aaa97b8142746b0c46ab9f Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:34:19 +0300
Subject: [PATCH 114/236] Step 14.9: Add RSVP list to the view of users who not
 responded

---
 client/parties/views/parties-list.ng.html | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index 98e33e5..e4660f1 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -43,6 +43,13 @@
       </div>
     </div>
 
+    <ul>
+      Users who not responded:
+      <li ng-repeat="invitedUser in outstandingInvitations(party)">
+        {{dstache}} invitedUser | displayName }}
+      </li>
+    </ul>
+
     <p><small>Posted by {{ creator(party) | displayName }}</small></p>
   </li>
 </ul>
-- 
2.3.2 (Apple Git-55)


From 6d31a69795ac254d90c4f814c76de0df900b35e5 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:34:54 +0300
Subject: [PATCH 115/236] Step 14.10: Added logic to the controller

---
 client/parties/controllers/partiesList.js | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index ea7eb56..57d1f52 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -52,6 +52,13 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '
       );
     };
 
+    $scope.outstandingInvitations = function (party) {
+      return _.filter($scope.users, function (user) {
+        return (_.contains(party.invited, user._id) &&
+        !_.findWhere(party.rsvps, {user: user._id}));
+      });
+    };
+
     $scope.getUserById = function(userId){
       return Meteor.users.findOne(userId);
     };
-- 
2.3.2 (Apple Git-55)


From ec82ab47fcf59ca7fde2c325001a7e6444ba9d46 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:35:37 +0300
Subject: [PATCH 116/236] Step 14.11: Add users collection

---
 client/parties/controllers/partiesList.js | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index 57d1f52..2273fb3 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -6,7 +6,7 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '
     $scope.sort = { name: 1 };
     $scope.orderProperty = '1';
 
-    $scope.$meteorSubscribe('users');
+    $scope.users = $meteor.collection(Meteor.users, false).subscribe('users');
 
     $scope.parties = $meteor.collection(function() {
       return Parties.find({}, {
-- 
2.3.2 (Apple Git-55)


From 10adbc07159fe99f6c3eb0f2a35c3729fce20a2e Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:39:54 +0300
Subject: [PATCH 117/236] Step 15.1: Add ng-show to the directive

---
 client/parties/views/parties-list.ng.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index e4660f1..f3a0f85 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -1,4 +1,4 @@
-<form>
+<form ng-show="$root.currentUser">
   <label>Name</label>
   <input ng-model="newParty.name">
   <label>Description</label>
-- 
2.3.2 (Apple Git-55)


From dd6757344554767c92e2b12006b27f3ec685bcb5 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:40:35 +0300
Subject: [PATCH 118/236] Step 15.2: Add message to users that not logged in

---
 client/parties/views/parties-list.ng.html | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index f3a0f85..d15876f 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -8,6 +8,9 @@
   <button ng-click="newParty.owner=$root.currentUser._id; parties.push(newParty)">Add</button>
   <button ng-click="removeAll()">Remove All</button>
 </form>
+<div ng-hide="$root.currentUser || $root.loggingIn">
+  Log in to create a party!
+</div>
 <ul>
   <h1>Parties:</h1>
   <div>
-- 
2.3.2 (Apple Git-55)


From 342d9028fea65290541d2d2d8f739db6f42162e7 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:41:09 +0300
Subject: [PATCH 119/236] Step 15.3: Add ng-show to the RSVP buttons

---
 client/parties/views/parties-list.ng.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index d15876f..f3c8063 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -25,7 +25,7 @@
     <p>{{party.description}}</p>
     <button ng-click="remove(party)">X</button>
 
-    <div>
+    <div ng-show="$root.currentUser">
       <input type="button" value="I'm going!" ng-click="rsvp(party._id, 'yes')">
       <input type="button" value="Maybe" ng-click="rsvp(party._id, 'maybe')">
       <input type="button" value="No" ng-click="rsvp(party._id, 'no')">
-- 
2.3.2 (Apple Git-55)


From 42d2b1ede34c0ef8cfa78d9972d3fbbb677832ca Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:41:46 +0300
Subject: [PATCH 120/236] Step 15.4: Add message for not-logged in users on the
 RSVP buttons

---
 client/parties/views/parties-list.ng.html | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index f3c8063..19a43f9 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -30,6 +30,10 @@
       <input type="button" value="Maybe" ng-click="rsvp(party._id, 'maybe')">
       <input type="button" value="No" ng-click="rsvp(party._id, 'no')">
     </div>
+    <div ng-hide="$root.currentUser">
+      <i>Sign in to RSVP for this party.</i>
+    </div>
+
     <div>
       Who is coming:
       Yes - {{ (party.rsvps | filter:{rsvp:'yes'}).length }}
-- 
2.3.2 (Apple Git-55)


From 1b18b4723481bf2d354a7d06047291868c314389 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:42:52 +0300
Subject: [PATCH 121/236] Step 15.5: Add ng-show to delete button

---
 client/parties/views/parties-list.ng.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index 19a43f9..c1c5752 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -23,7 +23,7 @@
   <li dir-paginate="party in parties | itemsPerPage: perPage" total-items="partiesCount.count">
     <a href="/parties/{{party._id}}">{{party.name}}</a>
     <p>{{party.description}}</p>
-    <button ng-click="remove(party)">X</button>
+    <button ng-click="remove(party)" ng-show="$root.currentUser && $root.currentUser._id == party.owner">X</button>
 
     <div ng-show="$root.currentUser">
       <input type="button" value="I'm going!" ng-click="rsvp(party._id, 'yes')">
-- 
2.3.2 (Apple Git-55)


From 4e82eeff6b7687c892e4ab3a20f856de014a8800 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:43:59 +0300
Subject: [PATCH 122/236] Step 15.6: Add ng-if to outstanding RSVP

---
 client/parties/views/parties-list.ng.html | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index c1c5752..58652c8 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -50,12 +50,15 @@
       </div>
     </div>
 
-    <ul>
+    <ul ng-if="!party.public">
       Users who not responded:
       <li ng-repeat="invitedUser in outstandingInvitations(party)">
         {{dstache}} invitedUser | displayName }}
       </li>
     </ul>
+    <div ng-if="party.public">
+      Everyone is invited
+    </div>
 
     <p><small>Posted by {{ creator(party) | displayName }}</small></p>
   </li>
-- 
2.3.2 (Apple Git-55)


From 4c4b799735b96c675bcb658610268ece87fed432 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:46:41 +0300
Subject: [PATCH 123/236] Step 15.7: Add canInvite logic

---
 client/parties/controllers/partyDetails.js | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/client/parties/controllers/partyDetails.js b/client/parties/controllers/partyDetails.js
index 045ea9d..0c27c6e 100644
--- a/client/parties/controllers/partyDetails.js
+++ b/client/parties/controllers/partyDetails.js
@@ -14,4 +14,12 @@ angular.module("socially").controller("PartyDetailsCtrl", ['$scope', '$statePara
         }
       );
     };
+
+    $scope.canInvite = function (){
+      if (!$scope.party)
+        return false;
+
+      return !$scope.party.public &&
+        $scope.party.owner === Meteor.userId();
+    };
   }]);
-- 
2.3.2 (Apple Git-55)


From 6ea5aae18ac1945174f9c280d51ab6562f854c97 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:47:19 +0300
Subject: [PATCH 124/236] Step 15.8: Add usage for ng-show with canInvite

---
 client/parties/views/party-details.ng.html | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/client/parties/views/party-details.ng.html b/client/parties/views/party-details.ng.html
index 609a4ba..a695811 100644
--- a/client/parties/views/party-details.ng.html
+++ b/client/parties/views/party-details.ng.html
@@ -5,10 +5,13 @@ Here you will see and change the details of the party:
 <label>Is public</label>
 <input type="checkbox" ng-model="party.public">
 
-<ul>
+<ul ng-show="canInvite()">
   Users to invite:
   <li ng-repeat="user in users | uninvited:party">
     <div>{{ user | displayName }}</div>
     <button ng-click="invite(user)">Invite</button>
   </li>
+  <li ng-if="(users | uninvited:party).length <= 0">
+    Everyone are already invited.
+  </li>
 </ul>
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 853709f2e1dec49c13af6b35c5ed57ff4c46d57c Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:49:32 +0300
Subject: [PATCH 125/236] Step 15.9: Example of ng-disabled

---
 client/parties/views/party-details.ng.html | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/client/parties/views/party-details.ng.html b/client/parties/views/party-details.ng.html
index a695811..f17a8f2 100644
--- a/client/parties/views/party-details.ng.html
+++ b/client/parties/views/party-details.ng.html
@@ -1,9 +1,9 @@
 Here you will see and change the details of the party:
 
-<input ng-model="party.name">
-<input ng-model="party.description">
+<input ng-model="party.name" ng-disabled="party.owner != $root.currentUser._id">
+<input ng-model="party.description" ng-disabled="party.owner != $root.currentUser._id">
 <label>Is public</label>
-<input type="checkbox" ng-model="party.public">
+<input type="checkbox" ng-model="party.public" ng-disabled="party.owner != $root.currentUser._id">
 
 <ul ng-show="canInvite()">
   Users to invite:
-- 
2.3.2 (Apple Git-55)


From 86a6e35af6ede583515df198965f028694b02d85 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:54:08 +0300
Subject: [PATCH 126/236] Step 16.1: Add google maps module dependency

---
 client/lib/app.js | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/client/lib/app.js b/client/lib/app.js
index 79b962b..980e7c3 100644
--- a/client/lib/app.js
+++ b/client/lib/app.js
@@ -1,5 +1,9 @@
-angular.module('socially',['angular-meteor', 'ui.router', 'angularUtils.directives.dirPagination']);
-
+angular.module('socially',[
+  'angular-meteor',
+  'ui.router',
+  'angularUtils.directives.dirPagination',
+  'uiGmapgoogle-maps'
+]);
 function onReady() {
   angular.bootstrap(document, ['socially']);
 }
-- 
2.3.2 (Apple Git-55)


From e5d387c68f331e61962a2beb6c0c7288ca8fe2af Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:54:54 +0300
Subject: [PATCH 127/236] Step 16.2: Add basic map to the view

---
 client/parties/views/party-details.ng.html | 10 +++++++++-
 1 file changed, 9 insertions(+), 1 deletion(-)

diff --git a/client/parties/views/party-details.ng.html b/client/parties/views/party-details.ng.html
index f17a8f2..73c4640 100644
--- a/client/parties/views/party-details.ng.html
+++ b/client/parties/views/party-details.ng.html
@@ -14,4 +14,12 @@ Here you will see and change the details of the party:
   <li ng-if="(users | uninvited:party).length <= 0">
     Everyone are already invited.
   </li>
-</ul>
\ No newline at end of file
+</ul>
+
+<div class="party-details-maps">
+  <div class="angular-google-map-container">
+    <ui-gmap-google-map center="party.location || map.center"
+                        events="map.events" zoom="map.zoom">
+    </ui-gmap-google-map>
+  </div>
+</div>
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 7b567cf5885ce1d39ea58b35887b137eae910474 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:55:24 +0300
Subject: [PATCH 128/236] Step 16.3: Add map params to the controller

---
 client/parties/controllers/partyDetails.js | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/client/parties/controllers/partyDetails.js b/client/parties/controllers/partyDetails.js
index 0c27c6e..75e12f2 100644
--- a/client/parties/controllers/partyDetails.js
+++ b/client/parties/controllers/partyDetails.js
@@ -22,4 +22,13 @@ angular.module("socially").controller("PartyDetailsCtrl", ['$scope', '$statePara
       return !$scope.party.public &&
         $scope.party.owner === Meteor.userId();
     };
+
+    $scope.map = {
+      center: {
+        latitude: 45,
+        longitude: -73
+      },
+      zoom: 8,
+      events: {}
+    };
   }]);
-- 
2.3.2 (Apple Git-55)


From 2e2936ac54fa299b2d68a4a8620d0b7f4d32bb9d Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:56:18 +0300
Subject: [PATCH 129/236] Step 16.4: Create basic CSS style with google map
 style

---
 client/parties/styles/parties.css | 4 ++++
 1 file changed, 4 insertions(+)
 create mode 100644 client/parties/styles/parties.css

diff --git a/client/parties/styles/parties.css b/client/parties/styles/parties.css
new file mode 100644
index 0000000..219ff39
--- /dev/null
+++ b/client/parties/styles/parties.css
@@ -0,0 +1,4 @@
+.angular-google-map-container {
+    height: 400px;
+    width: 400px;
+}
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 0253eda09a5c549484d137a91f09c346978d1ad5 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:57:43 +0300
Subject: [PATCH 130/236] Step 16.5: Add party marker to the map

---
 client/parties/views/party-details.ng.html | 13 +++++++------
 1 file changed, 7 insertions(+), 6 deletions(-)

diff --git a/client/parties/views/party-details.ng.html b/client/parties/views/party-details.ng.html
index 73c4640..7ef1f8d 100644
--- a/client/parties/views/party-details.ng.html
+++ b/client/parties/views/party-details.ng.html
@@ -16,10 +16,11 @@ Here you will see and change the details of the party:
   </li>
 </ul>
 
-<div class="party-details-maps">
-  <div class="angular-google-map-container">
-    <ui-gmap-google-map center="party.location || map.center"
-                        events="map.events" zoom="map.zoom">
-    </ui-gmap-google-map>
-  </div>
+<div class="angular-google-map-container">
+  <ui-gmap-google-map center="party.location || map.center"
+                      events="map.events" zoom="map.zoom">
+    <ui-gmap-marker coords="party.location" options="map.marker.options"
+                    events="map.marker.events" idkey="party._id">
+    </ui-gmap-marker>
+  </ui-gmap-google-map>
 </div>
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 21dc6b4dca5b3bd1fd72e742a049051eddf43f99 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:58:32 +0300
Subject: [PATCH 131/236] Step 16.6: Add the marker creation logic to the
 controller

---
 client/parties/controllers/partyDetails.js | 27 ++++++++++++++++++++++++++-
 1 file changed, 26 insertions(+), 1 deletion(-)

diff --git a/client/parties/controllers/partyDetails.js b/client/parties/controllers/partyDetails.js
index 75e12f2..b6209e5 100644
--- a/client/parties/controllers/partyDetails.js
+++ b/client/parties/controllers/partyDetails.js
@@ -29,6 +29,31 @@ angular.module("socially").controller("PartyDetailsCtrl", ['$scope', '$statePara
         longitude: -73
       },
       zoom: 8,
-      events: {}
+      events: {
+        click: function (mapModel, eventName, originalEventArgs) {
+          if (!$scope.party)
+            return;
+
+          if (!$scope.party.location)
+            $scope.party.location = {};
+
+          $scope.party.location.latitude = originalEventArgs[0].latLng.lat();
+          $scope.party.location.longitude = originalEventArgs[0].latLng.lng();
+          //scope apply required because this event handler is outside of the angular domain
+          $scope.$apply();
+        }
+      },
+      marker: {
+        options: { draggable: true },
+        events: {
+          dragend: function (marker, eventName, args) {
+            if (!$scope.party.location)
+              $scope.party.location = {};
+
+            $scope.party.location.latitude = marker.getPosition().lat();
+            $scope.party.location.longitude = marker.getPosition().lng();
+          }
+        }
+      }
     };
   }]);
-- 
2.3.2 (Apple Git-55)


From ad2704b928aabce31141fbb8dc630f98df526907 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 22:59:21 +0300
Subject: [PATCH 132/236] Step 16.7: Add map to the parties list

---
 client/parties/views/parties-list.ng.html | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index 58652c8..e0e9d47 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -20,6 +20,13 @@
       <option value="-1">Descending</option>
     </select>
   </div>
+  <div class="angular-google-map-container">
+    <ui-gmap-google-map center="party.location || map.center" zoom="map.zoom">
+      <ui-gmap-markers models="parties" coords="'location'" click="onClicked()"
+                       fit="true" idkey="'_id'" doRebuildAll="true">
+      </ui-gmap-markers>
+    </ui-gmap-google-map>
+  </div>
   <li dir-paginate="party in parties | itemsPerPage: perPage" total-items="partiesCount.count">
     <a href="/parties/{{party._id}}">{{party.name}}</a>
     <p>{{party.description}}</p>
-- 
2.3.2 (Apple Git-55)


From a6c023efc8bb60eff4fe19b527ae7696896d8dd1 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 23:00:02 +0300
Subject: [PATCH 133/236] Step 16.8: Add map logic to the parties list
 controller

---
 client/parties/controllers/partiesList.js | 15 +++++++++++++++
 1 file changed, 15 insertions(+)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index 2273fb3..4c3255e 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -21,6 +21,21 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '
         sort: $scope.getReactively('sort')
       }, $scope.getReactively('search')).then(function() {
         $scope.partiesCount = $meteor.object(Counts ,'numberOfParties', false);
+
+        $scope.parties.forEach( function (party) {
+          party.onClicked = function () {
+            $state.go('partyDetails', {partyId: party._id});
+          };
+        });
+
+        $scope.map = {
+          center: {
+            latitude: 45,
+            longitude: -73
+          },
+          zoom: 8
+        };
+
       });
     });
 
-- 
2.3.2 (Apple Git-55)


From c0a47ef415a2fc05f2a2f63620398d706920c800 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 23:05:03 +0300
Subject: [PATCH 134/236] Update packages, cleanup

---
 .meteor/packages                           |  2 ++
 .meteor/versions                           |  2 ++
 client/parties/controllers/partiesList.js  | 42 +++++++++++-------------------
 client/parties/controllers/partyDetails.js | 17 +++++++++---
 client/parties/views/parties-list.ng.html  | 11 ++++----
 client/parties/views/party-details.ng.html |  8 +++---
 6 files changed, 41 insertions(+), 41 deletions(-)

diff --git a/.meteor/packages b/.meteor/packages
index 1f4b5b4..f8c5347 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -13,3 +13,5 @@ accounts-facebook
 accounts-twitter
 angularutils:pagination
 tmeasday:publish-counts
+email
+angularui:angular-google-maps
diff --git a/.meteor/versions b/.meteor/versions
index 6128de0..5a2077d 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -6,6 +6,7 @@ accounts-twitter@1.0.4
 accounts-ui@1.1.5
 accounts-ui-unstyled@1.1.7
 angular:angular@1.4.4
+angularui:angular-google-maps@2.1.5
 angularui:angular-ui-router@0.2.15
 angularutils:pagination@0.7.0
 autoupdate@1.2.1
@@ -60,6 +61,7 @@ sha@1.0.3
 spacebars@1.0.6
 spacebars-compiler@1.0.6
 srp@1.0.3
+stevezhu:lodash@1.0.2
 templating@1.1.1
 tmeasday:publish-counts@0.7.0
 tracker@1.0.7
diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index 4c3255e..03e6f34 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -1,5 +1,5 @@
-angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '$rootScope',
-  function($scope, $meteor, $rootScope){
+angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '$rootScope', '$state',
+  function($scope, $meteor, $rootScope, $state){
 
     $scope.page = 1;
     $scope.perPage = 3;
@@ -35,7 +35,6 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '
           },
           zoom: 8
         };
-
       });
     });
 
@@ -43,10 +42,6 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '
       $scope.parties.splice( $scope.parties.indexOf(party), 1 );
     };
 
-    $scope.removeAll = function(){
-      $scope.parties.remove();
-    };
-
     $scope.pageChanged = function(newPage) {
       $scope.page = newPage;
     };
@@ -56,24 +51,6 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '
         $scope.sort = {name: parseInt($scope.orderProperty)};
     });
 
-    $scope.rsvp = function(partyId, rsvp){
-      $meteor.call('rsvp', partyId, rsvp).then(
-        function(data){
-          console.log('success responding', data);
-        },
-        function(err){
-          console.log('failed', err);
-        }
-      );
-    };
-
-    $scope.outstandingInvitations = function (party) {
-      return _.filter($scope.users, function (user) {
-        return (_.contains(party.invited, user._id) &&
-        !_.findWhere(party.rsvps, {user: user._id}));
-      });
-    };
-
     $scope.getUserById = function(userId){
       return Meteor.users.findOne(userId);
     };
@@ -83,13 +60,24 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '
         return;
       var owner = $scope.getUserById(party.owner);
       if (!owner)
-        return 'nobody';
+        return "nobody";
 
       if ($rootScope.currentUser)
         if ($rootScope.currentUser._id)
           if (owner._id === $rootScope.currentUser._id)
-            return 'me';
+            return "me";
 
       return owner;
     };
+
+    $scope.rsvp = function(partyId, rsvp){
+      $meteor.call('rsvp', partyId, rsvp).then(
+        function(data){
+          console.log('success responding', data);
+        },
+        function(err){
+          console.log('failed', err);
+        }
+      );
+    };
   }]);
\ No newline at end of file
diff --git a/client/parties/controllers/partyDetails.js b/client/parties/controllers/partyDetails.js
index b6209e5..76a733f 100644
--- a/client/parties/controllers/partyDetails.js
+++ b/client/parties/controllers/partyDetails.js
@@ -1,8 +1,14 @@
 angular.module("socially").controller("PartyDetailsCtrl", ['$scope', '$stateParams', '$meteor',
-  function ($scope, $stateParams, $meteor) {
+  function($scope, $stateParams, $meteor){
+
     $scope.party = $meteor.object(Parties, $stateParams.partyId);
+
+    var subscriptionHandle;
+    $meteor.subscribe('parties').then(function(handle) {
+      subscriptionHandle = handle;
+    });
+
     $scope.users = $meteor.collection(Meteor.users, false).subscribe('users');
-    $scope.$meteorSubscribe('parties');
 
     $scope.invite = function(user){
       $meteor.call('invite', $scope.party._id, user._id).then(
@@ -15,6 +21,10 @@ angular.module("socially").controller("PartyDetailsCtrl", ['$scope', '$statePara
       );
     };
 
+    $scope.$on('$destroy', function() {
+      subscriptionHandle.stop();
+    });
+
     $scope.canInvite = function (){
       if (!$scope.party)
         return false;
@@ -56,4 +66,5 @@ angular.module("socially").controller("PartyDetailsCtrl", ['$scope', '$statePara
         }
       }
     };
-  }]);
+
+  }]);
\ No newline at end of file
diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index e0e9d47..f87b68d 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -1,12 +1,12 @@
 <form ng-show="$root.currentUser">
+  <h2>Create a new party:</h2>
   <label>Name</label>
   <input ng-model="newParty.name">
   <label>Description</label>
   <input ng-model="newParty.description">
   <label>Public</label>
   <input type="checkbox" ng-model="newParty.public">
-  <button ng-click="newParty.owner=$root.currentUser._id; parties.push(newParty)">Add</button>
-  <button ng-click="removeAll()">Remove All</button>
+  <button ng-click="newParty.owner=$root.currentUser._id;parties.push(newParty); newParty='';">Add</button>
 </form>
 <div ng-hide="$root.currentUser || $root.loggingIn">
   Log in to create a party!
@@ -21,7 +21,7 @@
     </select>
   </div>
   <div class="angular-google-map-container">
-    <ui-gmap-google-map center="party.location || map.center" zoom="map.zoom">
+    <ui-gmap-google-map center="map.center" zoom="map.zoom">
       <ui-gmap-markers models="parties" coords="'location'" click="onClicked()"
                        fit="true" idkey="'_id'" doRebuildAll="true">
       </ui-gmap-markers>
@@ -56,11 +56,10 @@
         {{ getUserById(rsvp.user) | displayName }} - {{ rsvp.rsvp }}
       </div>
     </div>
-
     <ul ng-if="!party.public">
       Users who not responded:
       <li ng-repeat="invitedUser in outstandingInvitations(party)">
-        {{dstache}} invitedUser | displayName }}
+        {{ invitedUser | displayName }}
       </li>
     </ul>
     <div ng-if="party.public">
@@ -70,4 +69,4 @@
     <p><small>Posted by {{ creator(party) | displayName }}</small></p>
   </li>
 </ul>
-<dir-pagination-controls on-page-change="pageChanged(newPageNumber)"></dir-pagination-controls>
\ No newline at end of file
+<dir-pagination-controls on-page-change="pageChanged(newPageNumber)"></dir-pagination-controls>
diff --git a/client/parties/views/party-details.ng.html b/client/parties/views/party-details.ng.html
index 7ef1f8d..0018231 100644
--- a/client/parties/views/party-details.ng.html
+++ b/client/parties/views/party-details.ng.html
@@ -17,10 +17,8 @@ Here you will see and change the details of the party:
 </ul>
 
 <div class="angular-google-map-container">
-  <ui-gmap-google-map center="party.location || map.center"
-                      events="map.events" zoom="map.zoom">
-    <ui-gmap-marker coords="party.location" options="map.marker.options"
-                    events="map.marker.events" idkey="party._id">
+  <ui-gmap-google-map center="map.center" events="map.events" zoom="map.zoom">
+    <ui-gmap-marker coords="party.location" options="map.marker.options" events="map.marker.events" idkey="party._id">
     </ui-gmap-marker>
   </ui-gmap-google-map>
-</div>
\ No newline at end of file
+</div>
-- 
2.3.2 (Apple Git-55)


From 01208cac187d1624e86305a9f1acc5bef1ea6127 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 23:08:21 +0300
Subject: [PATCH 135/236] Step 17.1: Add main CSS file

---
 client/styles/main.css | 3 +++
 1 file changed, 3 insertions(+)
 create mode 100644 client/styles/main.css

diff --git a/client/styles/main.css b/client/styles/main.css
new file mode 100644
index 0000000..4397047
--- /dev/null
+++ b/client/styles/main.css
@@ -0,0 +1,3 @@
+body {
+    background-color: rgba(0,0,0,.04);
+}
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 6aa6992bfe632f35a79d31eb087b4b52883241de Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 23:09:03 +0300
Subject: [PATCH 136/236] Step 17.2: Add navbar and style to the login button

---
 client/index.html | 16 +++++++++++-----
 1 file changed, 11 insertions(+), 5 deletions(-)

diff --git a/client/index.html b/client/index.html
index d0ba166..00d1dc0 100644
--- a/client/index.html
+++ b/client/index.html
@@ -4,11 +4,17 @@
 <body>
 
 <div>
-  <meteor-include src="loginButtons"></meteor-include>
-  <h1>
-    <a href="/parties">Home</a>
-  </h1>
-  <div ui-view></div>
+  <header class="navbar navbar-fixed-top">
+    <div class="container-fluid">
+      <div class="navbar-header">
+        <h1>
+          <a href="/parties">Home</a>
+        </h1>
+      </div>
+      <meteor-include src="loginButtons"></meteor-include>
+    </div>
+  </header>
+  <div ui-view class="container-fluid"></div>
 </div>
 
 </body>
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From ec726798d600b9b7f51429f766ebededac457b1e Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 23:09:43 +0300
Subject: [PATCH 137/236] Step 17.3: Basic usage of LESS

---
 client/styles/main.css  | 3 ---
 client/styles/main.less | 8 ++++++++
 2 files changed, 8 insertions(+), 3 deletions(-)
 delete mode 100644 client/styles/main.css
 create mode 100644 client/styles/main.less

diff --git a/client/styles/main.css b/client/styles/main.css
deleted file mode 100644
index 4397047..0000000
--- a/client/styles/main.css
+++ /dev/null
@@ -1,3 +0,0 @@
-body {
-    background-color: rgba(0,0,0,.04);
-}
\ No newline at end of file
diff --git a/client/styles/main.less b/client/styles/main.less
new file mode 100644
index 0000000..6acada4
--- /dev/null
+++ b/client/styles/main.less
@@ -0,0 +1,8 @@
+body {
+    background-color: rgba(0,0,0,.2);
+    padding-top: 70px;
+
+    .navbar {
+        background-color: #ffffff;
+    }
+}
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 3c4f24202f5c8fd161524f8c0f9fc0bf15872c44 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 23:10:22 +0300
Subject: [PATCH 138/236] Change the name of parties css

---
 client/parties/styles/parties.css         | 4 ----
 client/parties/styles/parties.import.less | 4 ++++
 2 files changed, 4 insertions(+), 4 deletions(-)
 delete mode 100644 client/parties/styles/parties.css
 create mode 100644 client/parties/styles/parties.import.less

diff --git a/client/parties/styles/parties.css b/client/parties/styles/parties.css
deleted file mode 100644
index 219ff39..0000000
--- a/client/parties/styles/parties.css
+++ /dev/null
@@ -1,4 +0,0 @@
-.angular-google-map-container {
-    height: 400px;
-    width: 400px;
-}
\ No newline at end of file
diff --git a/client/parties/styles/parties.import.less b/client/parties/styles/parties.import.less
new file mode 100644
index 0000000..219ff39
--- /dev/null
+++ b/client/parties/styles/parties.import.less
@@ -0,0 +1,4 @@
+.angular-google-map-container {
+    height: 400px;
+    width: 400px;
+}
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 9105b34bd47773f9c0e4392a8b8eb62e2607aefe Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 23:10:50 +0300
Subject: [PATCH 139/236] Step 17.4: Add import to parties LESS file

---
 client/styles/main.less | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/client/styles/main.less b/client/styles/main.less
index 6acada4..87c5240 100644
--- a/client/styles/main.less
+++ b/client/styles/main.less
@@ -5,4 +5,7 @@ body {
     .navbar {
         background-color: #ffffff;
     }
-}
\ No newline at end of file
+}
+
+
+@import "../parties/styles/parties.import.less";
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 208b8159514251535c84ad334e0ea89fac481d56 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Mon, 17 Aug 2015 23:16:28 +0300
Subject: [PATCH 140/236] Update packages to step 17

---
 .meteor/packages | 2 ++
 .meteor/versions | 3 +++
 2 files changed, 5 insertions(+)

diff --git a/.meteor/packages b/.meteor/packages
index f8c5347..a734f07 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -15,3 +15,5 @@ angularutils:pagination
 tmeasday:publish-counts
 email
 angularui:angular-google-maps
+less
+angular:angular-material
diff --git a/.meteor/versions b/.meteor/versions
index 5a2077d..479ffc4 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -6,6 +6,9 @@ accounts-twitter@1.0.4
 accounts-ui@1.1.5
 accounts-ui-unstyled@1.1.7
 angular:angular@1.4.4
+angular:angular-animate@1.4.4
+angular:angular-aria@1.4.4
+angular:angular-material@0.10.1
 angularui:angular-google-maps@2.1.5
 angularui:angular-ui-router@0.2.15
 angularutils:pagination@0.7.0
-- 
2.3.2 (Apple Git-55)


From c9a37b3b6c4b3a7ec6b20c6edf8abc0d2980216d Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 16:38:35 +0300
Subject: [PATCH 141/236] Step 18.1: Add the ngMaterial dependency

---
 client/lib/app.js | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/client/lib/app.js b/client/lib/app.js
index 980e7c3..d4e8b68 100644
--- a/client/lib/app.js
+++ b/client/lib/app.js
@@ -2,7 +2,8 @@ angular.module('socially',[
   'angular-meteor',
   'ui.router',
   'angularUtils.directives.dirPagination',
-  'uiGmapgoogle-maps'
+  'uiGmapgoogle-maps',
+  'ngMaterial'
 ]);
 function onReady() {
   angular.bootstrap(document, ['socially']);
-- 
2.3.2 (Apple Git-55)


From 6dbb2f9474870c940388e8f75e900f69f5a110ac Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 16:42:59 +0300
Subject: [PATCH 142/236] Step 18.2: Update the index.html to use
 angular-material

---
 client/index.html | 22 ++++++++++------------
 1 file changed, 10 insertions(+), 12 deletions(-)

diff --git a/client/index.html b/client/index.html
index 00d1dc0..62b0921 100644
--- a/client/index.html
+++ b/client/index.html
@@ -1,20 +1,18 @@
 <head>
+  <meta name="viewport" content="width=device-width, initial-scale=1">
   <base href="/">
 </head>
-<body>
 
-<div>
-  <header class="navbar navbar-fixed-top">
-    <div class="container-fluid">
-      <div class="navbar-header">
-        <h1>
-          <a href="/parties">Home</a>
-        </h1>
-      </div>
+<body layout="column">
+  <md-toolbar md-scroll-shrink layout="row" layout-align="start center" layout-padding>
+    <div>
+      <a href="/parties">Parties</a>
+    </div>
+    <span flex></span>
+
+    <div class="navbar-right navbar-text">
       <meteor-include src="loginButtons"></meteor-include>
     </div>
-  </header>
+  </md-toolbar>
   <div ui-view class="container-fluid"></div>
-</div>
-
 </body>
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 512622984525097c773c9df80e2da4c22f605186 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 16:44:19 +0300
Subject: [PATCH 143/236] Step 18.3: Update parties list to use
 angular-material

---
 client/parties/views/parties-list.ng.html | 165 ++++++++++++++++++------------
 1 file changed, 101 insertions(+), 64 deletions(-)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index f87b68d..0b2cc34 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -1,72 +1,109 @@
-<form ng-show="$root.currentUser">
-  <h2>Create a new party:</h2>
-  <label>Name</label>
-  <input ng-model="newParty.name">
-  <label>Description</label>
-  <input ng-model="newParty.description">
-  <label>Public</label>
-  <input type="checkbox" ng-model="newParty.public">
-  <button ng-click="newParty.owner=$root.currentUser._id;parties.push(newParty); newParty='';">Add</button>
-</form>
-<div ng-hide="$root.currentUser || $root.loggingIn">
-  Log in to create a party!
-</div>
-<ul>
-  <h1>Parties:</h1>
-  <div>
-    <input type="search" ng-model="search" placeholder="Search">
-    <select ng-model="orderProperty">
-      <option value="1">Ascending</option>
-      <option value="-1">Descending</option>
-    </select>
+<md-content layout-padding>
+  <div layout="column">
+    <md-whiteframe class="md-whiteframe-z1" layout
+                   layout-align="center center"
+                   ng-hide="$root.currentUser || $root.loggingIn">
+      <span>Log in to create a party!</span>
+    </md-whiteframe>
+    <form ng-show="$root.currentUser">
+      <h2 class="md-headline">Create a new party:</h2>
+      <md-input-container>
+        <label>Name</label>
+        <input ng-model="newParty.name" id="nameInput"
+               type="text" aria-label="Name">
+      </md-input-container>
+      <md-input-container>
+        <label>Description</label>
+        <input ng-model="newParty.description" id="description"
+               type="text" aria-label="Description">
+      </md-input-container>
+      <md-checkbox ng-model="newParty.public"
+                   id="public" aria-label="Public">
+        Public
+      </md-checkbox>
+      <md-button ng-click="newParty.owner=$root.currentUser._id;parties.push(newParty); newParty='';">
+        Add</md-button>
+    </form>
   </div>
-  <div class="angular-google-map-container">
-    <ui-gmap-google-map center="map.center" zoom="map.zoom">
-      <ui-gmap-markers models="parties" coords="'location'" click="onClicked()"
-                       fit="true" idkey="'_id'" doRebuildAll="true">
-      </ui-gmap-markers>
-    </ui-gmap-google-map>
-  </div>
-  <li dir-paginate="party in parties | itemsPerPage: perPage" total-items="partiesCount.count">
-    <a href="/parties/{{party._id}}">{{party.name}}</a>
-    <p>{{party.description}}</p>
-    <button ng-click="remove(party)" ng-show="$root.currentUser && $root.currentUser._id == party.owner">X</button>
 
-    <div ng-show="$root.currentUser">
-      <input type="button" value="I'm going!" ng-click="rsvp(party._id, 'yes')">
-      <input type="button" value="Maybe" ng-click="rsvp(party._id, 'maybe')">
-      <input type="button" value="No" ng-click="rsvp(party._id, 'no')">
-    </div>
-    <div ng-hide="$root.currentUser">
-      <i>Sign in to RSVP for this party.</i>
+  <div layout="column">
+    <h2 class="md-headline">Parties:</h2>
+    <form layout="row">
+      <md-input-container md-no-float>
+        <md-icon md-svg-icon="action:ic_search_24px"></md-icon>
+        <input type="text" ng-model="search" id="search"
+               placeholder="Search" aria-label="Search">
+      </md-input-container>
+      <span flex></span>
+      <md-input-container>
+        <md-select ng-model="orderProperty" placeholder="Sort Order">
+          <md-option value="1">Ascending</md-option>
+          <md-option value="-1">Descending</md-option>
+        </md-select>
+      </md-input-container>
+    </form>
+    <div layout="row">
+      <div flex></div>
+      <div flex="60" class="angular-google-map-container">
+        <ui-gmap-google-map center="map.center" zoom="map.zoom">
+          <ui-gmap-markers models="parties" coords="'location'" click="onClicked()"
+                           fit="true" idkey="'_id'" doRebuildAll="true">
+          </ui-gmap-markers>
+        </ui-gmap-google-map>
+      </div>
+      <div flex></div>
     </div>
+  </div>
+  <div layout="column" layout-padding>
+    <div dir-paginate="party in parties | itemsPerPage: perPage"
+         total-items="partiesCount.count" layout="column">
+      <div layout="row">
+        <div flex="80">
+          <h2><a href="/parties/{{party._id}}">{{party.name}}</a></h2>
+          <p>{{party.description}}</p>
+        </div>
+        <span flex></span>
+        <md-button ng-click="remove(party)"
+                   ng-show="$root.currentUser && $root.currentUser._id == party.owner">
+          <md-icon md-svg-icon="content:ic_clear_24px"></md-icon>
+        </md-button>
+      </div>
 
-    <div>
-      Who is coming:
-      Yes - {{ (party.rsvps | filter:{rsvp:'yes'}).length }}
-      Maybe - {{ (party.rsvps | filter:{rsvp:'maybe'}).length }}
-      No - {{ (party.rsvps | filter:{rsvp:'no'}).length }}
-      <div ng-repeat="rsvp in party.rsvps | filter:{rsvp:'yes'}">
-        {{ getUserById(rsvp.user) | displayName }} - {{ rsvp.rsvp }}
+      <div ng-show="$root.currentUser" layout="row">
+        <md-button ng-click="rsvp(party._id, 'yes')">I'm going!</md-button>
+        <md-button ng-click="rsvp(party._id, 'maybe')">Maybe</md-button>
+        <md-button ng-click="rsvp(party._id, 'no')">No</md-button>
       </div>
-      <div ng-repeat="rsvp in party.rsvps | filter:{rsvp:'maybe'}">
-        {{ getUserById(rsvp.user) | displayName }} - {{ rsvp.rsvp }}
+      <div ng-if="party.public">
+        Everyone is invited
       </div>
-      <div ng-repeat="rsvp in party.rsvps | filter:{rsvp:'no'}">
-        {{ getUserById(rsvp.user) | displayName }} - {{ rsvp.rsvp }}
+      <div ng-hide="$root.currentUser">
+        <i>Sign in to RSVP for this party.</i>
       </div>
-    </div>
-    <ul ng-if="!party.public">
-      Users who not responded:
-      <li ng-repeat="invitedUser in outstandingInvitations(party)">
-        {{ invitedUser | displayName }}
-      </li>
-    </ul>
-    <div ng-if="party.public">
-      Everyone is invited
-    </div>
 
-    <p><small>Posted by {{ creator(party) | displayName }}</small></p>
-  </li>
-</ul>
-<dir-pagination-controls on-page-change="pageChanged(newPageNumber)"></dir-pagination-controls>
+      <div>
+        <strong>Who is coming:</strong>
+        Yes - {{ (party.rsvps | filter:{rsvp:'yes'}).length }}
+        Maybe - {{ (party.rsvps | filter:{rsvp:'maybe'}).length }}
+        No - {{ (party.rsvps | filter:{rsvp:'no'}).length }}
+        <div ng-repeat="rsvp in party.rsvps | filter:{rsvp:'yes'}">
+          {{ getUserById(rsvp.user) | displayName }} - {{ rsvp.rsvp }}
+        </div>
+        <div ng-repeat="rsvp in party.rsvps | filter:{rsvp:'maybe'}">
+          {{ getUserById(rsvp.user) | displayName }} - {{ rsvp.rsvp }}
+        </div>
+        <div ng-repeat="rsvp in party.rsvps | filter:{rsvp:'no'}">
+          {{ getUserById(rsvp.user) | displayName }} - {{ rsvp.rsvp }}
+        </div>
+      </div>
+      <md-list ng-if="!party.public">
+        Users who haven't responded:
+        <md-list-item ng-repeat="invitedUser in outstandingInvitations(party)">
+          {{ invitedUser | displayName }}
+        </md-list-item>
+      </md-list>
+      <p><small>Posted by {{ creator(party) | displayName }}</small></p>
+    </div>
+  </div>
+  <dir-pagination-controls on-page-change="pageChanged(newPageNumber)"></dir-pagination-controls>
+</md-content>
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 32b4cbe7b9c342455c0c352af19b5deca97e158f Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 16:46:41 +0300
Subject: [PATCH 144/236] Update packages for step 18

---
 .meteor/packages | 1 +
 .meteor/versions | 1 +
 2 files changed, 2 insertions(+)

diff --git a/.meteor/packages b/.meteor/packages
index a734f07..a7ed332 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -17,3 +17,4 @@ email
 angularui:angular-google-maps
 less
 angular:angular-material
+planettraining:material-design-icons
diff --git a/.meteor/versions b/.meteor/versions
index 479ffc4..d10d60b 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -52,6 +52,7 @@ oauth1@1.1.4
 oauth2@1.1.3
 observe-sequence@1.0.6
 ordered-dict@1.0.3
+planettraining:material-design-icons@2.0.0
 random@1.0.3
 reactive-dict@1.1.0
 reactive-var@1.0.5
-- 
2.3.2 (Apple Git-55)


From 2e457cc6cf7eea424a53f24b3808fabc6609956c Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 16:48:05 +0300
Subject: [PATCH 145/236] Step 18.4: Add icons definitions to the module

---
 client/lib/app.js | 14 +++++++++++++-
 1 file changed, 13 insertions(+), 1 deletion(-)

diff --git a/client/lib/app.js b/client/lib/app.js
index d4e8b68..4c43c2d 100644
--- a/client/lib/app.js
+++ b/client/lib/app.js
@@ -1,10 +1,22 @@
-angular.module('socially',[
+angular.module('socially', [
   'angular-meteor',
   'ui.router',
   'angularUtils.directives.dirPagination',
   'uiGmapgoogle-maps',
   'ngMaterial'
 ]);
+
+angular.module('socially').config(['$mdIconProvider', function ($mdIconProvider) {
+  $mdIconProvider
+    .iconSet("social", "/packages/planettraining_material-design-icons/bower_components/material-design-icons/sprites/svg-sprite/svg-sprite-social.svg")
+    .iconSet("action", "/packages/planettraining_material-design-icons/bower_components/material-design-icons/sprites/svg-sprite/svg-sprite-action.svg")
+    .iconSet("communication", "/packages/planettraining_material-design-icons/bower_components/material-design-icons/sprites/svg-sprite/svg-sprite-communication.svg")
+    .iconSet("content", "/packages/planettraining_material-design-icons/bower_components/material-design-icons/sprites/svg-sprite/svg-sprite-content.svg")
+    .iconSet("toggle", "/packages/planettraining_material-design-icons/bower_components/material-design-icons/sprites/svg-sprite/svg-sprite-toggle.svg")
+    .iconSet("navigation", "/packages/planettraining_material-design-icons/bower_components/material-design-icons/sprites/svg-sprite/svg-sprite-navigation.svg")
+    .iconSet("image", "/packages/planettraining_material-design-icons/bower_components/material-design-icons/sprites/svg-sprite/svg-sprite-image.svg");
+}]);
+
 function onReady() {
   angular.bootstrap(document, ['socially']);
 }
-- 
2.3.2 (Apple Git-55)


From 0ecde0a720a79bc9c41228a951facf81de009a5e Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 16:48:40 +0300
Subject: [PATCH 146/236] Step 18.5: Update party details view to use
 angular-material

---
 client/parties/views/party-details.ng.html | 67 ++++++++++++++++++++----------
 1 file changed, 46 insertions(+), 21 deletions(-)

diff --git a/client/parties/views/party-details.ng.html b/client/parties/views/party-details.ng.html
index 0018231..fa63e46 100644
--- a/client/parties/views/party-details.ng.html
+++ b/client/parties/views/party-details.ng.html
@@ -1,24 +1,49 @@
-Here you will see and change the details of the party:
+<legend>
+  Here you will see and change the details of the party:
+</legend>
+<form layout="column">
+  <md-input-container>
+    <label>Party Name</label>
+    <input ng-model="party.name"
+           ng-disabled="party.owner != $root.currentUser._id"
+           type="text" aria-label="Name">
+  </md-input-container>
+  <md-input-container>
+    <label>Party Description</label>
+    <input ng-model="party.description"
+           ng-disabled="party.owner != $root.currentUser._id"
+           type="text" aria-label="Description">
+  </md-input-container>
+  <md-checkbox ng-model="party.public"
+               ng-disabled="party.owner != $root.currentUser._id"
+               aria-label="Public">
+    Is public
+  </md-checkbox>
 
-<input ng-model="party.name" ng-disabled="party.owner != $root.currentUser._id">
-<input ng-model="party.description" ng-disabled="party.owner != $root.currentUser._id">
-<label>Is public</label>
-<input type="checkbox" ng-model="party.public" ng-disabled="party.owner != $root.currentUser._id">
+  <div layout="row" layout-align="left">
+    <md-button ng-click="save()">Save</md-button>
+    <md-button ng-click="reset()">Reset form</md-button>
+    <md-button ng-href="/parties">Cancel</md-button>
+  </div>
 
-<ul ng-show="canInvite()">
-  Users to invite:
-  <li ng-repeat="user in users | uninvited:party">
-    <div>{{ user | displayName }}</div>
-    <button ng-click="invite(user)">Invite</button>
-  </li>
-  <li ng-if="(users | uninvited:party).length <= 0">
-    Everyone are already invited.
-  </li>
-</ul>
+  <md-list ng-show="canInvite()">
+    <md-subheader class="md-no-sticky">Users to invite:</md-subheader>
+    <md-list-item ng-repeat="user in users | uninvited:party">
+      <div>{{ user | displayName }}</div>
+      <md-button ng-click="invite(user)">Invite</md-button>
+    </md-list-item>
+    <md-list-item ng-if="(users | uninvited:party).length <= 0">
+      Everyone are already invited.
+    </md-list-item>
+  </md-list>
 
-<div class="angular-google-map-container">
-  <ui-gmap-google-map center="map.center" events="map.events" zoom="map.zoom">
-    <ui-gmap-marker coords="party.location" options="map.marker.options" events="map.marker.events" idkey="party._id">
-    </ui-gmap-marker>
-  </ui-gmap-google-map>
-</div>
+  <div class="angular-google-map-container">
+    <ui-gmap-google-map center="map.center" events="map.events" zoom="map.zoom">
+      <ui-gmap-marker coords="party.location"
+                      options="map.marker.options"
+                      events="map.marker.events"
+                      idkey="party._id">
+      </ui-gmap-marker>
+    </ui-gmap-google-map>
+  </div>
+</form>
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From f7815df4e3c36a8ee4949d4f54eef3420b48f759 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 16:55:44 +0300
Subject: [PATCH 147/236] Step 18.6: Custom auth buttons

---
 client/index.html | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/client/index.html b/client/index.html
index 62b0921..51398ae 100644
--- a/client/index.html
+++ b/client/index.html
@@ -10,9 +10,10 @@
     </div>
     <span flex></span>
 
-    <div class="navbar-right navbar-text">
-      <meteor-include src="loginButtons"></meteor-include>
-    </div>
+    <md-button ng-href="/login" ng-hide="$root.currentUser">Login</md-button>
+    <md-button ng-href="/register" ng-hide="$root.currentUser">Sign up</md-button>
+    <div ng-show="$root.currentUser">{{ $root.currentUser }}</div>
+    <md-button ng-href="/logout" ng-show="$root.currentUser">Logout</md-button>
   </md-toolbar>
   <div ui-view class="container-fluid"></div>
 </body>
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From ed4c68b89abee82f5f162dee56043bb0a43a0f74 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 16:57:44 +0300
Subject: [PATCH 148/236] Step 18.7: Add custom auth routes

---
 client/routes.js | 32 +++++++++++++++++++++++++++++++-
 1 file changed, 31 insertions(+), 1 deletion(-)

diff --git a/client/routes.js b/client/routes.js
index 4626576..19da1be 100644
--- a/client/routes.js
+++ b/client/routes.js
@@ -28,7 +28,37 @@ angular.module("socially").config(['$urlRouterProvider', '$stateProvider', '$loc
             return $meteor.requireUser();
           }]
         }
-      });
+      })
+      .state('login', {
+        url: '/login',
+        templateUrl: 'client/users/views/login.ng.html',
+        controller: 'LoginCtrl',
+        controllerAs: 'lc'
+      })
+      .state('register',{
+        url: '/register',
+        templateUrl: 'client/users/views/register.ng.html',
+        controller: 'RegisterCtrl',
+        controllerAs: 'rc'
+      })
+      .state('resetpw', {
+        url: '/resetpw',
+        templateUrl: 'client/users/views/reset-password.ng.html',
+        controller: 'ResetCtrl',
+        controllerAs: 'rpc'
+      })
+      .state('logout', {
+        url: '/logout',
+        resolve: {
+          "logout": ['$meteor', '$state', function($meteor, $state) {
+            return $meteor.logout().then(function(){
+              $state.go('parties');
+            }, function(err){
+              console.log('logout error - ', err);
+            });
+          }]
+        }
+      })
 
     $urlRouterProvider.otherwise("/parties");
   }]);
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 1f88f78358df3594ebbaeb56bc3c2999cfb159ad Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 16:59:00 +0300
Subject: [PATCH 149/236] Step 18.8: Create login controller

---
 client/users/controllers/login.js | 23 +++++++++++++++++++++++
 1 file changed, 23 insertions(+)
 create mode 100644 client/users/controllers/login.js

diff --git a/client/users/controllers/login.js b/client/users/controllers/login.js
new file mode 100644
index 0000000..d1e4664
--- /dev/null
+++ b/client/users/controllers/login.js
@@ -0,0 +1,23 @@
+angular.module("socially").controller("LoginCtrl", ['$meteor', '$state',
+  function ($meteor, $state) {
+    var vm = this;
+
+    vm.credentials = {
+      email: '',
+      password: ''
+    };
+
+    vm.error = '';
+
+    vm.login = function () {
+      $meteor.loginWithPassword(vm.credentials.email, vm.credentials.password).then(
+        function () {
+          $state.go('parties');
+        },
+        function (err) {
+          vm.error = 'Login error - ' + err;
+        }
+      );
+    };
+  }
+]);
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 69e4eaf04e492426184a4cfb892195696f21088d Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 17:00:26 +0300
Subject: [PATCH 150/236] Step 18.9: Create login view

---
 client/users/views/login.ng.html | 33 +++++++++++++++++++++++++++++++++
 1 file changed, 33 insertions(+)
 create mode 100644 client/users/views/login.ng.html

diff --git a/client/users/views/login.ng.html b/client/users/views/login.ng.html
new file mode 100644
index 0000000..2ad8a07
--- /dev/null
+++ b/client/users/views/login.ng.html
@@ -0,0 +1,33 @@
+<md-content layout="row">
+  <span flex></span>
+  <md-whiteframe layout="column" flex="50">
+    <div layout="row" layout-align="space-around center">
+      <div>Login with:</div>
+      <md-button>Twitter</md-button>
+      <md-button>Facebook</md-button>
+    </div>
+    <div ng-show="lc.error" class="md-warn">
+      <small>{{ lc.error }}</small>
+    </div>
+    <form layout="column">
+      <md-input-container>
+        <md-icon md-svg-icon="content:ic_mail_24px"></md-icon>
+        <input type="text" ng-model="lc.credentials.email"
+               placeholder="email" aria-label="email"/>
+      </md-input-container>
+      <md-input-container>
+        <md-icon md-svg-icon="action:ic_lock_open_24px"></md-icon>
+        <input type="password" ng-model="lc.credentials.password"
+               placeholder="password" aria-label="password"/>
+      </md-input-container>
+      <md-button class="md-raised md-primary" ng-click="lc.login()"
+                 aria-label="login">Sign In
+      </md-button>
+    </form>
+    <div layout="row" layout-align="space-around center">
+      <a href="/resetpw">Forgot password?</a>
+      <a href="/register">Create an account</a>
+    </div>
+  </md-whiteframe>
+  <span flex></span>
+</md-content>
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 9f5c7915be23e47a448c0501215d2ef651af0203 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 17:01:05 +0300
Subject: [PATCH 151/236] Step 18.10: Create register controller

---
 client/users/controllers/register.js | 23 +++++++++++++++++++++++
 1 file changed, 23 insertions(+)
 create mode 100644 client/users/controllers/register.js

diff --git a/client/users/controllers/register.js b/client/users/controllers/register.js
new file mode 100644
index 0000000..f21b5f5
--- /dev/null
+++ b/client/users/controllers/register.js
@@ -0,0 +1,23 @@
+angular.module("socially").controller("RegisterCtrl", ['$meteor', '$state',
+  function ($meteor, $state) {
+    var vm = this;
+
+    vm.credentials = {
+      email: '',
+      password: ''
+    };
+
+    vm.error = '';
+
+    vm.register = function () {
+      $meteor.createUser(vm.credentials).then(
+        function () {
+          $state.go('parties');
+        },
+        function (err) {
+          vm.error = 'Registration error - ' + err;
+        }
+      );
+    };
+  }
+]);
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 7fc6c3446fba119b520e8f790d6d473312ec1f50 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 17:01:35 +0300
Subject: [PATCH 152/236] Step 18.11: Create register view

---
 client/users/views/register.ng.html | 32 ++++++++++++++++++++++++++++++++
 1 file changed, 32 insertions(+)
 create mode 100644 client/users/views/register.ng.html

diff --git a/client/users/views/register.ng.html b/client/users/views/register.ng.html
new file mode 100644
index 0000000..c36f39d
--- /dev/null
+++ b/client/users/views/register.ng.html
@@ -0,0 +1,32 @@
+<md-content layout="row">
+  <span flex></span>
+  <md-whiteframe layout="column" flex="50">
+    <div layout="row" layout-align="space-around center">
+      <div>Login with:</div>
+      <md-button>Twitter</md-button>
+      <md-button>Facebook</md-button>
+    </div>
+    <div ng-show="rc.error" class="md-warn">
+      <small>{{ rc.error }}</small>
+    </div>
+    <form layout="column">
+      <md-input-container>
+        <md-icon md-svg-icon="content:ic_mail_24px"></md-icon>
+        <input type="text" ng-model="rc.credentials.email"
+               placeholder="email" aria-label="email"/>
+      </md-input-container>
+      <md-input-container>
+        <md-icon md-svg-icon="action:ic_lock_open_24px"></md-icon>
+        <input type="password" ng-model="rc.credentials.password"
+               placeholder="password" aria-label="password"/>
+      </md-input-container>
+      <md-button class="md-raised md-primary"
+                 ng-click="rc.register()">Create Account
+      </md-button>
+    </form>
+    <div layout="row" layout-align="end center">
+      <a href="/login">Login</a>
+    </div>
+  </md-whiteframe>
+  <span flex></span>
+</md-content>
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 0c14c9f60a1ddef13d189b7e7cd74929d5ed558c Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 17:02:02 +0300
Subject: [PATCH 153/236] Step 18.12: Create reset controller

---
 client/users/controllers/reset.js | 22 ++++++++++++++++++++++
 1 file changed, 22 insertions(+)
 create mode 100644 client/users/controllers/reset.js

diff --git a/client/users/controllers/reset.js b/client/users/controllers/reset.js
new file mode 100644
index 0000000..2c40b6b
--- /dev/null
+++ b/client/users/controllers/reset.js
@@ -0,0 +1,22 @@
+angular.module("socially").controller("ResetCtrl", ['$meteor', '$state',
+  function ($meteor, $state) {
+    var vm = this;
+
+    vm.credentials = {
+      email: ''
+    };
+
+    vm.error = '';
+
+    vm.reset = function () {
+      $meteor.forgotPassword(vm.credentials.email).then(
+        function () {
+          $state.go('parties');
+        },
+        function (err) {
+          vm.error = 'Error sending forgot password email - ' + err;
+        }
+      );
+    };
+  }
+]);
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From a259170dc67a96ca3d3a3fcb7dfb53a447e4c4df Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 17:02:39 +0300
Subject: [PATCH 154/236] Step 18.13: Create reset view

---
 client/users/views/reset-password.ng.html | 27 +++++++++++++++++++++++++++
 1 file changed, 27 insertions(+)
 create mode 100644 client/users/views/reset-password.ng.html

diff --git a/client/users/views/reset-password.ng.html b/client/users/views/reset-password.ng.html
new file mode 100644
index 0000000..f365b52
--- /dev/null
+++ b/client/users/views/reset-password.ng.html
@@ -0,0 +1,27 @@
+<md-content layout="row">
+  <span flex></span>
+  <md-whiteframe layout="column" flex="50">
+    <div layout="row" layout-align="space-around center">
+      <div>Login with:</div>
+      <md-button>Twitter</md-button>
+      <md-button>Facebook</md-button>
+    </div>
+    <div ng-show="rpc.error" class="md-warn">
+      <small>{{ rpc.error }}</small>
+    </div>
+    <form layout="column">
+      <md-input-container>
+        <md-icon md-svg-icon="content:ic_mail_24px"></md-icon>
+        <input type="text" ng-model="rpc.credentials.email"
+               placeholder="email" aria-label="email"/>
+      </md-input-container>
+      <md-button class="md-raised md-primary"
+                 ng-click="rpc.reset()" aria-label="login">Reset password
+      </md-button>
+    </form>
+    <div layout="row" layout-align="end center">
+      <a href="/login">Login</a>
+    </div>
+  </md-whiteframe>
+  <span flex></span>
+</md-content>
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 415b58feab74eefb59f199bb8e561888657616f0 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 17:44:26 +0300
Subject: [PATCH 155/236] Step 20.1: Create the Images collection and publish
 it

---
 model/images.js | 31 +++++++++++++++++++++++++++++++
 1 file changed, 31 insertions(+)
 create mode 100644 model/images.js

diff --git a/model/images.js b/model/images.js
new file mode 100644
index 0000000..5cec451
--- /dev/null
+++ b/model/images.js
@@ -0,0 +1,31 @@
+Images = new FS.Collection("images", {
+  stores: [
+    new FS.Store.GridFS("original")
+  ],
+  filter: {
+    allow: {
+      contentTypes: ['image/*']
+    }
+  }
+});
+
+if (Meteor.isServer) {
+  Images.allow({
+    insert: function (userId) {
+      return (userId ? true : false);
+    },
+    remove: function (userId) {
+      return (userId ? true : false);
+    },
+    download: function () {
+      return true;
+    },
+    update: function (userId) {
+      return (userId ? true : false);
+    }
+  });
+
+  Meteor.publish('images', function() {
+    return Images.find({});
+  });
+}
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 58ed8f1a9641c525871049873c27ac559f0ddb7c Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 17:45:31 +0300
Subject: [PATCH 156/236] Step 20.2: Add the collectionFs to the controller

---
 client/parties/controllers/partiesList.js | 1 +
 1 file changed, 1 insertion(+)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index 03e6f34..5413b67 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -7,6 +7,7 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '
     $scope.orderProperty = '1';
 
     $scope.users = $meteor.collection(Meteor.users, false).subscribe('users');
+    $scope.images = $meteor.collectionFS(Images, false, Images).subscribe('images');
 
     $scope.parties = $meteor.collection(function() {
       return Parties.find({}, {
-- 
2.3.2 (Apple Git-55)


From 933f83f2b69b492c6a58979c6bdb007a884832f5 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 17:48:41 +0300
Subject: [PATCH 157/236] Step 20.3: Add dependency for 'ngFileUpload' to the
 module

---
 client/lib/app.js | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/client/lib/app.js b/client/lib/app.js
index 4c43c2d..e616744 100644
--- a/client/lib/app.js
+++ b/client/lib/app.js
@@ -3,7 +3,8 @@ angular.module('socially', [
   'ui.router',
   'angularUtils.directives.dirPagination',
   'uiGmapgoogle-maps',
-  'ngMaterial'
+  'ngMaterial',
+  'ngFileUpload'
 ]);
 
 angular.module('socially').config(['$mdIconProvider', function ($mdIconProvider) {
-- 
2.3.2 (Apple Git-55)


From fbb0a3e88e16550466f6bd735567108ebb386fed Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 17:49:41 +0300
Subject: [PATCH 158/236] Step 20.4: Add modal for file uploading

---
 client/parties/controllers/partiesList.js | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index 5413b67..6212856 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -81,4 +81,14 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '
         }
       );
     };
+
+    $scope.openAddImageModal = function() {
+      $mdDialog.show({
+        controller: 'AddPhotoCtrl',
+        templateUrl: 'client/parties/views/add-photo-modal.ng.html',
+        scope: $scope.$new()
+      }).then(function(image) {
+        // We will add here later the logic to handle the link between the image and the party
+      });
+    };
   }]);
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 5327a912be8eb21d53bfa93177ba97b5ff822653 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 17:51:13 +0300
Subject: [PATCH 159/236] Step 20.5: Add button to open the file upload modal

---
 client/parties/views/parties-list.ng.html | 19 +++++++++++++++++--
 1 file changed, 17 insertions(+), 2 deletions(-)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index 0b2cc34..8d94321 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -21,13 +21,25 @@
                    id="public" aria-label="Public">
         Public
       </md-checkbox>
+      <md-whiteframe class="md-whiteframe-z1" layout="column">
+        <div layout="row" class="images-container-title">
+          <div flex>
+            <h3>Add photos to your party!</h3>
+          </div>
+          <div>
+            <md-button class="md-raised" ng-click="openAddImageModal()">Add Photo</md-button>
+          </div>
+        </div>
+      </md-whiteframe>
       <md-button ng-click="newParty.owner=$root.currentUser._id;parties.push(newParty); newParty='';">
-        Add</md-button>
+        Add
+      </md-button>
     </form>
   </div>
 
   <div layout="column">
     <h2 class="md-headline">Parties:</h2>
+
     <form layout="row">
       <md-input-container md-no-float>
         <md-icon md-svg-icon="action:ic_search_24px"></md-icon>
@@ -60,6 +72,7 @@
       <div layout="row">
         <div flex="80">
           <h2><a href="/parties/{{party._id}}">{{party.name}}</a></h2>
+
           <p>{{party.description}}</p>
         </div>
         <span flex></span>
@@ -102,7 +115,9 @@
           {{ invitedUser | displayName }}
         </md-list-item>
       </md-list>
-      <p><small>Posted by {{ creator(party) | displayName }}</small></p>
+      <p>
+        <small>Posted by {{ creator(party) | displayName }}</small>
+      </p>
     </div>
   </div>
   <dir-pagination-controls on-page-change="pageChanged(newPageNumber)"></dir-pagination-controls>
-- 
2.3.2 (Apple Git-55)


From e315423288ea76315e57513e26d2bcf70be7cc7b Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 17:53:08 +0300
Subject: [PATCH 160/236] Step 20.6: Create the modal view

---
 client/parties/views/add-photo-modal.ng.html | 33 ++++++++++++++++++++++++++++
 1 file changed, 33 insertions(+)
 create mode 100644 client/parties/views/add-photo-modal.ng.html

diff --git a/client/parties/views/add-photo-modal.ng.html b/client/parties/views/add-photo-modal.ng.html
new file mode 100644
index 0000000..d58aa78
--- /dev/null
+++ b/client/parties/views/add-photo-modal.ng.html
@@ -0,0 +1,33 @@
+<md-dialog class="add-photo-dialog">
+  <form>
+    <md-toolbar>
+      <div class="md-toolbar-tools">
+        <h2>Add Photos To Your Event</h2>
+      </div>
+    </md-toolbar>
+    <md-dialog-content>
+      <div>
+        <div ngf-drop ngf-select
+             ngf-change="addImages($files)"
+             ngf-drag-over-class="{accept:'dragover', reject:'dragover-err', delay:100}" class="drop-box"
+             ngf-multiple="false" ngf-allow-dir="false" ngf-accept="'image/*'"
+             ngf-drop-available="dropAvailable">
+          <div>Click here to select image</div>
+          <div>
+            <strong>OR</strong>
+          </div>
+          <div ng-show="dropAvailable">You can also drop image to here</div>
+        </div>
+      </div>
+    </md-dialog-content>
+    <div class="md-actions" layout="row">
+      <span flex></span>
+      <md-button ng-click="close()" class="md-primary">
+        Done
+      </md-button>
+      <md-button ng-click="close()" class="md-warn">
+        Cancel
+      </md-button>
+    </div>
+  </form>
+</md-dialog>
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From d2049dddd976a9943d75ba8ba2642fcd552475de Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 17:54:05 +0300
Subject: [PATCH 161/236] Step 20.7: Add some CSS to make the drop-zone look
 better

---
 client/parties/styles/parties.import.less | 18 ++++++++++++++++++
 1 file changed, 18 insertions(+)

diff --git a/client/parties/styles/parties.import.less b/client/parties/styles/parties.import.less
index 219ff39..dd5ddd4 100644
--- a/client/parties/styles/parties.import.less
+++ b/client/parties/styles/parties.import.less
@@ -1,4 +1,22 @@
 .angular-google-map-container {
     height: 400px;
     width: 400px;
+}
+
+.drop-box {
+    background: #F8F8F8;
+    border: 5px dashed #DDD;
+    width: 230px;
+    height: 65px;
+    text-align: center;
+    padding-top: 25px;
+    margin-left: 10px;
+}
+
+.drop-box.dragover {
+    border: 5px dashed blue;
+}
+
+.drop-box.dragover-err {
+    border: 5px dashed red;
 }
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From c77ba8f4946913f517c73228e9f738352ea3d57d Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 17:55:18 +0300
Subject: [PATCH 162/236] Step 20.8: Create the modal controller

---
 client/parties/controllers/addPhotoCtrl.js | 10 ++++++++++
 1 file changed, 10 insertions(+)
 create mode 100644 client/parties/controllers/addPhotoCtrl.js

diff --git a/client/parties/controllers/addPhotoCtrl.js b/client/parties/controllers/addPhotoCtrl.js
new file mode 100644
index 0000000..072392f
--- /dev/null
+++ b/client/parties/controllers/addPhotoCtrl.js
@@ -0,0 +1,10 @@
+angular.module("socially").controller("AddPhotoCtrl", ['$scope', '$meteor', '$rootScope', '$state', '$mdDialog',
+  function($scope, $meteor, $rootScope, $state, $mdDialog) {
+    $scope.addImages = function (files) {
+      if (files.length > 0) {
+        $scope.images.save(files[0]);
+      }
+    };
+
+    $scope.close = $mdDialog.hide;
+  }]);
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 29b1c3da7a2a256383b9cb06707d7c2a4604a69f Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 17:56:49 +0300
Subject: [PATCH 163/236] Step 20.4.1: Add $mdDialog dependency

---
 client/parties/controllers/partiesList.js | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index 6212856..5ab977e 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -1,5 +1,5 @@
-angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '$rootScope', '$state',
-  function($scope, $meteor, $rootScope, $state){
+angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '$rootScope', '$state', '$mdDialog',
+  function($scope, $meteor, $rootScope, $state, $mdDialog){
 
     $scope.page = 1;
     $scope.perPage = 3;
-- 
2.3.2 (Apple Git-55)


From 0ad0db2eaee70e5aa0e2c940f84c242bd4beee76 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 18:00:33 +0300
Subject: [PATCH 164/236] Undo part of the code for the tutorial

---
 client/parties/views/parties-list.ng.html | 19 ++-----------------
 1 file changed, 2 insertions(+), 17 deletions(-)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index 8d94321..0b2cc34 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -21,25 +21,13 @@
                    id="public" aria-label="Public">
         Public
       </md-checkbox>
-      <md-whiteframe class="md-whiteframe-z1" layout="column">
-        <div layout="row" class="images-container-title">
-          <div flex>
-            <h3>Add photos to your party!</h3>
-          </div>
-          <div>
-            <md-button class="md-raised" ng-click="openAddImageModal()">Add Photo</md-button>
-          </div>
-        </div>
-      </md-whiteframe>
       <md-button ng-click="newParty.owner=$root.currentUser._id;parties.push(newParty); newParty='';">
-        Add
-      </md-button>
+        Add</md-button>
     </form>
   </div>
 
   <div layout="column">
     <h2 class="md-headline">Parties:</h2>
-
     <form layout="row">
       <md-input-container md-no-float>
         <md-icon md-svg-icon="action:ic_search_24px"></md-icon>
@@ -72,7 +60,6 @@
       <div layout="row">
         <div flex="80">
           <h2><a href="/parties/{{party._id}}">{{party.name}}</a></h2>
-
           <p>{{party.description}}</p>
         </div>
         <span flex></span>
@@ -115,9 +102,7 @@
           {{ invitedUser | displayName }}
         </md-list-item>
       </md-list>
-      <p>
-        <small>Posted by {{ creator(party) | displayName }}</small>
-      </p>
+      <p><small>Posted by {{ creator(party) | displayName }}</small></p>
     </div>
   </div>
   <dir-pagination-controls on-page-change="pageChanged(newPageNumber)"></dir-pagination-controls>
-- 
2.3.2 (Apple Git-55)


From 9aa5b2daa4ae1f0b8f6e15456dfaacdc810e8de5 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 18:00:58 +0300
Subject: [PATCH 165/236] Step 20.5: Add button to open the file upload modal

---
 client/parties/views/parties-list.ng.html | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index 0b2cc34..5f961d3 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -21,6 +21,16 @@
                    id="public" aria-label="Public">
         Public
       </md-checkbox>
+      <md-whiteframe class="md-whiteframe-z1" layout="column">
+        <div layout="row" class="images-container-title">
+          <div flex>
+            <h3>Add photos to your party!</h3>
+          </div>
+          <div>
+            <md-button class="md-raised" ng-click="openAddImageModal()">Add Photo</md-button>
+          </div>
+        </div>
+      </md-whiteframe>
       <md-button ng-click="newParty.owner=$root.currentUser._id;parties.push(newParty); newParty='';">
         Add</md-button>
     </form>
-- 
2.3.2 (Apple Git-55)


From d1e9659e912f75f867a21f672a6779c2642e2a4e Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 18:35:11 +0300
Subject: [PATCH 166/236] Step 20.9: Add dependency for ngImgCrop

---
 client/lib/app.js | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/client/lib/app.js b/client/lib/app.js
index e616744..cbe0df0 100644
--- a/client/lib/app.js
+++ b/client/lib/app.js
@@ -4,7 +4,8 @@ angular.module('socially', [
   'angularUtils.directives.dirPagination',
   'uiGmapgoogle-maps',
   'ngMaterial',
-  'ngFileUpload'
+  'ngFileUpload',
+  'ngImgCrop'
 ]);
 
 angular.module('socially').config(['$mdIconProvider', function ($mdIconProvider) {
-- 
2.3.2 (Apple Git-55)


From 8eb406867a568787c24f799287c8a7ebe5155dd4 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 18:37:08 +0300
Subject: [PATCH 167/236] Step 20.10: Change the logic of addImages

---
 client/parties/controllers/addPhotoCtrl.js | 14 +++++++++++++-
 1 file changed, 13 insertions(+), 1 deletion(-)

diff --git a/client/parties/controllers/addPhotoCtrl.js b/client/parties/controllers/addPhotoCtrl.js
index 072392f..4926949 100644
--- a/client/parties/controllers/addPhotoCtrl.js
+++ b/client/parties/controllers/addPhotoCtrl.js
@@ -2,7 +2,19 @@ angular.module("socially").controller("AddPhotoCtrl", ['$scope', '$meteor', '$ro
   function($scope, $meteor, $rootScope, $state, $mdDialog) {
     $scope.addImages = function (files) {
       if (files.length > 0) {
-        $scope.images.save(files[0]);
+        var reader = new FileReader();
+
+        reader.onload = function (e) {
+          $scope.$apply(function() {
+            $scope.imgSrc = e.target.result;
+            $scope.myCroppedImage = '';
+          });
+        };
+
+        reader.readAsDataURL(files[0]);
+      }
+      else {
+        $scope.imgSrc = undefined;
       }
     };
 
-- 
2.3.2 (Apple Git-55)


From 1a34b5a7ff3980f14fdbcb894ed510a4f21593ef Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 18:38:13 +0300
Subject: [PATCH 168/236] Step 20.11: Usage of img-crop directive

---
 client/parties/views/add-photo-modal.ng.html | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/client/parties/views/add-photo-modal.ng.html b/client/parties/views/add-photo-modal.ng.html
index d58aa78..eeccf1d 100644
--- a/client/parties/views/add-photo-modal.ng.html
+++ b/client/parties/views/add-photo-modal.ng.html
@@ -18,6 +18,10 @@
           </div>
           <div ng-show="dropAvailable">You can also drop image to here</div>
         </div>
+        <div ng-show="imgSrc" class="ng-crop-container">
+          <h3>Great! Now edit & crop your image...</h3><br />
+          <img-crop image="imgSrc" result-image="myCroppedImage" area-type="square"></img-crop>
+        </div>
       </div>
     </md-dialog-content>
     <div class="md-actions" layout="row">
-- 
2.3.2 (Apple Git-55)


From eb3205700cc99446705c20dac54cbbb3eecdbc94 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 18:38:36 +0300
Subject: [PATCH 169/236] Step 20.12: Add the image upload control after
 picking image

---
 client/parties/views/add-photo-modal.ng.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/parties/views/add-photo-modal.ng.html b/client/parties/views/add-photo-modal.ng.html
index eeccf1d..158bd1b 100644
--- a/client/parties/views/add-photo-modal.ng.html
+++ b/client/parties/views/add-photo-modal.ng.html
@@ -7,7 +7,7 @@
     </md-toolbar>
     <md-dialog-content>
       <div>
-        <div ngf-drop ngf-select
+        <div ng-hide="imgSrc" ngf-drop ngf-select
              ngf-change="addImages($files)"
              ngf-drag-over-class="{accept:'dragover', reject:'dragover-err', delay:100}" class="drop-box"
              ngf-multiple="false" ngf-allow-dir="false" ngf-accept="'image/*'"
-- 
2.3.2 (Apple Git-55)


From 7f9f07dec426cf991c0cc1ae050b28f879326148 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 18:41:07 +0300
Subject: [PATCH 170/236] Step 20.13: Change the logic on Done button

---
 client/parties/views/add-photo-modal.ng.html | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/client/parties/views/add-photo-modal.ng.html b/client/parties/views/add-photo-modal.ng.html
index 158bd1b..cb13514 100644
--- a/client/parties/views/add-photo-modal.ng.html
+++ b/client/parties/views/add-photo-modal.ng.html
@@ -26,8 +26,8 @@
     </md-dialog-content>
     <div class="md-actions" layout="row">
       <span flex></span>
-      <md-button ng-click="close()" class="md-primary">
-        Done
+      <md-button ng-click="saveCroppedImage()" ng-disabled="!imgSrc" class="md-primary">
+        Add Image
       </md-button>
       <md-button ng-click="close()" class="md-warn">
         Cancel
-- 
2.3.2 (Apple Git-55)


From 9897bdd5207ad311e0c68cb8f5489afdaa10a6c7 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 18:41:44 +0300
Subject: [PATCH 171/236] Step 20.14: Add logic to save the cropped image

---
 client/parties/controllers/addPhotoCtrl.js | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/client/parties/controllers/addPhotoCtrl.js b/client/parties/controllers/addPhotoCtrl.js
index 4926949..2f3af53 100644
--- a/client/parties/controllers/addPhotoCtrl.js
+++ b/client/parties/controllers/addPhotoCtrl.js
@@ -18,5 +18,14 @@ angular.module("socially").controller("AddPhotoCtrl", ['$scope', '$meteor', '$ro
       }
     };
 
+    $scope.saveCroppedImage = function() {
+      if ($scope.myCroppedImage !== '') {
+        $scope.images.save($scope.myCroppedImage).then(function() {
+          $scope.uploadedImage = result[0]._id;
+          $scope.answer(true);
+        });
+      }
+    };
+
     $scope.close = $mdDialog.hide;
   }]);
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 73cf3f68850d627b6492f49e49eab26977a4dd0e Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 18:42:44 +0300
Subject: [PATCH 172/236] Step 20.15: Add answer function

---
 client/parties/controllers/addPhotoCtrl.js | 13 +++++++++++++
 1 file changed, 13 insertions(+)

diff --git a/client/parties/controllers/addPhotoCtrl.js b/client/parties/controllers/addPhotoCtrl.js
index 2f3af53..ea6e120 100644
--- a/client/parties/controllers/addPhotoCtrl.js
+++ b/client/parties/controllers/addPhotoCtrl.js
@@ -27,5 +27,18 @@ angular.module("socially").controller("AddPhotoCtrl", ['$scope', '$meteor', '$ro
       }
     };
 
+    $scope.answer = function(saveImage) {
+      if (saveImage) {
+        $mdDialog.hide($scope.uploadedImage);
+      }
+      else {
+        if ($scope.uploadedImage) {
+          $scope.images.remove($scope.uploadedImage._id);
+        }
+
+        $mdDialog.hide();
+      }
+    };
+
     $scope.close = $mdDialog.hide;
   }]);
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 47a4e03acfd7d2ee771f1686d59ec6ab8b7f6d14 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 18:44:46 +0300
Subject: [PATCH 173/236] Step 20.16: Add logic to show the uploaded image

---
 client/parties/controllers/partiesList.js | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index 5ab977e..f629364 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -88,7 +88,13 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '
         templateUrl: 'client/parties/views/add-photo-modal.ng.html',
         scope: $scope.$new()
       }).then(function(image) {
-        // We will add here later the logic to handle the link between the image and the party
+        if (image) {
+          if (!$scope.newPartyImages) {
+            $scope.newPartyImages = [];
+          }
+
+          $scope.newPartyImages.push(image);
+        }
       });
     };
   }]);
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From ec8428e8f349c5b1f5a0ef048668376b1f18b98b Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 18:53:40 +0300
Subject: [PATCH 174/236] Step 20.12.1: Add some css to make it look better

---
 client/parties/styles/parties.import.less | 18 ++++++++++++++++++
 1 file changed, 18 insertions(+)

diff --git a/client/parties/styles/parties.import.less b/client/parties/styles/parties.import.less
index dd5ddd4..ae3b85c 100644
--- a/client/parties/styles/parties.import.less
+++ b/client/parties/styles/parties.import.less
@@ -19,4 +19,22 @@
 
 .drop-box.dragover-err {
     border: 5px dashed red;
+}
+
+.uploaded-image {
+    max-height: 100px;
+    max-width: 200px;
+}
+
+.ng-crop-container {
+    width: 100%;
+    height: 150px;
+}
+
+.add-photo-dialog {
+    width: 60%;
+
+    h3 {
+        text-align: center;
+    }
 }
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From b01f38a0b71b65dfe46a3918a6d2c4553737f028 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 18:55:07 +0300
Subject: [PATCH 175/236] Small fix

---
 client/parties/controllers/addPhotoCtrl.js | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/parties/controllers/addPhotoCtrl.js b/client/parties/controllers/addPhotoCtrl.js
index ea6e120..13f45e6 100644
--- a/client/parties/controllers/addPhotoCtrl.js
+++ b/client/parties/controllers/addPhotoCtrl.js
@@ -20,7 +20,7 @@ angular.module("socially").controller("AddPhotoCtrl", ['$scope', '$meteor', '$ro
 
     $scope.saveCroppedImage = function() {
       if ($scope.myCroppedImage !== '') {
-        $scope.images.save($scope.myCroppedImage).then(function() {
+        $scope.images.save($scope.myCroppedImage).then(function(result) {
           $scope.uploadedImage = result[0]._id;
           $scope.answer(true);
         });
-- 
2.3.2 (Apple Git-55)


From 2483e234b70182709bbb8d39fc458e264ad4ae15 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 18:57:31 +0300
Subject: [PATCH 176/236] Step 20.17: Add image gallery to the form

---
 client/parties/views/parties-list.ng.html | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index 5f961d3..9f9622a 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -30,6 +30,14 @@
             <md-button class="md-raised" ng-click="openAddImageModal()">Add Photo</md-button>
           </div>
         </div>
+        <div layout="row" class="images-container-title">
+          <div ng-show="!newPartyImages || newPartyImages.length === 0">Add photo by clicking "Add Photo" to the
+            right.
+          </div>
+          <div class="party-image-container" ng-repeat="image in newPartyImages">
+            <img ng-src="{{ image.url() }}"/><br/>
+          </div>
+        </div>
       </md-whiteframe>
       <md-button ng-click="newParty.owner=$root.currentUser._id;parties.push(newParty); newParty='';">
         Add</md-button>
-- 
2.3.2 (Apple Git-55)


From bdaba4db54573e38e20f6316f21bedd87282af81 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 18:59:48 +0300
Subject: [PATCH 177/236] Step 20.18: Add xeditable dependency

---
 client/lib/app.js | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/client/lib/app.js b/client/lib/app.js
index cbe0df0..01a4b3e 100644
--- a/client/lib/app.js
+++ b/client/lib/app.js
@@ -5,7 +5,8 @@ angular.module('socially', [
   'uiGmapgoogle-maps',
   'ngMaterial',
   'ngFileUpload',
-  'ngImgCrop'
+  'ngImgCrop',
+  'xeditable'
 ]);
 
 angular.module('socially').config(['$mdIconProvider', function ($mdIconProvider) {
-- 
2.3.2 (Apple Git-55)


From 9ff7fd6075b3a1361562a9af9ef9b3d26ac4d4c2 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 20:11:32 +0300
Subject: [PATCH 178/236] Remove old form

---
 client/parties/views/parties-list.ng.html | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index 9f9622a..e1b1eb8 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -5,7 +5,7 @@
                    ng-hide="$root.currentUser || $root.loggingIn">
       <span>Log in to create a party!</span>
     </md-whiteframe>
-    <form ng-show="$root.currentUser">
+    <div ng-show="$root.currentUser">
       <h2 class="md-headline">Create a new party:</h2>
       <md-input-container>
         <label>Name</label>
@@ -41,7 +41,7 @@
       </md-whiteframe>
       <md-button ng-click="newParty.owner=$root.currentUser._id;parties.push(newParty); newParty='';">
         Add</md-button>
-    </form>
+    </div>
   </div>
 
   <div layout="column">
-- 
2.3.2 (Apple Git-55)


From b1427aa6286ac8add36f9e4d815fa359c7c807a9 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 20:11:56 +0300
Subject: [PATCH 179/236] Step 20.19: Use angular-xeditable

---
 client/parties/views/parties-list.ng.html | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index e1b1eb8..3d1ff55 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -36,6 +36,8 @@
           </div>
           <div class="party-image-container" ng-repeat="image in newPartyImages">
             <img ng-src="{{ image.url() }}"/><br/>
+            <a href="#" editable-text="image.metadata.description"
+               onbeforesave="updateDescription($data, image)">{{ image.metadata.description || 'Click to add description' }}</a>
           </div>
         </div>
       </md-whiteframe>
-- 
2.3.2 (Apple Git-55)


From 04aec4701f961f49fc40185d7d8f5cc0c990e271 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 20:12:10 +0300
Subject: [PATCH 180/236] Step 20.20: Implement the update logic

---
 client/parties/controllers/partiesList.js | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index f629364..bba86df 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -97,4 +97,8 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '
         }
       });
     };
+
+    $scope.updateDescription = function($data, image) {
+      image.update({$set: {'metadata.description': $data}});
+    };
   }]);
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 3dfe865273d07d0f2d22556fac655c5f9613562b Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 20:13:53 +0300
Subject: [PATCH 181/236] Step 20.21: Add dependency for
 'angular-sortable-view'

---
 client/lib/app.js | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/client/lib/app.js b/client/lib/app.js
index 01a4b3e..bb69c52 100644
--- a/client/lib/app.js
+++ b/client/lib/app.js
@@ -6,7 +6,8 @@ angular.module('socially', [
   'ngMaterial',
   'ngFileUpload',
   'ngImgCrop',
-  'xeditable'
+  'xeditable',
+  'angular-sortable-view'
 ]);
 
 angular.module('socially').config(['$mdIconProvider', function ($mdIconProvider) {
-- 
2.3.2 (Apple Git-55)


From fb73e88a44b5a55029fa8046f28e784fd32c4a2d Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 20:16:08 +0300
Subject: [PATCH 182/236] Step 20.22: Add usage for angular-sortable

---
 client/parties/views/parties-list.ng.html | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index 3d1ff55..8992cd2 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -30,12 +30,13 @@
             <md-button class="md-raised" ng-click="openAddImageModal()">Add Photo</md-button>
           </div>
         </div>
-        <div layout="row" class="images-container-title">
+        <div layout="row" class="images-container-title" sv-root sv-part="newPartyImages"
+             sv-on-sort="updateOrder($partTo)">
           <div ng-show="!newPartyImages || newPartyImages.length === 0">Add photo by clicking "Add Photo" to the
             right.
           </div>
-          <div class="party-image-container" ng-repeat="image in newPartyImages">
-            <img ng-src="{{ image.url() }}"/><br/>
+          <div sv-element class="party-image-container" ng-repeat="image in newPartyImages">
+            <img draggable="false" ng-src="{{ image.url() }}"/><br/>
             <a href="#" editable-text="image.metadata.description"
                onbeforesave="updateDescription($data, image)">{{ image.metadata.description || 'Click to add description' }}</a>
           </div>
-- 
2.3.2 (Apple Git-55)


From 746262009cf6f0c23f70c8e9d1e60b35f76567f6 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 20:19:57 +0300
Subject: [PATCH 183/236] Step 20.23: Add sort logic

---
 client/parties/controllers/partiesList.js | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index bba86df..0b9826e 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -101,4 +101,10 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '
     $scope.updateDescription = function($data, image) {
       image.update({$set: {'metadata.description': $data}});
     };
+
+    $scope.updateOrder = function(sortedArr) {
+      angular.forEach(sortedArr, function(item, index) {
+        item.currentOrder = index;
+      });
+    };
   }]);
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 4fe4230dfc1849286b90e88cd51eedd69bddcba8 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 20:20:35 +0300
Subject: [PATCH 184/236] Step 20.24: Add indication for main image in the view

---
 client/parties/views/parties-list.ng.html | 1 +
 1 file changed, 1 insertion(+)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index 8992cd2..89b3c37 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -36,6 +36,7 @@
             right.
           </div>
           <div sv-element class="party-image-container" ng-repeat="image in newPartyImages">
+            <div class="main-image" ng-show="$index === 0">Main Image</div>
             <img draggable="false" ng-src="{{ image.url() }}"/><br/>
             <a href="#" editable-text="image.metadata.description"
                onbeforesave="updateDescription($data, image)">{{ image.metadata.description || 'Click to add description' }}</a>
-- 
2.3.2 (Apple Git-55)


From 2074aa2cee0c41a21c2804e6559aef2697f10367 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 20:21:00 +0300
Subject: [PATCH 185/236] Step 20.25: Add indication for main image in the CSS

---
 client/parties/styles/parties.import.less | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/client/parties/styles/parties.import.less b/client/parties/styles/parties.import.less
index ae3b85c..d22e4ac 100644
--- a/client/parties/styles/parties.import.less
+++ b/client/parties/styles/parties.import.less
@@ -37,4 +37,11 @@
     h3 {
         text-align: center;
     }
+}
+
+.main-image {
+    position: absolute;
+    top: 5px;
+    left: 5px;
+    background-color: #f8f8f8;
 }
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From f5aa61069bd72b90937cac5a73d20d2d586094d9 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 20:32:19 +0300
Subject: [PATCH 186/236] Step 20.26: Add logic to save image link to party

---
 client/parties/controllers/partiesList.js | 20 ++++++++++++++++++++
 1 file changed, 20 insertions(+)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index 0b9826e..7592389 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -107,4 +107,24 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '
         item.currentOrder = index;
       });
     };
+
+    $scope.createParty = function() {
+      $scope.newParty.owner = $rootScope.currentUser._id;
+
+      // Link the images and the order to the new party
+      if ($scope.newPartyImages && $scope.newPartyImages.length > 0) {
+        $scope.newParty.images = [];
+
+        angular.forEach($scope.newPartyImages, function(image) {
+          $scope.newParty.images.push({id: image._id, order: image.currentOrder})
+        });
+      }
+
+      // Save the party
+      $scope.parties.push($scope.newParty);
+
+      // Reset the form
+      $scope.newPartyImages = [];
+      $scope.newParty = {};
+    };
   }]);
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From f4c2c5211405609a4237ab239d271c0550b07caa Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 20:33:12 +0300
Subject: [PATCH 187/236] Step 20.27: Change the button

---
 client/parties/views/parties-list.ng.html | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index 89b3c37..7696be4 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -43,8 +43,7 @@
           </div>
         </div>
       </md-whiteframe>
-      <md-button ng-click="newParty.owner=$root.currentUser._id;parties.push(newParty); newParty='';">
-        Add</md-button>
+      <md-button class="md-raised md-primary" ng-click="createParty()">Create Party</md-button>
     </div>
   </div>
 
-- 
2.3.2 (Apple Git-55)


From 5d0661f94f1ddd06b26a1e6cf043ae9c8b8b13c7 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 20:34:47 +0300
Subject: [PATCH 188/236] Step 20.28: Add the view for party image

---
 client/parties/views/parties-list.ng.html | 11 ++++++-----
 1 file changed, 6 insertions(+), 5 deletions(-)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index 7696be4..6ec9518 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -76,16 +76,17 @@
     </div>
   </div>
   <div layout="column" layout-padding>
-    <div dir-paginate="party in parties | itemsPerPage: perPage"
-         total-items="partiesCount.count" layout="column">
+    <div dir-paginate="party in parties | itemsPerPage: perPage" total-items="partiesCount.count" layout="column">
       <div layout="row">
-        <div flex="80">
+        <div flex="80" ng-if="party.images && party.images.length > 0">
+          <img ng-src="{{ getMainImage(party.images) }}"/>
+        </div>
+        <div flex="50">
           <h2><a href="/parties/{{party._id}}">{{party.name}}</a></h2>
           <p>{{party.description}}</p>
         </div>
         <span flex></span>
-        <md-button ng-click="remove(party)"
-                   ng-show="$root.currentUser && $root.currentUser._id == party.owner">
+        <md-button ng-click="remove(party)" ng-show="$root.currentUser && $root.currentUser._id == party.owner">
           <md-icon md-svg-icon="content:ic_clear_24px"></md-icon>
         </md-button>
       </div>
-- 
2.3.2 (Apple Git-55)


From 0afee35787500de8a2ea0b102c609fd8b5aee2a8 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 20:36:08 +0300
Subject: [PATCH 189/236] Step 20.29: Add getMainImage logic

---
 client/parties/controllers/partiesList.js | 12 ++++++++++--
 1 file changed, 10 insertions(+), 2 deletions(-)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index 7592389..615268e 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -1,5 +1,5 @@
-angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '$rootScope', '$state', '$mdDialog',
-  function($scope, $meteor, $rootScope, $state, $mdDialog){
+angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '$rootScope', '$state', '$mdDialog', '$filter',
+  function($scope, $meteor, $rootScope, $state, $mdDialog, $filter){
 
     $scope.page = 1;
     $scope.perPage = 3;
@@ -127,4 +127,12 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '
       $scope.newPartyImages = [];
       $scope.newParty = {};
     };
+
+    $scope.getMainImage = function(images) {
+      var mainImage = $filter('filter')(images, {order: 0})[0];
+
+      if (mainImage) {
+        return $filter('filter')($scope.images, {_id: mainImage.id})[0].url();
+      }
+    };
   }]);
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 06e1dc166d412a44d4e36ab52137c21ea5b01a92 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 20:43:46 +0300
Subject: [PATCH 190/236] Step 20.30: Add thumbnails

---
 model/images.js | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/model/images.js b/model/images.js
index 5cec451..3b06d5f 100644
--- a/model/images.js
+++ b/model/images.js
@@ -1,6 +1,11 @@
 Images = new FS.Collection("images", {
   stores: [
-    new FS.Store.GridFS("original")
+    new FS.Store.GridFS("original"),
+    new FS.Store.GridFS("thumbnail", {
+      transformWrite: function(fileObj, readStream, writeStream) {
+        gm(readStream, fileObj.name()).resize('32', '32', '!').stream().pipe(writeStream);
+      }
+    })
   ],
   filter: {
     allow: {
-- 
2.3.2 (Apple Git-55)


From cc48ffa21a9d82bee7a00b2cfe8900f769e844a6 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 20:44:18 +0300
Subject: [PATCH 191/236] Step 20.31: Use thumbnails

---
 client/parties/views/parties-list.ng.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index 6ec9518..807ec63 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -37,7 +37,7 @@
           </div>
           <div sv-element class="party-image-container" ng-repeat="image in newPartyImages">
             <div class="main-image" ng-show="$index === 0">Main Image</div>
-            <img draggable="false" ng-src="{{ image.url() }}"/><br/>
+            <img draggable="false" ng-src="{{ image.url({store: 'thumbnail'}) }}"/><br/>
             <a href="#" editable-text="image.metadata.description"
                onbeforesave="updateDescription($data, image)">{{ image.metadata.description || 'Click to add description' }}</a>
           </div>
-- 
2.3.2 (Apple Git-55)


From 7c55cef834f717ed31b183acfdc1c4447df7f233 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 20:45:07 +0300
Subject: [PATCH 192/236] Update packages

---
 .meteor/packages |  6 ++++++
 .meteor/versions | 23 +++++++++++++++++++++++
 2 files changed, 29 insertions(+)

diff --git a/.meteor/packages b/.meteor/packages
index a7ed332..dbf0c1b 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -18,3 +18,9 @@ angularui:angular-google-maps
 less
 angular:angular-material
 planettraining:material-design-icons
+cfs:standard-packages
+cfs:gridfs
+danialfarid:ng-file-upload
+alexk111:ng-img-crop
+vitalets:angular-xeditable
+netanelgilad:angular-sortable-view
diff --git a/.meteor/versions b/.meteor/versions
index d10d60b..c5ccf2a 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -5,6 +5,7 @@ accounts-password@1.1.1
 accounts-twitter@1.0.4
 accounts-ui@1.1.5
 accounts-ui-unstyled@1.1.7
+alexk111:ng-img-crop@0.3.2
 angular:angular@1.4.4
 angular:angular-animate@1.4.4
 angular:angular-aria@1.4.4
@@ -19,7 +20,25 @@ blaze@2.1.2
 blaze-tools@1.0.3
 boilerplate-generator@1.0.3
 callback-hook@1.0.3
+cfs:access-point@0.1.49
+cfs:base-package@0.0.30
+cfs:collection@0.5.5
+cfs:collection-filters@0.2.4
+cfs:data-man@0.0.6
+cfs:file@0.1.17
+cfs:gridfs@0.0.33
+cfs:http-methods@0.0.29
+cfs:http-publish@0.0.13
+cfs:power-queue@0.9.11
+cfs:reactive-list@0.0.9
+cfs:reactive-property@0.0.4
+cfs:standard-packages@0.5.9
+cfs:storage-adapter@0.2.2
+cfs:tempstore@0.1.5
+cfs:upload-http@0.0.20
+cfs:worker@0.1.4
 check@1.0.5
+danialfarid:ng-file-upload@5.0.9
 dburles:mongo-collection-instances@0.3.4
 ddp@1.1.0
 deps@1.0.7
@@ -46,6 +65,8 @@ minifiers@1.1.5
 minimongo@1.0.8
 mobile-status-bar@1.0.3
 mongo@1.1.0
+mongo-livedata@1.0.8
+netanelgilad:angular-sortable-view@0.0.13
 npm-bcrypt@0.7.8_2
 oauth@1.1.4
 oauth1@1.1.4
@@ -53,6 +74,7 @@ oauth2@1.1.3
 observe-sequence@1.0.6
 ordered-dict@1.0.3
 planettraining:material-design-icons@2.0.0
+raix:eventemitter@0.1.3
 random@1.0.3
 reactive-dict@1.1.0
 reactive-var@1.0.5
@@ -74,5 +96,6 @@ ui@1.0.6
 underscore@1.0.3
 urigo:angular@0.9.3
 url@1.0.4
+vitalets:angular-xeditable@0.1.9
 webapp@1.2.0
 webapp-hashing@1.0.3
-- 
2.3.2 (Apple Git-55)


From 75674de2c14725ffe2d168b520684901fe45a133 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Sat, 22 Aug 2015 22:11:09 +0300
Subject: [PATCH 193/236] Delete existing files, apply changes

---
 .gitignore |  1 +
 COC.md     | 21 +++++++++++++++++++++
 README.md  | 64 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 3 files changed, 86 insertions(+)
 create mode 100644 .gitignore
 create mode 100644 COC.md
 create mode 100644 README.md

diff --git a/.gitignore b/.gitignore
new file mode 100644
index 0000000..485dee6
--- /dev/null
+++ b/.gitignore
@@ -0,0 +1 @@
+.idea
diff --git a/COC.md b/COC.md
new file mode 100644
index 0000000..4748e55
--- /dev/null
+++ b/COC.md
@@ -0,0 +1,21 @@
+# Code of Conduct
+
+Learning in plain sight can be an intimidating experience. Your code, mistakes, and community feedback are all publically displayed for everyone to see. While this is true for any open source project, course participants are here to learn and can feel a lot more vulnerable.
+
+It is absolutely crucial that any interaction is done with respect, care, and without judgment, and that any feedback is provided gently. We want to teach and learn from each other, and for that to happen, we must treat each other with care.
+
+This course is dedicated to providing a harassment-free learning experience for everyone, regardless of gender, age, sexual orientation, disability, physical appearance, body size, race, or religion (or lack thereof). We do not tolerate harassment of participants in any form. Sexual language and imagery is not appropriate in any material posted to this repository or in other venues discussing it (e.g. Twitter and other online media). Participants violating these rules may be sanctioned or expelled from the course at the discretion of the maintainers as well as reported to GitHub for abuse.
+
+Harassment includes offensive verbal comments related to gender, age, sexual orientation, disability, physical appearance, body size, race, religion, sexual images in public spaces, deliberate intimidation, stalking, following, harassing photography or recording, sustained disruption of others, inappropriate physical contact, and unwelcome sexual attention.
+
+Participants asked to stop any harassing behavior are expected to comply immediately.
+
+Teachers and maintainers are also subject to the anti-harassment policy. In particular, they should not use sexualized images, activities, or other material.
+
+If a participant engages in harassing behavior, the maintainers may take any action they deem appropriate, including warning the offender or expulsion from the course.
+
+If you are being harassed, notice that someone else is being harassed, or have any other concerns, please contact a member of course team immediately. The list of maintainers can be found at the top of the [README document](https://github.com/hueniverse/hueniversity/blob/master/README.md).
+
+We expect participants to follow these rules at any related social events.
+
+(Adapted from http://confcodeofconduct.com/)
diff --git a/README.md b/README.md
new file mode 100644
index 0000000..9c9c1bd
--- /dev/null
+++ b/README.md
@@ -0,0 +1,64 @@
+# meteor-angular-socially - [Tutorial's site](http://angularjs.meteor.com/tutorial)
+angular-meteor example and tutorial app.
+
+The tutorial starts at branch 'step_00' till the last step.
+
+The master branch is always equal to the last step.
+
+Here is the deployed final version - http://socially-step18.meteor.com/
+
+Please contribute to the tutorial.
+Pull request the master branch to add new features or pull request specific step to improve that step.
+
+Our goal in this tutorial is to add more steps as we go along, to cover as many use cases as possible.
+
+Thanks @MilosStanic for writing step 18 on angular-material
+
+An example with the `controller as` syntax can be found in [this branch](https://github.com/Urigo/meteor-angular-socially/tree/step_12_controller_as_vm).
+
+# angular-meteor University! <a href="http://angularjs.meteor.com/"><img src="http://angularjs.meteor.com/images/logo-large.png" width="60" height="60" /></a>  
+
+The angular-meteor university is a community learning experiment, we would like to create a similar experience to the [hueniversity](https://github.com/hueniverse/hueniversity)
+
+
+[![Join the chat at https://gitter.im/Urigo/angular-meteor](https://badges.gitter.im/Join%20Chat.svg)](https://gitter.im/Urigo/angular-meteor?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge)
+
+The first assignments will be to rewrite the tutorial steps, and follow the latest angular-meteor API , in a more [consistent style](https://github.com/johnpapa/angular-styleguide).
+We also hope the community will propose better solutions than the current ones.
+When we will catch up with the latest steps we will create new steps.
+
+### What am I going to learn?
+You will learn how to build a full stack application using meteor and angular. It will start with the basics and move on to the more advanced topic such as users and authentication, application architecture, reactivity, mobile app, ionic, working with files, Angular Server, ES6 and more.
+
+
+### What do I need to know?
+You should feel comfortable writing simple functions in JavaScript, working with GitHub, using basic git commands, have a basic familiarity with mongoDB, and be able to pick up new subjects by reading tutorials and documentation.
+
+### How advanced is this course?
+We'll start from the basics and make our way to the most advanced topics. The way this course is structured, you can choose which assignments to participate in, so more experienced developers can "sit out" or help others during the basic assignments and participate when it gets to areas they are not as strong in. However, since teaching is one of the most effective ways to learn, we believe that participating early will improve the existing skills of advanced developers.
+The assignment will include just enough information to get you going, but you will need to do most of the learning on your own by using the wide range of online resources available. However, the real benefit of this process will come from the code review of your Pull Request. This is where expert developers will review your work and provide you specific and actionable feedback.
+
+### How does it work?
+First, read the [Code of Conduct](https://github.com/Urigo/meteor-angular-socially/blob/master/COC.md) !
+
+Simple, you start by forking this repo.
+Every few days a new issue will be posted with an [`assignment` label](https://github.com/Urigo/meteor-angular-socially/labels/assignment)
+. If you would like to participate in the assignment, try to solve it and when you are done, submit a Pull Request back to this repo to the `step_NUMBER_u` branch. Make sure your code complies with the [john papa angular style guid](https://github.com/johnpapa/angular-styleguide).
+While you wait for the assignment to close, take a look at what others are submitting and see if you can improve your own solution (borrow ideas, add tests, write examples, update the documentation). If you see ways in which others can improve their solution, please dont hesitate to comment on their Pull Request.
+Each assignment will have a final submission date. When the issue expires, one of the Pull Requests submitted will be picked and merged and published as the new tutorial step. Any follow up assignments will be based on the merged code.
+Before starting the next assignment, make sure [your fork matches the current](https://github.com/Urigo/meteor-angular-socially/blob/master/guides/git.md ) assignment step branch (`step_NUMBER_u`) since only one Pull Request can be accepted.
+
+### How can I help?
+
+There are lots of way you can help make this experiment succeed and help shape a new format for teaching development skills:
+Submit Pull Requests to improve this readme, add examples, write quick tutorials on how to work with git, etc.
+Add new steps to angular-meteor-socially tutorial.
+Look for issues with a [help wanted label](https://github.com/Urigo/meteor-angular-socially/labels/help%20wanted) and help with those.
+Randomly pick submitted Pull Request and review them, offering advice and helping others improve their skills.
+Submit Pull Request or open issues with proposals for [angular-meteor](https://github.com/Urigo/angular-meteor) 
+
+### Anything else?
+[Open an issue](https://github.com/Urigo/meteor-angular-socially/issues/new), it's free.
+
+
+
-- 
2.3.2 (Apple Git-55)


From 8a290dfd9f8fbaf6049c29b87bf678874d4560bd Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Sat, 22 Aug 2015 22:14:56 +0300
Subject: [PATCH 194/236] Revert "Delete existing files, apply changes"

This reverts commit 75674de2c14725ffe2d168b520684901fe45a133.
---
 .gitignore |  1 -
 COC.md     | 21 ---------------------
 README.md  | 64 --------------------------------------------------------------
 3 files changed, 86 deletions(-)
 delete mode 100644 .gitignore
 delete mode 100644 COC.md
 delete mode 100644 README.md

diff --git a/.gitignore b/.gitignore
deleted file mode 100644
index 485dee6..0000000
--- a/.gitignore
+++ /dev/null
@@ -1 +0,0 @@
-.idea
diff --git a/COC.md b/COC.md
deleted file mode 100644
index 4748e55..0000000
--- a/COC.md
+++ /dev/null
@@ -1,21 +0,0 @@
-# Code of Conduct
-
-Learning in plain sight can be an intimidating experience. Your code, mistakes, and community feedback are all publically displayed for everyone to see. While this is true for any open source project, course participants are here to learn and can feel a lot more vulnerable.
-
-It is absolutely crucial that any interaction is done with respect, care, and without judgment, and that any feedback is provided gently. We want to teach and learn from each other, and for that to happen, we must treat each other with care.
-
-This course is dedicated to providing a harassment-free learning experience for everyone, regardless of gender, age, sexual orientation, disability, physical appearance, body size, race, or religion (or lack thereof). We do not tolerate harassment of participants in any form. Sexual language and imagery is not appropriate in any material posted to this repository or in other venues discussing it (e.g. Twitter and other online media). Participants violating these rules may be sanctioned or expelled from the course at the discretion of the maintainers as well as reported to GitHub for abuse.
-
-Harassment includes offensive verbal comments related to gender, age, sexual orientation, disability, physical appearance, body size, race, religion, sexual images in public spaces, deliberate intimidation, stalking, following, harassing photography or recording, sustained disruption of others, inappropriate physical contact, and unwelcome sexual attention.
-
-Participants asked to stop any harassing behavior are expected to comply immediately.
-
-Teachers and maintainers are also subject to the anti-harassment policy. In particular, they should not use sexualized images, activities, or other material.
-
-If a participant engages in harassing behavior, the maintainers may take any action they deem appropriate, including warning the offender or expulsion from the course.
-
-If you are being harassed, notice that someone else is being harassed, or have any other concerns, please contact a member of course team immediately. The list of maintainers can be found at the top of the [README document](https://github.com/hueniverse/hueniversity/blob/master/README.md).
-
-We expect participants to follow these rules at any related social events.
-
-(Adapted from http://confcodeofconduct.com/)
diff --git a/README.md b/README.md
deleted file mode 100644
index 9c9c1bd..0000000
--- a/README.md
+++ /dev/null
@@ -1,64 +0,0 @@
-# meteor-angular-socially - [Tutorial's site](http://angularjs.meteor.com/tutorial)
-angular-meteor example and tutorial app.
-
-The tutorial starts at branch 'step_00' till the last step.
-
-The master branch is always equal to the last step.
-
-Here is the deployed final version - http://socially-step18.meteor.com/
-
-Please contribute to the tutorial.
-Pull request the master branch to add new features or pull request specific step to improve that step.
-
-Our goal in this tutorial is to add more steps as we go along, to cover as many use cases as possible.
-
-Thanks @MilosStanic for writing step 18 on angular-material
-
-An example with the `controller as` syntax can be found in [this branch](https://github.com/Urigo/meteor-angular-socially/tree/step_12_controller_as_vm).
-
-# angular-meteor University! <a href="http://angularjs.meteor.com/"><img src="http://angularjs.meteor.com/images/logo-large.png" width="60" height="60" /></a>  
-
-The angular-meteor university is a community learning experiment, we would like to create a similar experience to the [hueniversity](https://github.com/hueniverse/hueniversity)
-
-
-[![Join the chat at https://gitter.im/Urigo/angular-meteor](https://badges.gitter.im/Join%20Chat.svg)](https://gitter.im/Urigo/angular-meteor?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge)
-
-The first assignments will be to rewrite the tutorial steps, and follow the latest angular-meteor API , in a more [consistent style](https://github.com/johnpapa/angular-styleguide).
-We also hope the community will propose better solutions than the current ones.
-When we will catch up with the latest steps we will create new steps.
-
-### What am I going to learn?
-You will learn how to build a full stack application using meteor and angular. It will start with the basics and move on to the more advanced topic such as users and authentication, application architecture, reactivity, mobile app, ionic, working with files, Angular Server, ES6 and more.
-
-
-### What do I need to know?
-You should feel comfortable writing simple functions in JavaScript, working with GitHub, using basic git commands, have a basic familiarity with mongoDB, and be able to pick up new subjects by reading tutorials and documentation.
-
-### How advanced is this course?
-We'll start from the basics and make our way to the most advanced topics. The way this course is structured, you can choose which assignments to participate in, so more experienced developers can "sit out" or help others during the basic assignments and participate when it gets to areas they are not as strong in. However, since teaching is one of the most effective ways to learn, we believe that participating early will improve the existing skills of advanced developers.
-The assignment will include just enough information to get you going, but you will need to do most of the learning on your own by using the wide range of online resources available. However, the real benefit of this process will come from the code review of your Pull Request. This is where expert developers will review your work and provide you specific and actionable feedback.
-
-### How does it work?
-First, read the [Code of Conduct](https://github.com/Urigo/meteor-angular-socially/blob/master/COC.md) !
-
-Simple, you start by forking this repo.
-Every few days a new issue will be posted with an [`assignment` label](https://github.com/Urigo/meteor-angular-socially/labels/assignment)
-. If you would like to participate in the assignment, try to solve it and when you are done, submit a Pull Request back to this repo to the `step_NUMBER_u` branch. Make sure your code complies with the [john papa angular style guid](https://github.com/johnpapa/angular-styleguide).
-While you wait for the assignment to close, take a look at what others are submitting and see if you can improve your own solution (borrow ideas, add tests, write examples, update the documentation). If you see ways in which others can improve their solution, please dont hesitate to comment on their Pull Request.
-Each assignment will have a final submission date. When the issue expires, one of the Pull Requests submitted will be picked and merged and published as the new tutorial step. Any follow up assignments will be based on the merged code.
-Before starting the next assignment, make sure [your fork matches the current](https://github.com/Urigo/meteor-angular-socially/blob/master/guides/git.md ) assignment step branch (`step_NUMBER_u`) since only one Pull Request can be accepted.
-
-### How can I help?
-
-There are lots of way you can help make this experiment succeed and help shape a new format for teaching development skills:
-Submit Pull Requests to improve this readme, add examples, write quick tutorials on how to work with git, etc.
-Add new steps to angular-meteor-socially tutorial.
-Look for issues with a [help wanted label](https://github.com/Urigo/meteor-angular-socially/labels/help%20wanted) and help with those.
-Randomly pick submitted Pull Request and review them, offering advice and helping others improve their skills.
-Submit Pull Request or open issues with proposals for [angular-meteor](https://github.com/Urigo/angular-meteor) 
-
-### Anything else?
-[Open an issue](https://github.com/Urigo/meteor-angular-socially/issues/new), it's free.
-
-
-
-- 
2.3.2 (Apple Git-55)


From 0577c7ac9451e70e0202a423f346a8174bae5520 Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sun, 23 Aug 2015 15:19:38 +0300
Subject: [PATCH 195/236] Revert "Revert "Delete existing files, apply
 changes""

This reverts commit 8a290dfd9f8fbaf6049c29b87bf678874d4560bd.
---
 .gitignore |  1 +
 COC.md     | 21 +++++++++++++++++++++
 README.md  | 64 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 3 files changed, 86 insertions(+)
 create mode 100644 .gitignore
 create mode 100644 COC.md
 create mode 100644 README.md

diff --git a/.gitignore b/.gitignore
new file mode 100644
index 0000000..485dee6
--- /dev/null
+++ b/.gitignore
@@ -0,0 +1 @@
+.idea
diff --git a/COC.md b/COC.md
new file mode 100644
index 0000000..4748e55
--- /dev/null
+++ b/COC.md
@@ -0,0 +1,21 @@
+# Code of Conduct
+
+Learning in plain sight can be an intimidating experience. Your code, mistakes, and community feedback are all publically displayed for everyone to see. While this is true for any open source project, course participants are here to learn and can feel a lot more vulnerable.
+
+It is absolutely crucial that any interaction is done with respect, care, and without judgment, and that any feedback is provided gently. We want to teach and learn from each other, and for that to happen, we must treat each other with care.
+
+This course is dedicated to providing a harassment-free learning experience for everyone, regardless of gender, age, sexual orientation, disability, physical appearance, body size, race, or religion (or lack thereof). We do not tolerate harassment of participants in any form. Sexual language and imagery is not appropriate in any material posted to this repository or in other venues discussing it (e.g. Twitter and other online media). Participants violating these rules may be sanctioned or expelled from the course at the discretion of the maintainers as well as reported to GitHub for abuse.
+
+Harassment includes offensive verbal comments related to gender, age, sexual orientation, disability, physical appearance, body size, race, religion, sexual images in public spaces, deliberate intimidation, stalking, following, harassing photography or recording, sustained disruption of others, inappropriate physical contact, and unwelcome sexual attention.
+
+Participants asked to stop any harassing behavior are expected to comply immediately.
+
+Teachers and maintainers are also subject to the anti-harassment policy. In particular, they should not use sexualized images, activities, or other material.
+
+If a participant engages in harassing behavior, the maintainers may take any action they deem appropriate, including warning the offender or expulsion from the course.
+
+If you are being harassed, notice that someone else is being harassed, or have any other concerns, please contact a member of course team immediately. The list of maintainers can be found at the top of the [README document](https://github.com/hueniverse/hueniversity/blob/master/README.md).
+
+We expect participants to follow these rules at any related social events.
+
+(Adapted from http://confcodeofconduct.com/)
diff --git a/README.md b/README.md
new file mode 100644
index 0000000..9c9c1bd
--- /dev/null
+++ b/README.md
@@ -0,0 +1,64 @@
+# meteor-angular-socially - [Tutorial's site](http://angularjs.meteor.com/tutorial)
+angular-meteor example and tutorial app.
+
+The tutorial starts at branch 'step_00' till the last step.
+
+The master branch is always equal to the last step.
+
+Here is the deployed final version - http://socially-step18.meteor.com/
+
+Please contribute to the tutorial.
+Pull request the master branch to add new features or pull request specific step to improve that step.
+
+Our goal in this tutorial is to add more steps as we go along, to cover as many use cases as possible.
+
+Thanks @MilosStanic for writing step 18 on angular-material
+
+An example with the `controller as` syntax can be found in [this branch](https://github.com/Urigo/meteor-angular-socially/tree/step_12_controller_as_vm).
+
+# angular-meteor University! <a href="http://angularjs.meteor.com/"><img src="http://angularjs.meteor.com/images/logo-large.png" width="60" height="60" /></a>  
+
+The angular-meteor university is a community learning experiment, we would like to create a similar experience to the [hueniversity](https://github.com/hueniverse/hueniversity)
+
+
+[![Join the chat at https://gitter.im/Urigo/angular-meteor](https://badges.gitter.im/Join%20Chat.svg)](https://gitter.im/Urigo/angular-meteor?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge)
+
+The first assignments will be to rewrite the tutorial steps, and follow the latest angular-meteor API , in a more [consistent style](https://github.com/johnpapa/angular-styleguide).
+We also hope the community will propose better solutions than the current ones.
+When we will catch up with the latest steps we will create new steps.
+
+### What am I going to learn?
+You will learn how to build a full stack application using meteor and angular. It will start with the basics and move on to the more advanced topic such as users and authentication, application architecture, reactivity, mobile app, ionic, working with files, Angular Server, ES6 and more.
+
+
+### What do I need to know?
+You should feel comfortable writing simple functions in JavaScript, working with GitHub, using basic git commands, have a basic familiarity with mongoDB, and be able to pick up new subjects by reading tutorials and documentation.
+
+### How advanced is this course?
+We'll start from the basics and make our way to the most advanced topics. The way this course is structured, you can choose which assignments to participate in, so more experienced developers can "sit out" or help others during the basic assignments and participate when it gets to areas they are not as strong in. However, since teaching is one of the most effective ways to learn, we believe that participating early will improve the existing skills of advanced developers.
+The assignment will include just enough information to get you going, but you will need to do most of the learning on your own by using the wide range of online resources available. However, the real benefit of this process will come from the code review of your Pull Request. This is where expert developers will review your work and provide you specific and actionable feedback.
+
+### How does it work?
+First, read the [Code of Conduct](https://github.com/Urigo/meteor-angular-socially/blob/master/COC.md) !
+
+Simple, you start by forking this repo.
+Every few days a new issue will be posted with an [`assignment` label](https://github.com/Urigo/meteor-angular-socially/labels/assignment)
+. If you would like to participate in the assignment, try to solve it and when you are done, submit a Pull Request back to this repo to the `step_NUMBER_u` branch. Make sure your code complies with the [john papa angular style guid](https://github.com/johnpapa/angular-styleguide).
+While you wait for the assignment to close, take a look at what others are submitting and see if you can improve your own solution (borrow ideas, add tests, write examples, update the documentation). If you see ways in which others can improve their solution, please dont hesitate to comment on their Pull Request.
+Each assignment will have a final submission date. When the issue expires, one of the Pull Requests submitted will be picked and merged and published as the new tutorial step. Any follow up assignments will be based on the merged code.
+Before starting the next assignment, make sure [your fork matches the current](https://github.com/Urigo/meteor-angular-socially/blob/master/guides/git.md ) assignment step branch (`step_NUMBER_u`) since only one Pull Request can be accepted.
+
+### How can I help?
+
+There are lots of way you can help make this experiment succeed and help shape a new format for teaching development skills:
+Submit Pull Requests to improve this readme, add examples, write quick tutorials on how to work with git, etc.
+Add new steps to angular-meteor-socially tutorial.
+Look for issues with a [help wanted label](https://github.com/Urigo/meteor-angular-socially/labels/help%20wanted) and help with those.
+Randomly pick submitted Pull Request and review them, offering advice and helping others improve their skills.
+Submit Pull Request or open issues with proposals for [angular-meteor](https://github.com/Urigo/angular-meteor) 
+
+### Anything else?
+[Open an issue](https://github.com/Urigo/meteor-angular-socially/issues/new), it's free.
+
+
+
-- 
2.3.2 (Apple Git-55)


From db7c075bfd7f81051a61346d19c6fefe6fc86747 Mon Sep 17 00:00:00 2001
From: okland <omri.klinger@gmail.com>
Date: Sun, 23 Aug 2015 19:06:29 +0300
Subject: [PATCH 196/236] Step 20: add cfs dependencies.

---
 .meteor/packages |  2 ++
 .meteor/versions | 21 ++++++++++++++++++++-
 2 files changed, 22 insertions(+), 1 deletion(-)

diff --git a/.meteor/packages b/.meteor/packages
index a7ed332..e4ddd1a 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -18,3 +18,5 @@ angularui:angular-google-maps
 less
 angular:angular-material
 planettraining:material-design-icons
+cfs:standard-packages
+cfs:gridfs
diff --git a/.meteor/versions b/.meteor/versions
index d10d60b..62fcc46 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -19,6 +19,23 @@ blaze@2.1.2
 blaze-tools@1.0.3
 boilerplate-generator@1.0.3
 callback-hook@1.0.3
+cfs:access-point@0.1.49
+cfs:base-package@0.0.30
+cfs:collection@0.5.5
+cfs:collection-filters@0.2.4
+cfs:data-man@0.0.6
+cfs:file@0.1.17
+cfs:gridfs@0.0.33
+cfs:http-methods@0.0.29
+cfs:http-publish@0.0.13
+cfs:power-queue@0.9.11
+cfs:reactive-list@0.0.9
+cfs:reactive-property@0.0.4
+cfs:standard-packages@0.5.9
+cfs:storage-adapter@0.2.2
+cfs:tempstore@0.1.5
+cfs:upload-http@0.0.20
+cfs:worker@0.1.4
 check@1.0.5
 dburles:mongo-collection-instances@0.3.4
 ddp@1.1.0
@@ -46,6 +63,7 @@ minifiers@1.1.5
 minimongo@1.0.8
 mobile-status-bar@1.0.3
 mongo@1.1.0
+mongo-livedata@1.0.8
 npm-bcrypt@0.7.8_2
 oauth@1.1.4
 oauth1@1.1.4
@@ -53,6 +71,7 @@ oauth2@1.1.3
 observe-sequence@1.0.6
 ordered-dict@1.0.3
 planettraining:material-design-icons@2.0.0
+raix:eventemitter@0.1.3
 random@1.0.3
 reactive-dict@1.1.0
 reactive-var@1.0.5
@@ -67,7 +86,7 @@ spacebars-compiler@1.0.6
 srp@1.0.3
 stevezhu:lodash@1.0.2
 templating@1.1.1
-tmeasday:publish-counts@0.7.0
+tmeasday:publish-counts@0.7.1
 tracker@1.0.7
 twitter@1.1.4
 ui@1.0.6
-- 
2.3.2 (Apple Git-55)


From 2eed12819a3058352efcfc9a9ed57286476cdfb8 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 17:44:26 +0300
Subject: [PATCH 197/236] Step 20.1: Create the Images collection and publish
 it

---
 model/images.js | 31 +++++++++++++++++++++++++++++++
 1 file changed, 31 insertions(+)
 create mode 100644 model/images.js

diff --git a/model/images.js b/model/images.js
new file mode 100644
index 0000000..5cec451
--- /dev/null
+++ b/model/images.js
@@ -0,0 +1,31 @@
+Images = new FS.Collection("images", {
+  stores: [
+    new FS.Store.GridFS("original")
+  ],
+  filter: {
+    allow: {
+      contentTypes: ['image/*']
+    }
+  }
+});
+
+if (Meteor.isServer) {
+  Images.allow({
+    insert: function (userId) {
+      return (userId ? true : false);
+    },
+    remove: function (userId) {
+      return (userId ? true : false);
+    },
+    download: function () {
+      return true;
+    },
+    update: function (userId) {
+      return (userId ? true : false);
+    }
+  });
+
+  Meteor.publish('images', function() {
+    return Images.find({});
+  });
+}
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 2758af812a1969f6a05392e3783eb282986347ae Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 17:45:31 +0300
Subject: [PATCH 198/236] Step 20.2: Add the collectionFs to the controller

---
 client/parties/controllers/partiesList.js | 1 +
 1 file changed, 1 insertion(+)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index 03e6f34..5413b67 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -7,6 +7,7 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '
     $scope.orderProperty = '1';
 
     $scope.users = $meteor.collection(Meteor.users, false).subscribe('users');
+    $scope.images = $meteor.collectionFS(Images, false, Images).subscribe('images');
 
     $scope.parties = $meteor.collection(function() {
       return Parties.find({}, {
-- 
2.3.2 (Apple Git-55)


From 983c5420b1f811a7a348ceab8d4bd031da77b7c7 Mon Sep 17 00:00:00 2001
From: okland <omri.klinger@gmail.com>
Date: Sun, 23 Aug 2015 19:18:22 +0300
Subject: [PATCH 199/236] Step 20 before 20.3 : Add danialfarid:ng-file-upload
 package.

---
 .meteor/packages | 1 +
 .meteor/versions | 1 +
 2 files changed, 2 insertions(+)

diff --git a/.meteor/packages b/.meteor/packages
index e4ddd1a..2b1bf68 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -20,3 +20,4 @@ angular:angular-material
 planettraining:material-design-icons
 cfs:standard-packages
 cfs:gridfs
+danialfarid:ng-file-upload
diff --git a/.meteor/versions b/.meteor/versions
index 62fcc46..6963140 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -37,6 +37,7 @@ cfs:tempstore@0.1.5
 cfs:upload-http@0.0.20
 cfs:worker@0.1.4
 check@1.0.5
+danialfarid:ng-file-upload@5.0.9
 dburles:mongo-collection-instances@0.3.4
 ddp@1.1.0
 deps@1.0.7
-- 
2.3.2 (Apple Git-55)


From ff4f2e9596f6f54e3f1b3c0b68ba7b4ba18060a0 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 17:48:41 +0300
Subject: [PATCH 200/236] Step 20.3: Add dependency for 'ngFileUpload' to the
 module

---
 client/lib/app.js | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/client/lib/app.js b/client/lib/app.js
index 4c43c2d..e616744 100644
--- a/client/lib/app.js
+++ b/client/lib/app.js
@@ -3,7 +3,8 @@ angular.module('socially', [
   'ui.router',
   'angularUtils.directives.dirPagination',
   'uiGmapgoogle-maps',
-  'ngMaterial'
+  'ngMaterial',
+  'ngFileUpload'
 ]);
 
 angular.module('socially').config(['$mdIconProvider', function ($mdIconProvider) {
-- 
2.3.2 (Apple Git-55)


From 133f3444083cde318a9a5053ccedfe6f861a1edc Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 17:49:41 +0300
Subject: [PATCH 201/236] Step 20.4: Add modal for file uploading

---
 client/parties/controllers/partiesList.js | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index 5413b67..6212856 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -81,4 +81,14 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '
         }
       );
     };
+
+    $scope.openAddImageModal = function() {
+      $mdDialog.show({
+        controller: 'AddPhotoCtrl',
+        templateUrl: 'client/parties/views/add-photo-modal.ng.html',
+        scope: $scope.$new()
+      }).then(function(image) {
+        // We will add here later the logic to handle the link between the image and the party
+      });
+    };
   }]);
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 8ad5ca93c249f8ed6f1e0281c8108ea2af5502e4 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 17:51:13 +0300
Subject: [PATCH 202/236] Step 20.5: Add button to open the file upload modal

---
 client/parties/views/parties-list.ng.html | 19 +++++++++++++++++--
 1 file changed, 17 insertions(+), 2 deletions(-)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index 0b2cc34..8d94321 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -21,13 +21,25 @@
                    id="public" aria-label="Public">
         Public
       </md-checkbox>
+      <md-whiteframe class="md-whiteframe-z1" layout="column">
+        <div layout="row" class="images-container-title">
+          <div flex>
+            <h3>Add photos to your party!</h3>
+          </div>
+          <div>
+            <md-button class="md-raised" ng-click="openAddImageModal()">Add Photo</md-button>
+          </div>
+        </div>
+      </md-whiteframe>
       <md-button ng-click="newParty.owner=$root.currentUser._id;parties.push(newParty); newParty='';">
-        Add</md-button>
+        Add
+      </md-button>
     </form>
   </div>
 
   <div layout="column">
     <h2 class="md-headline">Parties:</h2>
+
     <form layout="row">
       <md-input-container md-no-float>
         <md-icon md-svg-icon="action:ic_search_24px"></md-icon>
@@ -60,6 +72,7 @@
       <div layout="row">
         <div flex="80">
           <h2><a href="/parties/{{party._id}}">{{party.name}}</a></h2>
+
           <p>{{party.description}}</p>
         </div>
         <span flex></span>
@@ -102,7 +115,9 @@
           {{ invitedUser | displayName }}
         </md-list-item>
       </md-list>
-      <p><small>Posted by {{ creator(party) | displayName }}</small></p>
+      <p>
+        <small>Posted by {{ creator(party) | displayName }}</small>
+      </p>
     </div>
   </div>
   <dir-pagination-controls on-page-change="pageChanged(newPageNumber)"></dir-pagination-controls>
-- 
2.3.2 (Apple Git-55)


From b43bf24a59dccb9a9778aa0bdf02c954fdf41893 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 17:53:08 +0300
Subject: [PATCH 203/236] Step 20.6: Create the modal view

---
 client/parties/views/add-photo-modal.ng.html | 33 ++++++++++++++++++++++++++++
 1 file changed, 33 insertions(+)
 create mode 100644 client/parties/views/add-photo-modal.ng.html

diff --git a/client/parties/views/add-photo-modal.ng.html b/client/parties/views/add-photo-modal.ng.html
new file mode 100644
index 0000000..d58aa78
--- /dev/null
+++ b/client/parties/views/add-photo-modal.ng.html
@@ -0,0 +1,33 @@
+<md-dialog class="add-photo-dialog">
+  <form>
+    <md-toolbar>
+      <div class="md-toolbar-tools">
+        <h2>Add Photos To Your Event</h2>
+      </div>
+    </md-toolbar>
+    <md-dialog-content>
+      <div>
+        <div ngf-drop ngf-select
+             ngf-change="addImages($files)"
+             ngf-drag-over-class="{accept:'dragover', reject:'dragover-err', delay:100}" class="drop-box"
+             ngf-multiple="false" ngf-allow-dir="false" ngf-accept="'image/*'"
+             ngf-drop-available="dropAvailable">
+          <div>Click here to select image</div>
+          <div>
+            <strong>OR</strong>
+          </div>
+          <div ng-show="dropAvailable">You can also drop image to here</div>
+        </div>
+      </div>
+    </md-dialog-content>
+    <div class="md-actions" layout="row">
+      <span flex></span>
+      <md-button ng-click="close()" class="md-primary">
+        Done
+      </md-button>
+      <md-button ng-click="close()" class="md-warn">
+        Cancel
+      </md-button>
+    </div>
+  </form>
+</md-dialog>
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 1de019800df343258766eee4eb9e231304e590fd Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 17:54:05 +0300
Subject: [PATCH 204/236] Step 20.7: Add some CSS to make the drop-zone look
 better

---
 client/parties/styles/parties.import.less | 18 ++++++++++++++++++
 1 file changed, 18 insertions(+)

diff --git a/client/parties/styles/parties.import.less b/client/parties/styles/parties.import.less
index 219ff39..dd5ddd4 100644
--- a/client/parties/styles/parties.import.less
+++ b/client/parties/styles/parties.import.less
@@ -1,4 +1,22 @@
 .angular-google-map-container {
     height: 400px;
     width: 400px;
+}
+
+.drop-box {
+    background: #F8F8F8;
+    border: 5px dashed #DDD;
+    width: 230px;
+    height: 65px;
+    text-align: center;
+    padding-top: 25px;
+    margin-left: 10px;
+}
+
+.drop-box.dragover {
+    border: 5px dashed blue;
+}
+
+.drop-box.dragover-err {
+    border: 5px dashed red;
 }
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From bcc5d5006a7fc532c876c5c173113602fe515814 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 17:55:18 +0300
Subject: [PATCH 205/236] Step 20.8: Create the modal controller

---
 client/parties/controllers/addPhoto.js | 10 ++++++++++
 1 file changed, 10 insertions(+)
 create mode 100644 client/parties/controllers/addPhoto.js

diff --git a/client/parties/controllers/addPhoto.js b/client/parties/controllers/addPhoto.js
new file mode 100644
index 0000000..072392f
--- /dev/null
+++ b/client/parties/controllers/addPhoto.js
@@ -0,0 +1,10 @@
+angular.module("socially").controller("AddPhotoCtrl", ['$scope', '$meteor', '$rootScope', '$state', '$mdDialog',
+  function($scope, $meteor, $rootScope, $state, $mdDialog) {
+    $scope.addImages = function (files) {
+      if (files.length > 0) {
+        $scope.images.save(files[0]);
+      }
+    };
+
+    $scope.close = $mdDialog.hide;
+  }]);
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 60fe43c5c99775d6a940b869ac1609fca583efec Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 17:56:49 +0300
Subject: [PATCH 206/236] Step 20.4.1: Add $mdDialog dependency

---
 client/parties/controllers/partiesList.js | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index 6212856..5ab977e 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -1,5 +1,5 @@
-angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '$rootScope', '$state',
-  function($scope, $meteor, $rootScope, $state){
+angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '$rootScope', '$state', '$mdDialog',
+  function($scope, $meteor, $rootScope, $state, $mdDialog){
 
     $scope.page = 1;
     $scope.perPage = 3;
-- 
2.3.2 (Apple Git-55)


From dfaa92dc416d47ccbad27c1380e04734f07f5c4c Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 18:00:33 +0300
Subject: [PATCH 207/236] Undo part of the code for the tutorial

---
 client/parties/views/parties-list.ng.html | 19 ++-----------------
 1 file changed, 2 insertions(+), 17 deletions(-)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index 8d94321..0b2cc34 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -21,25 +21,13 @@
                    id="public" aria-label="Public">
         Public
       </md-checkbox>
-      <md-whiteframe class="md-whiteframe-z1" layout="column">
-        <div layout="row" class="images-container-title">
-          <div flex>
-            <h3>Add photos to your party!</h3>
-          </div>
-          <div>
-            <md-button class="md-raised" ng-click="openAddImageModal()">Add Photo</md-button>
-          </div>
-        </div>
-      </md-whiteframe>
       <md-button ng-click="newParty.owner=$root.currentUser._id;parties.push(newParty); newParty='';">
-        Add
-      </md-button>
+        Add</md-button>
     </form>
   </div>
 
   <div layout="column">
     <h2 class="md-headline">Parties:</h2>
-
     <form layout="row">
       <md-input-container md-no-float>
         <md-icon md-svg-icon="action:ic_search_24px"></md-icon>
@@ -72,7 +60,6 @@
       <div layout="row">
         <div flex="80">
           <h2><a href="/parties/{{party._id}}">{{party.name}}</a></h2>
-
           <p>{{party.description}}</p>
         </div>
         <span flex></span>
@@ -115,9 +102,7 @@
           {{ invitedUser | displayName }}
         </md-list-item>
       </md-list>
-      <p>
-        <small>Posted by {{ creator(party) | displayName }}</small>
-      </p>
+      <p><small>Posted by {{ creator(party) | displayName }}</small></p>
     </div>
   </div>
   <dir-pagination-controls on-page-change="pageChanged(newPageNumber)"></dir-pagination-controls>
-- 
2.3.2 (Apple Git-55)


From 32b63d96084c79b8a88cf2582bf2ca80edce05cd Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 18:00:58 +0300
Subject: [PATCH 208/236] Step 20.5: Add button to open the file upload modal

---
 client/parties/views/parties-list.ng.html | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index 0b2cc34..5f961d3 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -21,6 +21,16 @@
                    id="public" aria-label="Public">
         Public
       </md-checkbox>
+      <md-whiteframe class="md-whiteframe-z1" layout="column">
+        <div layout="row" class="images-container-title">
+          <div flex>
+            <h3>Add photos to your party!</h3>
+          </div>
+          <div>
+            <md-button class="md-raised" ng-click="openAddImageModal()">Add Photo</md-button>
+          </div>
+        </div>
+      </md-whiteframe>
       <md-button ng-click="newParty.owner=$root.currentUser._id;parties.push(newParty); newParty='';">
         Add</md-button>
     </form>
-- 
2.3.2 (Apple Git-55)


From a885d2ab8fce303956fc0a648e30ab0801551901 Mon Sep 17 00:00:00 2001
From: okland <omri.klinger@gmail.com>
Date: Sun, 23 Aug 2015 19:27:42 +0300
Subject: [PATCH 209/236] Step 20 before step 20.9 - add alexk111:ng-img-crop
 package.

---
 .meteor/packages | 1 +
 .meteor/versions | 1 +
 2 files changed, 2 insertions(+)

diff --git a/.meteor/packages b/.meteor/packages
index 2b1bf68..0dfad5f 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -21,3 +21,4 @@ planettraining:material-design-icons
 cfs:standard-packages
 cfs:gridfs
 danialfarid:ng-file-upload
+alexk111:ng-img-crop
diff --git a/.meteor/versions b/.meteor/versions
index 6963140..ac64311 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -5,6 +5,7 @@ accounts-password@1.1.1
 accounts-twitter@1.0.4
 accounts-ui@1.1.5
 accounts-ui-unstyled@1.1.7
+alexk111:ng-img-crop@0.3.2
 angular:angular@1.4.4
 angular:angular-animate@1.4.4
 angular:angular-aria@1.4.4
-- 
2.3.2 (Apple Git-55)


From 2b5760fb87aa491e8486f8f272b5b8563718b6f9 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 18:35:11 +0300
Subject: [PATCH 210/236] Step 20.9: Add dependency for ngImgCrop

---
 client/lib/app.js | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/client/lib/app.js b/client/lib/app.js
index e616744..cbe0df0 100644
--- a/client/lib/app.js
+++ b/client/lib/app.js
@@ -4,7 +4,8 @@ angular.module('socially', [
   'angularUtils.directives.dirPagination',
   'uiGmapgoogle-maps',
   'ngMaterial',
-  'ngFileUpload'
+  'ngFileUpload',
+  'ngImgCrop'
 ]);
 
 angular.module('socially').config(['$mdIconProvider', function ($mdIconProvider) {
-- 
2.3.2 (Apple Git-55)


From 13a95dacb5a9c56b125ba8b87c3afb1d42e304bb Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 18:37:08 +0300
Subject: [PATCH 211/236] Step 20.10: Change the logic of addImages

---
 client/parties/controllers/addPhoto.js | 14 +++++++++++++-
 1 file changed, 13 insertions(+), 1 deletion(-)

diff --git a/client/parties/controllers/addPhoto.js b/client/parties/controllers/addPhoto.js
index 072392f..4926949 100644
--- a/client/parties/controllers/addPhoto.js
+++ b/client/parties/controllers/addPhoto.js
@@ -2,7 +2,19 @@ angular.module("socially").controller("AddPhotoCtrl", ['$scope', '$meteor', '$ro
   function($scope, $meteor, $rootScope, $state, $mdDialog) {
     $scope.addImages = function (files) {
       if (files.length > 0) {
-        $scope.images.save(files[0]);
+        var reader = new FileReader();
+
+        reader.onload = function (e) {
+          $scope.$apply(function() {
+            $scope.imgSrc = e.target.result;
+            $scope.myCroppedImage = '';
+          });
+        };
+
+        reader.readAsDataURL(files[0]);
+      }
+      else {
+        $scope.imgSrc = undefined;
       }
     };
 
-- 
2.3.2 (Apple Git-55)


From dbe393af4766bb4bcd0ec130c856feab4ea6cdaa Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 18:38:13 +0300
Subject: [PATCH 212/236] Step 20.11: Usage of img-crop directive

---
 client/parties/views/add-photo-modal.ng.html | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/client/parties/views/add-photo-modal.ng.html b/client/parties/views/add-photo-modal.ng.html
index d58aa78..eeccf1d 100644
--- a/client/parties/views/add-photo-modal.ng.html
+++ b/client/parties/views/add-photo-modal.ng.html
@@ -18,6 +18,10 @@
           </div>
           <div ng-show="dropAvailable">You can also drop image to here</div>
         </div>
+        <div ng-show="imgSrc" class="ng-crop-container">
+          <h3>Great! Now edit & crop your image...</h3><br />
+          <img-crop image="imgSrc" result-image="myCroppedImage" area-type="square"></img-crop>
+        </div>
       </div>
     </md-dialog-content>
     <div class="md-actions" layout="row">
-- 
2.3.2 (Apple Git-55)


From e98e0008ad105f3961e6e2363df77cabae2c3e81 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 18:38:36 +0300
Subject: [PATCH 213/236] Step 20.12: Add the image upload control after
 picking image

---
 client/parties/views/add-photo-modal.ng.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/parties/views/add-photo-modal.ng.html b/client/parties/views/add-photo-modal.ng.html
index eeccf1d..158bd1b 100644
--- a/client/parties/views/add-photo-modal.ng.html
+++ b/client/parties/views/add-photo-modal.ng.html
@@ -7,7 +7,7 @@
     </md-toolbar>
     <md-dialog-content>
       <div>
-        <div ngf-drop ngf-select
+        <div ng-hide="imgSrc" ngf-drop ngf-select
              ngf-change="addImages($files)"
              ngf-drag-over-class="{accept:'dragover', reject:'dragover-err', delay:100}" class="drop-box"
              ngf-multiple="false" ngf-allow-dir="false" ngf-accept="'image/*'"
-- 
2.3.2 (Apple Git-55)


From b657e427939ab2c8589bf6098efdee0231e8d053 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 18:41:07 +0300
Subject: [PATCH 214/236] Step 20.13: Change the logic on Done button

---
 client/parties/views/add-photo-modal.ng.html | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/client/parties/views/add-photo-modal.ng.html b/client/parties/views/add-photo-modal.ng.html
index 158bd1b..cb13514 100644
--- a/client/parties/views/add-photo-modal.ng.html
+++ b/client/parties/views/add-photo-modal.ng.html
@@ -26,8 +26,8 @@
     </md-dialog-content>
     <div class="md-actions" layout="row">
       <span flex></span>
-      <md-button ng-click="close()" class="md-primary">
-        Done
+      <md-button ng-click="saveCroppedImage()" ng-disabled="!imgSrc" class="md-primary">
+        Add Image
       </md-button>
       <md-button ng-click="close()" class="md-warn">
         Cancel
-- 
2.3.2 (Apple Git-55)


From 99572f6a4da52660989feb955d45958b05dad962 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 18:41:44 +0300
Subject: [PATCH 215/236] Step 20.14: Add logic to save the cropped image

---
 client/parties/controllers/addPhoto.js | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/client/parties/controllers/addPhoto.js b/client/parties/controllers/addPhoto.js
index 4926949..7a15d09 100644
--- a/client/parties/controllers/addPhoto.js
+++ b/client/parties/controllers/addPhoto.js
@@ -18,5 +18,14 @@ angular.module("socially").controller("AddPhotoCtrl", ['$scope', '$meteor', '$ro
       }
     };
 
+    $scope.saveCroppedImage = function() {
+      if ($scope.myCroppedImage !== '') {
+        $scope.images.save($scope.myCroppedImage).then(function(result) {
+          $scope.uploadedImage = result[0]._id;
+          $mdDialog.hide($scope.uploadedImage);
+        });
+      }
+    };
+
     $scope.close = $mdDialog.hide;
   }]);
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From dafb348d4f066c7f23d1489516e5777ae60fc15d Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 18:42:44 +0300
Subject: [PATCH 216/236] Step 20.15: Add answer function

---
 client/parties/controllers/addPhoto.js | 13 +++++++++++++
 1 file changed, 13 insertions(+)

diff --git a/client/parties/controllers/addPhoto.js b/client/parties/controllers/addPhoto.js
index 7a15d09..e3ed351 100644
--- a/client/parties/controllers/addPhoto.js
+++ b/client/parties/controllers/addPhoto.js
@@ -27,5 +27,18 @@ angular.module("socially").controller("AddPhotoCtrl", ['$scope', '$meteor', '$ro
       }
     };
 
+    $scope.answer = function(saveImage) {
+      if (saveImage) {
+        $mdDialog.hide($scope.uploadedImage);
+      }
+      else {
+        if ($scope.uploadedImage) {
+          $scope.images.remove($scope.uploadedImage._id);
+        }
+
+        $mdDialog.hide();
+      }
+    };
+
     $scope.close = $mdDialog.hide;
   }]);
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 9559ede4815b72e5a5ca568ae1dc7c856cec5561 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 18:44:46 +0300
Subject: [PATCH 217/236] Step 20.16: Add logic to show the uploaded image

---
 client/parties/controllers/partiesList.js | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index 5ab977e..f629364 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -88,7 +88,13 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '
         templateUrl: 'client/parties/views/add-photo-modal.ng.html',
         scope: $scope.$new()
       }).then(function(image) {
-        // We will add here later the logic to handle the link between the image and the party
+        if (image) {
+          if (!$scope.newPartyImages) {
+            $scope.newPartyImages = [];
+          }
+
+          $scope.newPartyImages.push(image);
+        }
       });
     };
   }]);
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From cc790a1da4b859a0fdd27794d6070dd845a490b5 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 18:53:40 +0300
Subject: [PATCH 218/236] Step 20.12.1: Add some css to make it look better

---
 client/parties/styles/parties.import.less | 18 ++++++++++++++++++
 1 file changed, 18 insertions(+)

diff --git a/client/parties/styles/parties.import.less b/client/parties/styles/parties.import.less
index dd5ddd4..ae3b85c 100644
--- a/client/parties/styles/parties.import.less
+++ b/client/parties/styles/parties.import.less
@@ -19,4 +19,22 @@
 
 .drop-box.dragover-err {
     border: 5px dashed red;
+}
+
+.uploaded-image {
+    max-height: 100px;
+    max-width: 200px;
+}
+
+.ng-crop-container {
+    width: 100%;
+    height: 150px;
+}
+
+.add-photo-dialog {
+    width: 60%;
+
+    h3 {
+        text-align: center;
+    }
 }
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 2762e13ffca0f285e9b914e19202194a70ba9bc1 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 18:57:31 +0300
Subject: [PATCH 219/236] Step 20.17: Add image gallery to the form

---
 client/parties/views/parties-list.ng.html | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index 5f961d3..9f9622a 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -30,6 +30,14 @@
             <md-button class="md-raised" ng-click="openAddImageModal()">Add Photo</md-button>
           </div>
         </div>
+        <div layout="row" class="images-container-title">
+          <div ng-show="!newPartyImages || newPartyImages.length === 0">Add photo by clicking "Add Photo" to the
+            right.
+          </div>
+          <div class="party-image-container" ng-repeat="image in newPartyImages">
+            <img ng-src="{{ image.url() }}"/><br/>
+          </div>
+        </div>
       </md-whiteframe>
       <md-button ng-click="newParty.owner=$root.currentUser._id;parties.push(newParty); newParty='';">
         Add</md-button>
-- 
2.3.2 (Apple Git-55)


From 0756090ce508feb38d3f9a9ad339d9a66cff2788 Mon Sep 17 00:00:00 2001
From: okland <omri.klinger@gmail.com>
Date: Sun, 23 Aug 2015 19:30:58 +0300
Subject: [PATCH 220/236] Step 20 before step 20.8 add
 vitalets:angular-xeditable package.

---
 .meteor/packages | 1 +
 .meteor/versions | 1 +
 2 files changed, 2 insertions(+)

diff --git a/.meteor/packages b/.meteor/packages
index 0dfad5f..0c1e67a 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -22,3 +22,4 @@ cfs:standard-packages
 cfs:gridfs
 danialfarid:ng-file-upload
 alexk111:ng-img-crop
+vitalets:angular-xeditable
diff --git a/.meteor/versions b/.meteor/versions
index ac64311..c09df5f 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -95,5 +95,6 @@ ui@1.0.6
 underscore@1.0.3
 urigo:angular@0.9.3
 url@1.0.4
+vitalets:angular-xeditable@0.1.9
 webapp@1.2.0
 webapp-hashing@1.0.3
-- 
2.3.2 (Apple Git-55)


From 94afdeb75797ee7e963d3397463d2ea2839e367f Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 18:59:48 +0300
Subject: [PATCH 221/236] Step 20.18: Add xeditable dependency

---
 client/lib/app.js | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/client/lib/app.js b/client/lib/app.js
index cbe0df0..01a4b3e 100644
--- a/client/lib/app.js
+++ b/client/lib/app.js
@@ -5,7 +5,8 @@ angular.module('socially', [
   'uiGmapgoogle-maps',
   'ngMaterial',
   'ngFileUpload',
-  'ngImgCrop'
+  'ngImgCrop',
+  'xeditable'
 ]);
 
 angular.module('socially').config(['$mdIconProvider', function ($mdIconProvider) {
-- 
2.3.2 (Apple Git-55)


From 0196122b7bed9a93449693098942aabafb8fdd4a Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 20:11:32 +0300
Subject: [PATCH 222/236] Remove old form

---
 client/parties/views/parties-list.ng.html | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index 9f9622a..e1b1eb8 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -5,7 +5,7 @@
                    ng-hide="$root.currentUser || $root.loggingIn">
       <span>Log in to create a party!</span>
     </md-whiteframe>
-    <form ng-show="$root.currentUser">
+    <div ng-show="$root.currentUser">
       <h2 class="md-headline">Create a new party:</h2>
       <md-input-container>
         <label>Name</label>
@@ -41,7 +41,7 @@
       </md-whiteframe>
       <md-button ng-click="newParty.owner=$root.currentUser._id;parties.push(newParty); newParty='';">
         Add</md-button>
-    </form>
+    </div>
   </div>
 
   <div layout="column">
-- 
2.3.2 (Apple Git-55)


From 3c1b87533b7f1938ec11cce9f5461d928cf5ea5c Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 20:11:56 +0300
Subject: [PATCH 223/236] Step 20.19: Use angular-xeditable

---
 client/parties/views/parties-list.ng.html | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index e1b1eb8..3d1ff55 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -36,6 +36,8 @@
           </div>
           <div class="party-image-container" ng-repeat="image in newPartyImages">
             <img ng-src="{{ image.url() }}"/><br/>
+            <a href="#" editable-text="image.metadata.description"
+               onbeforesave="updateDescription($data, image)">{{ image.metadata.description || 'Click to add description' }}</a>
           </div>
         </div>
       </md-whiteframe>
-- 
2.3.2 (Apple Git-55)


From a5b563e06a59a377987c5c3933e69ff473d11167 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 20:12:10 +0300
Subject: [PATCH 224/236] Step 20.20: Implement the update logic

---
 client/parties/controllers/partiesList.js | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index f629364..bba86df 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -97,4 +97,8 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '
         }
       });
     };
+
+    $scope.updateDescription = function($data, image) {
+      image.update({$set: {'metadata.description': $data}});
+    };
   }]);
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From e53c39e9769b8139aae3f95469aece84dfcf3e64 Mon Sep 17 00:00:00 2001
From: okland <omri.klinger@gmail.com>
Date: Sun, 23 Aug 2015 19:34:56 +0300
Subject: [PATCH 225/236] Step 20 before step 20.20 - add
 netanelgilad:angular-sortable-view package.

---
 .meteor/packages | 1 +
 .meteor/versions | 1 +
 2 files changed, 2 insertions(+)

diff --git a/.meteor/packages b/.meteor/packages
index 0c1e67a..dbf0c1b 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -23,3 +23,4 @@ cfs:gridfs
 danialfarid:ng-file-upload
 alexk111:ng-img-crop
 vitalets:angular-xeditable
+netanelgilad:angular-sortable-view
diff --git a/.meteor/versions b/.meteor/versions
index c09df5f..5e95aca 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -66,6 +66,7 @@ minimongo@1.0.8
 mobile-status-bar@1.0.3
 mongo@1.1.0
 mongo-livedata@1.0.8
+netanelgilad:angular-sortable-view@0.0.13
 npm-bcrypt@0.7.8_2
 oauth@1.1.4
 oauth1@1.1.4
-- 
2.3.2 (Apple Git-55)


From 091647c0eeac876c5aad780a5c9521f1740fece4 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 20:13:53 +0300
Subject: [PATCH 226/236] Step 20.21: Add dependency for
 'angular-sortable-view'

---
 client/lib/app.js | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/client/lib/app.js b/client/lib/app.js
index 01a4b3e..bb69c52 100644
--- a/client/lib/app.js
+++ b/client/lib/app.js
@@ -6,7 +6,8 @@ angular.module('socially', [
   'ngMaterial',
   'ngFileUpload',
   'ngImgCrop',
-  'xeditable'
+  'xeditable',
+  'angular-sortable-view'
 ]);
 
 angular.module('socially').config(['$mdIconProvider', function ($mdIconProvider) {
-- 
2.3.2 (Apple Git-55)


From 94bceeb7463b29233db1fee40c54bdf0a5a5fb99 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 20:16:08 +0300
Subject: [PATCH 227/236] Step 20.22: Add usage for angular-sortable

---
 client/parties/views/parties-list.ng.html | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index 3d1ff55..8992cd2 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -30,12 +30,13 @@
             <md-button class="md-raised" ng-click="openAddImageModal()">Add Photo</md-button>
           </div>
         </div>
-        <div layout="row" class="images-container-title">
+        <div layout="row" class="images-container-title" sv-root sv-part="newPartyImages"
+             sv-on-sort="updateOrder($partTo)">
           <div ng-show="!newPartyImages || newPartyImages.length === 0">Add photo by clicking "Add Photo" to the
             right.
           </div>
-          <div class="party-image-container" ng-repeat="image in newPartyImages">
-            <img ng-src="{{ image.url() }}"/><br/>
+          <div sv-element class="party-image-container" ng-repeat="image in newPartyImages">
+            <img draggable="false" ng-src="{{ image.url() }}"/><br/>
             <a href="#" editable-text="image.metadata.description"
                onbeforesave="updateDescription($data, image)">{{ image.metadata.description || 'Click to add description' }}</a>
           </div>
-- 
2.3.2 (Apple Git-55)


From 67b2fc7ffd5cb88fe20a539b4d9fe7b7039389b1 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 20:19:57 +0300
Subject: [PATCH 228/236] Step 20.23: Add sort logic

---
 client/parties/controllers/partiesList.js | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index bba86df..0b9826e 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -101,4 +101,10 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '
     $scope.updateDescription = function($data, image) {
       image.update({$set: {'metadata.description': $data}});
     };
+
+    $scope.updateOrder = function(sortedArr) {
+      angular.forEach(sortedArr, function(item, index) {
+        item.currentOrder = index;
+      });
+    };
   }]);
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 312ec38435d3ebb69356746f7851b3a1fb807367 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 20:20:35 +0300
Subject: [PATCH 229/236] Step 20.24: Add indication for main image in the view

---
 client/parties/views/parties-list.ng.html | 1 +
 1 file changed, 1 insertion(+)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index 8992cd2..89b3c37 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -36,6 +36,7 @@
             right.
           </div>
           <div sv-element class="party-image-container" ng-repeat="image in newPartyImages">
+            <div class="main-image" ng-show="$index === 0">Main Image</div>
             <img draggable="false" ng-src="{{ image.url() }}"/><br/>
             <a href="#" editable-text="image.metadata.description"
                onbeforesave="updateDescription($data, image)">{{ image.metadata.description || 'Click to add description' }}</a>
-- 
2.3.2 (Apple Git-55)


From 861e16e0fa5f5ddf1f725166c3613fcdc575422a Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 20:21:00 +0300
Subject: [PATCH 230/236] Step 20.25: Add indication for main image in the CSS

---
 client/parties/styles/parties.import.less | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/client/parties/styles/parties.import.less b/client/parties/styles/parties.import.less
index ae3b85c..d22e4ac 100644
--- a/client/parties/styles/parties.import.less
+++ b/client/parties/styles/parties.import.less
@@ -37,4 +37,11 @@
     h3 {
         text-align: center;
     }
+}
+
+.main-image {
+    position: absolute;
+    top: 5px;
+    left: 5px;
+    background-color: #f8f8f8;
 }
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From 09f53427412810385d7124cbea3fc7f3a6e99e8a Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 20:32:19 +0300
Subject: [PATCH 231/236] Step 20.26: Add logic to save image link to party

---
 client/parties/controllers/partiesList.js | 20 ++++++++++++++++++++
 1 file changed, 20 insertions(+)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index 0b9826e..7592389 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -107,4 +107,24 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '
         item.currentOrder = index;
       });
     };
+
+    $scope.createParty = function() {
+      $scope.newParty.owner = $rootScope.currentUser._id;
+
+      // Link the images and the order to the new party
+      if ($scope.newPartyImages && $scope.newPartyImages.length > 0) {
+        $scope.newParty.images = [];
+
+        angular.forEach($scope.newPartyImages, function(image) {
+          $scope.newParty.images.push({id: image._id, order: image.currentOrder})
+        });
+      }
+
+      // Save the party
+      $scope.parties.push($scope.newParty);
+
+      // Reset the form
+      $scope.newPartyImages = [];
+      $scope.newParty = {};
+    };
   }]);
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From bf9bc6da6f2fda4940bc553fc987237509600120 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 20:33:12 +0300
Subject: [PATCH 232/236] Step 20.27: Change the button

---
 client/parties/views/parties-list.ng.html | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index 89b3c37..7696be4 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -43,8 +43,7 @@
           </div>
         </div>
       </md-whiteframe>
-      <md-button ng-click="newParty.owner=$root.currentUser._id;parties.push(newParty); newParty='';">
-        Add</md-button>
+      <md-button class="md-raised md-primary" ng-click="createParty()">Create Party</md-button>
     </div>
   </div>
 
-- 
2.3.2 (Apple Git-55)


From e09691573b0732cd3cc57e5288f523c2b885cd0d Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 20:34:47 +0300
Subject: [PATCH 233/236] Step 20.28: Add the view for party image

---
 client/parties/views/parties-list.ng.html | 11 ++++++-----
 1 file changed, 6 insertions(+), 5 deletions(-)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index 7696be4..6ec9518 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -76,16 +76,17 @@
     </div>
   </div>
   <div layout="column" layout-padding>
-    <div dir-paginate="party in parties | itemsPerPage: perPage"
-         total-items="partiesCount.count" layout="column">
+    <div dir-paginate="party in parties | itemsPerPage: perPage" total-items="partiesCount.count" layout="column">
       <div layout="row">
-        <div flex="80">
+        <div flex="80" ng-if="party.images && party.images.length > 0">
+          <img ng-src="{{ getMainImage(party.images) }}"/>
+        </div>
+        <div flex="50">
           <h2><a href="/parties/{{party._id}}">{{party.name}}</a></h2>
           <p>{{party.description}}</p>
         </div>
         <span flex></span>
-        <md-button ng-click="remove(party)"
-                   ng-show="$root.currentUser && $root.currentUser._id == party.owner">
+        <md-button ng-click="remove(party)" ng-show="$root.currentUser && $root.currentUser._id == party.owner">
           <md-icon md-svg-icon="content:ic_clear_24px"></md-icon>
         </md-button>
       </div>
-- 
2.3.2 (Apple Git-55)


From 733d189fd575168e5c3e7cc719016e45fe7f08fc Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 20:36:08 +0300
Subject: [PATCH 234/236] Step 20.29: Add getMainImage logic

---
 client/parties/controllers/partiesList.js | 12 ++++++++++--
 1 file changed, 10 insertions(+), 2 deletions(-)

diff --git a/client/parties/controllers/partiesList.js b/client/parties/controllers/partiesList.js
index 7592389..615268e 100644
--- a/client/parties/controllers/partiesList.js
+++ b/client/parties/controllers/partiesList.js
@@ -1,5 +1,5 @@
-angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '$rootScope', '$state', '$mdDialog',
-  function($scope, $meteor, $rootScope, $state, $mdDialog){
+angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '$rootScope', '$state', '$mdDialog', '$filter',
+  function($scope, $meteor, $rootScope, $state, $mdDialog, $filter){
 
     $scope.page = 1;
     $scope.perPage = 3;
@@ -127,4 +127,12 @@ angular.module("socially").controller("PartiesListCtrl", ['$scope', '$meteor', '
       $scope.newPartyImages = [];
       $scope.newParty = {};
     };
+
+    $scope.getMainImage = function(images) {
+      var mainImage = $filter('filter')(images, {order: 0})[0];
+
+      if (mainImage) {
+        return $filter('filter')($scope.images, {_id: mainImage.id})[0].url();
+      }
+    };
   }]);
\ No newline at end of file
-- 
2.3.2 (Apple Git-55)


From caadb5c27bc99c9e5024639da4f0c6756830d312 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 20:43:46 +0300
Subject: [PATCH 235/236] Step 20.30: Add thumbnails

---
 model/images.js | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/model/images.js b/model/images.js
index 5cec451..3b06d5f 100644
--- a/model/images.js
+++ b/model/images.js
@@ -1,6 +1,11 @@
 Images = new FS.Collection("images", {
   stores: [
-    new FS.Store.GridFS("original")
+    new FS.Store.GridFS("original"),
+    new FS.Store.GridFS("thumbnail", {
+      transformWrite: function(fileObj, readStream, writeStream) {
+        gm(readStream, fileObj.name()).resize('32', '32', '!').stream().pipe(writeStream);
+      }
+    })
   ],
   filter: {
     allow: {
-- 
2.3.2 (Apple Git-55)


From ff52d10b58c294e798ade338501719ae9ba5cef8 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 18 Aug 2015 20:44:18 +0300
Subject: [PATCH 236/236] Step 20.31: Use thumbnails

---
 client/parties/views/parties-list.ng.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/parties/views/parties-list.ng.html b/client/parties/views/parties-list.ng.html
index 6ec9518..807ec63 100644
--- a/client/parties/views/parties-list.ng.html
+++ b/client/parties/views/parties-list.ng.html
@@ -37,7 +37,7 @@
           </div>
           <div sv-element class="party-image-container" ng-repeat="image in newPartyImages">
             <div class="main-image" ng-show="$index === 0">Main Image</div>
-            <img draggable="false" ng-src="{{ image.url() }}"/><br/>
+            <img draggable="false" ng-src="{{ image.url({store: 'thumbnail'}) }}"/><br/>
             <a href="#" editable-text="image.metadata.description"
                onbeforesave="updateDescription($data, image)">{{ image.metadata.description || 'Click to add description' }}</a>
           </div>
-- 
2.3.2 (Apple Git-55)

